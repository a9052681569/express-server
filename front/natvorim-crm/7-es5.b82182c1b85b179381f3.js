!function(){function e(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(s){o=!0,i=s}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=d(e);if(t){var o=d(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return u(this,r)}}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"06u4":function(t,o,i){"use strict";i.r(o),i.d(o,"AddOrderModule",function(){return _e});var u,d=i("PCNd"),b=i("tyNb"),l=i("Kj3r"),m=i("hgo/"),f=i("Wcn/"),p=i("ufcJ"),h=i("z6cu"),g=i("eIep"),v=i("vkgz"),y=i("JIr8"),O=i("groK"),S=i("fXoL"),F=i("SuJO"),R=i("dNgK"),C=((u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(r,e);var t=s(r);function r(e,o){var i;return a(this,r),(i=t.call(this,O.a)).addOrderService=e,i.snack=o,i.saveForm=i.effect(function(e){return e.pipe(Object(g.a)(function(e){return i.reqFormPending(),i.addOrderService.updateFormData(e).pipe(Object(v.a)(function(e){i.reqFormSuccess(e)}),Object(y.a)(function(e){return i.reqFormError(),Object(h.a)(e)}))}))}),i.setFormData=i.effect(function(e){return e.pipe(Object(g.a)(function(){return i.reqFormPending(),i.addOrderService.getFormData().pipe(Object(v.a)(function(e){i.reqFormSuccess(e)}),Object(y.a)(function(e){return i.reqFormError(),Object(h.a)(e)}))}))}),i.registerNewOrder=i.effect(function(e){return e.pipe(Object(g.a)(function(e){var t;return i.reqFormPending(),console.log("\u043d\u0430\u0447\u0438\u043d\u0430\u0435\u043c \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c"),e.orderType===f.b.subscription?t=e.subscriptionsOrders.orders:e.orderType===f.b.check&&(t=[e.onceOrder.order]),i.addOrderService.getPersonsByName(e.customer.customer.name).pipe(Object(g.a)(function(r){return r.length?(t.forEach(function(e){e.personId=r[0].id}),i.addOrderService.postOrders(t).pipe(Object(v.a)(function(){i.resetState(),i.addOrderService.resetFormData(),i.snack.open("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0437\u0430\u043a\u0430\u0437",void 0,{duration:3e3})}))):i.addOrderService.postCustomer(e.customer.customer).pipe(Object(g.a)(function(e){var r=n(e,1)[0];return t.forEach(function(e){e.personId=r.id}),i.addOrderService.postOrders(t).pipe(Object(v.a)(function(){i.resetState(),i.addOrderService.resetFormData(),i.snack.open("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0437\u0430\u043a\u0430\u0437 \u0438 \u043d\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",void 0,{duration:3e3})}))}))}),Object(y.a)(function(e){return i.reqFormError(),Object(h.a)(e)}))}))}),i.resetState=i.updater(function(e){return Object.assign(Object.assign({},O.a),{resetForm:!0})}),i.reqFormPending=i.updater(function(e){return Object.assign(Object.assign({},e),{loadingState:m.a.loading})}),i.reqFormSuccess=i.updater(function(e,t){return Object.assign(Object.assign(Object.assign({},e),t),{loadingState:null})}),i.reqFormError=i.updater(function(e){return Object.assign(Object.assign({},e),{loadingState:m.a.err})}),i}return r}(p.a)).\u0275fac=function(e){return new(e||u)(S.Wb(F.a),S.Wb(R.a))},u.\u0275prov=S.Ib({token:u,factory:u.\u0275fac}),u),_=i("G1Gu"),j=i("Wp6s"),k=i("3Pt+"),x=i("XNiG"),$=i("IzEk"),w=i("1G5W"),N=i("TaCb"),M=i("kmnG"),B=i("qFsG"),P=i("/1cH"),z=i("ofXK"),I=i("bTqV"),T=i("NFeN"),D=i("FKr1");function q(e,t){if(1&e&&(S.Sb(0,"mat-option",15),S.zc(1),S.Rb()),2&e){var r=t.$implicit;S.ic("value",r),S.Bb(1),S.Bc(" ",r.name," ")}}function G(e,t){if(1&e&&(S.Sb(0,"mat-error"),S.zc(1),S.Rb()),2&e){var r=S.dc().ngIf;S.Bb(1),S.Ac(null==r.errors?null:r.errors.oneRequired)}}function A(e,t){if(1&e&&(S.Qb(0),S.xc(1,G,2,1,"mat-error",10),S.Pb()),2&e){var r=t.ngIf;S.Bb(1),S.ic("ngIf",null==r.errors?null:r.errors.oneRequired)}}var V,E,L=((V=function(){function e(t,r,n,o){a(this,e),this.fb=t,this.store=r,this.addOrderService=n,this.hs=o,this.destroyer$$=new x.a,this.loadingStates=m.a,this.autocompleteOptions=[]}return r(e,[{key:"ngOnInit",value:function(){this.initForm(),this.loadingState$=this.store.select(function(e){return e.loadingState}),this.setFormFromStore(),this.initFormSaver(),this.initAutocomplete(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"setCustomerFromAutocomplete",value:function(e){this.addCustomerForm.setValue(e.option.value)}},{key:"resetForm",value:function(){this.addCustomerForm.reset()}},{key:"initForm",value:function(){this.addCustomerForm=this.fb.group({id:NaN,name:["",k.u.required],contacts:this.fb.group({email:["",k.u.email],inst:"",phone:[""]},{validators:[this.oneRequiredValidator]}),address:this.fb.group({city:["",k.u.required],address:["",k.u.required]})})}},{key:"setFormFromStore",value:function(){var e=this;this.store.select(function(e){return e.customer}).pipe(Object($.a)(1),Object(v.a)(function(t){e.addCustomerForm.setValue(t.customer)})).subscribe()}},{key:"initFormSaver",value:function(){var e=this;this.addCustomerForm.valueChanges.pipe(Object(w.a)(this.destroyer$$),Object(l.a)(500)).subscribe(function(t){e.store.saveForm({customer:{customer:t,isValid:e.addCustomerForm.valid}})})}},{key:"initAutocomplete",value:function(){var e,t=this;null===(e=this.addCustomerForm.get("name"))||void 0===e||e.valueChanges.pipe(Object(w.a)(this.destroyer$$),Object(l.a)(300),Object(g.a)(function(e){return t.addOrderService.getPersonsByName(e)})).subscribe(function(e){t.autocompleteOptions=e})}},{key:"initResetListener",value:function(){var e=this;this.store.select(function(e){return e.resetForm}).pipe(Object(w.a)(this.destroyer$$),Object(v.a)(function(t){t&&e.resetForm()})).subscribe()}},{key:"oneRequiredValidator",value:function(e){return Object.values(e.value).every(function(e){return 0==!!e})?{oneRequired:"\u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u0438\u043d \u043a\u043e\u043d\u0442\u0430\u043a\u0442"}:null}}]),e}()).\u0275fac=function(e){return new(e||V)(S.Mb(k.e),S.Mb(C),S.Mb(F.a),S.Mb(N.a))},V.\u0275cmp=S.Gb({type:V,selectors:[["ntv-customer-form"]],decls:34,vars:4,consts:[[1,"form",3,"formGroup"],["appearance","standard"],["matInput","","formControlName","name",3,"matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","contacts",1,"form__group"],["matInput","","formControlName","email"],["matInput","","formControlName","inst"],["matInput","","formControlName","phone"],[4,"ngIf"],["formGroupName","address",1,"form__group"],["matInput","","formControlName","city"],["matInput","","formControlName","address"],["mat-icon-button","",3,"click"],[3,"value"]],template:function(e,t){if(1&e&&(S.Sb(0,"form",0),S.Sb(1,"mat-form-field",1),S.Sb(2,"mat-label"),S.zc(3,"\u0424\u0418\u041e*"),S.Rb(),S.Nb(4,"input",2),S.Sb(5,"mat-autocomplete",3,4),S.Zb("optionSelected",function(e){return t.setCustomerFromAutocomplete(e)}),S.xc(7,q,2,2,"mat-option",5),S.Rb(),S.Rb(),S.Sb(8,"div",6),S.Sb(9,"mat-form-field",1),S.Sb(10,"mat-label"),S.zc(11,"E-mail"),S.Rb(),S.Nb(12,"input",7),S.Rb(),S.Sb(13,"mat-form-field",1),S.Sb(14,"mat-label"),S.zc(15,"\u0418\u043d\u0441\u0442\u0430\u0433\u0440\u0430\u043c"),S.Rb(),S.Nb(16,"input",8),S.Rb(),S.Sb(17,"mat-form-field",1),S.Sb(18,"mat-label"),S.zc(19,"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"),S.Rb(),S.Nb(20,"input",9),S.Rb(),S.Rb(),S.xc(21,A,2,1,"ng-container",10),S.Sb(22,"div",11),S.Sb(23,"mat-form-field",1),S.Sb(24,"mat-label"),S.zc(25,"\u0413\u043e\u0440\u043e\u0434*"),S.Rb(),S.Nb(26,"input",12),S.Rb(),S.Sb(27,"mat-form-field",1),S.Sb(28,"mat-label"),S.zc(29,"\u041e\u0441\u0442\u0430\u043b\u044c\u043d\u043e\u0439 \u0430\u0434\u0440\u0435\u0441*"),S.Rb(),S.Nb(30,"input",13),S.Rb(),S.Sb(31,"button",14),S.Zb("click",function(){return t.resetForm()}),S.Sb(32,"mat-icon"),S.zc(33,"refresh"),S.Rb(),S.Rb(),S.Rb(),S.Rb()),2&e){var r=S.nc(6);S.ic("formGroup",t.addCustomerForm),S.Bb(4),S.ic("matAutocomplete",r),S.Bb(3),S.ic("ngForOf",t.autocompleteOptions),S.Bb(14),S.ic("ngIf",t.hs.getControl(t.addCustomerForm.get("contacts")))}},directives:[k.v,k.o,k.h,M.c,M.f,B.b,k.c,P.c,k.n,k.g,P.a,z.j,k.i,z.k,I.a,T.a,D.n,M.b],styles:[".form[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:16px 0}.form__group[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:16px}.form__loading-state[_ngcontent-%COMP%]{justify-self:flex-end;align-self:flex-end}.form__refresh-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 40px;grid-gap:16px}"]}),V),K=i("wZkO"),Z=i("0IaG"),J=i("3tz+"),W=((E=function(){function e(t,r,n){a(this,e),this.dialogRef=t,this.order=r,this.fb=n}return r(e,[{key:"ngOnInit",value:function(){this.orderStructureForm=this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}},{key:"setStructure",value:function(){this.dialogRef.close(this.orderStructureForm.value)}}]),e}()).\u0275fac=function(e){return new(e||E)(S.Mb(Z.f),S.Mb(Z.a),S.Mb(k.e))},E.\u0275cmp=S.Gb({type:E,selectors:[["ntv-add-order-structure-dialog"]],decls:5,vars:3,consts:[[1,"scrollbar"],[1,"content"],[3,"orderStructureGroup","order"],["mat-raised-button","",3,"disabled","click"]],template:function(e,t){1&e&&(S.Sb(0,"ng-scrollbar",0),S.Sb(1,"div",1),S.Nb(2,"ntv-order-structure",2),S.Sb(3,"button",3),S.Zb("click",function(){return t.setStructure()}),S.zc(4," \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c "),S.Rb(),S.Rb(),S.Rb()),2&e&&(S.Bb(2),S.ic("orderStructureGroup",t.orderStructureForm)("order",t.order),S.Bb(1),S.ic("disabled",t.orderStructureForm.invalid))},directives:[_.a,J.a,I.a],styles:["[_nghost-%COMP%]{display:block;min-width:500px;margin:-24px}.scrollbar[_ngcontent-%COMP%]{max-height:70vh}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;padding:24px}"]}),E),Q=i("Qw0g"),H=i("d3UM"),X=i("e1Hi");function U(e,t){1&e&&(S.Sb(0,"h4"),S.zc(1,"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0437\u0430\u043a\u0430\u0437\u044b"),S.Rb())}function Y(e,t){if(1&e&&(S.Sb(0,"mat-option",8),S.zc(1),S.Rb()),2&e){var r=t.$implicit;S.ic("value",r.date),S.Bb(1),S.Bc(" ",r.name," ")}}function ee(e,t){if(1&e&&(S.Sb(0,"mat-option",8),S.zc(1),S.Rb()),2&e){var r=t.$implicit;S.ic("value",r),S.Bb(1),S.Bc(" ",r," ")}}function te(e,t){if(1&e){var r=S.Tb();S.Sb(0,"mat-card",2),S.Sb(1,"mat-form-field",3),S.Sb(2,"mat-label"),S.zc(3,"\u041c\u0435\u0441\u044f\u0446"),S.Rb(),S.Sb(4,"mat-select",4),S.xc(5,Y,2,2,"mat-option",5),S.Rb(),S.Rb(),S.Sb(6,"mat-form-field",3),S.Sb(7,"mat-label"),S.zc(8,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),S.Rb(),S.Sb(9,"mat-select",4),S.xc(10,ee,2,2,"mat-option",5),S.Rb(),S.Rb(),S.Sb(11,"ntv-overlined",6),S.Zb("click",function(){S.pc(r);var e=t.$implicit,n=t.index;return S.dc().showOrderStructureDialog(e.value,n)}),S.Rb(),S.Sb(12,"mat-form-field",3),S.Sb(13,"mat-label"),S.zc(14,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),S.Rb(),S.Nb(15,"input",7),S.Rb(),S.Rb()}if(2&e){var n=t.$implicit,o=S.dc();S.Bb(4),S.ic("formControl",o.hs.getControl(n.get("shipmentDate"))),S.Bb(1),S.ic("ngForOf",o.months),S.Bb(4),S.ic("formControl",o.hs.getControl(n.get("shipmentType"))),S.Bb(1),S.ic("ngForOf",o.shipmentTypes),S.Bb(5),S.ic("formControl",o.hs.getControl(n.get("comment")))}}var re,ne=((re=function(){function t(e,r,n,o){a(this,t),this.fb=e,this.store=r,this.dialog=n,this.hs=o,this.orders=[],this.months=Q.a,this.shipmentTypes=Object.values(f.c),this.destroyer$$=new x.a}return r(t,[{key:"ngOnInit",value:function(){this.ordersControls=this.fb.array([]),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"showOrderStructureDialog",value:function(e,t){var r=this;this.dialog.open(W,{data:e}).afterClosed().subscribe(function(n){if(n){var o=r.fb.group(Object.assign(Object.assign({},e),{orderStructure:n}));r.ordersControls.setControl(t,o)}})}},{key:"initFormSaver",value:function(){var e=this;this.ordersControls.valueChanges.pipe(Object(w.a)(this.destroyer$$),Object(l.a)(500)).subscribe(function(t){var r=!1;t.length&&(r=t.every(function(e){return e.shipmentDate&&e.shipmentType&&(e.orderStructure.kits.length||e.orderStructure.theatres.length)})),e.store.saveForm({subscriptionsOrders:{orders:t,isValid:r}})})}},{key:"initFormSetter",value:function(){var e=this;this.store.select(function(e){return e.subscriptionsOrders}).pipe(Object(w.a)(this.destroyer$$),Object(v.a)(function(t){t.orders.length&&!e.isOrdersEqual(t.orders,e.ordersControls.value)&&(e.ordersControls.clear(),t.orders.forEach(function(t){e.addOrder(t)}))})).subscribe()}},{key:"initResetListener",value:function(){var e=this;this.store.select(function(e){return e.resetForm}).pipe(Object(w.a)(this.destroyer$$),Object(v.a)(function(t){t&&e.ordersControls.clear()})).subscribe()}},{key:"isOrdersEqual",value:function(e,t){if(e.length!==t.length)return!1;var r=this.getDeepValues(e),n=this.getDeepValues(t);return r.length===n.length&&r.every(function(e){return n.includes(e)})}},{key:"getDeepValues",value:function(t){var r=this;return t.reduce(function(t,n){return"object"!=typeof n||null===n?t.push(n):Array.isArray(n)?t.push.apply(t,e(r.getDeepValues(n))):t.push.apply(t,e(r.getDeepValues(Object.values(n)))),t},[])}},{key:"addOrder",value:function(e){this.ordersControls.push(this.fb.group(e))}}]),t}()).\u0275fac=function(e){return new(e||re)(S.Mb(k.e),S.Mb(C),S.Mb(Z.b),S.Mb(N.a))},re.\u0275cmp=S.Gb({type:re,selectors:[["ntv-subscription-orders-form"]],inputs:{orders:"orders"},decls:2,vars:2,consts:[[4,"ngIf"],["class","array-item",4,"ngFor","ngForOf"],[1,"array-item"],["appearance","standard"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["overline","\u043d\u0430\u0431\u043e\u0440\u044b","value","\u041d\u0430\u0436\u043c\u0438",3,"click"],["matInput","",3,"formControl"],[3,"value"]],template:function(e,t){1&e&&(S.xc(0,U,2,0,"h4",0),S.xc(1,te,16,5,"mat-card",1)),2&e&&(S.ic("ngIf",t.ordersControls.length),S.Bb(1),S.ic("ngForOf",t.ordersControls.controls))},directives:[z.k,z.j,j.a,M.c,M.f,H.a,k.n,k.f,X.a,B.b,k.c,D.n],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:16px}.array-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:16px}"]}),re);function oe(e,t){if(1&e&&(S.Sb(0,"mat-option",6),S.zc(1),S.Rb()),2&e){var r=t.$implicit;S.ic("value",r.date),S.Bb(1),S.Bc(" ",r.name," ")}}function ie(e,t){if(1&e&&(S.Sb(0,"mat-option",6),S.zc(1),S.Rb()),2&e){var r=t.$implicit;S.ic("value",r),S.Bb(1),S.Bc(" ",r," ")}}var ae,ce=((ae=function(){function e(t,r,n){a(this,e),this.fb=t,this.store=r,this.dialog=n,this.shipmentTypes=Object.values(f.c),this.months=Q.a,this.destroyer$$=new x.a}return r(e,[{key:"ngOnInit",value:function(){this.addSubscriptionForm=this.fb.group({months:["",k.u.required],shipmentType:["",k.u.required],orderStructure:O.a.onceOrder.order.orderStructure}),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"initFormSetter",value:function(){var e=this;this.store.select(function(e){return e.subscriptionsOrders}).pipe(Object($.a)(1),Object(v.a)(function(t){var r=t.orders;if(r.length){var n={months:r.map(function(e){return e.shipmentDate}),shipmentType:r[0].shipmentType,orderStructure:r[0].orderStructure||O.a.onceOrder.order.orderStructure};e.addSubscriptionForm.setValue(n)}})).subscribe()}},{key:"initFormSaver",value:function(){var e=this;this.addSubscriptionForm.valueChanges.pipe(Object(w.a)(this.destroyer$$),Object(l.a)(500)).subscribe(function(t){if(Array.isArray(t.months)){var r;r=!(!t.orderStructure.kits.length&&!t.orderStructure.theatres.length)&&e.addSubscriptionForm.valid;var n=t.months.map(function(e){return{id:O.a.onceOrder.order.id,personId:O.a.onceOrder.order.personId,comment:O.a.onceOrder.order.comment,sended:O.a.onceOrder.order.sended,shipmentDate:e,shipmentType:t.shipmentType,trackNumber:O.a.onceOrder.order.trackNumber,type:f.b.subscription,orderStructure:t.orderStructure,orderDate:(new Date).toISOString()}});e.store.saveForm({subscriptionsOrders:{orders:n,isValid:r}})}})}},{key:"initResetListener",value:function(){var e=this;this.store.select(function(e){return e.resetForm}).pipe(Object(w.a)(this.destroyer$$),Object(v.a)(function(t){t&&e.addSubscriptionForm.setValue({months:"",shipmentType:"",orderStructure:O.a.onceOrder.order.orderStructure})})).subscribe()}},{key:"showOrderStructureSelectionDialog",value:function(){var e=this;this.store.select(function(e){return e.subscriptionsOrders}).pipe(Object($.a)(1)).subscribe(function(t){var r;r=t.orders.length?t.orders[0]:O.a.onceOrder.order,e.dialog.open(W,{data:r}).afterClosed().subscribe(function(t){t&&e.addSubscriptionForm.patchValue({orderStructure:t})})})}}]),e}()).\u0275fac=function(e){return new(e||ae)(S.Mb(k.e),S.Mb(C),S.Mb(Z.b))},ae.\u0275cmp=S.Gb({type:ae,selectors:[["ntv-subscription-form"]],decls:16,vars:3,consts:[[1,"form",3,"formGroup"],["appearance","standard"],["formControlName","months","multiple",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","shipmentType"],["mat-flat-button","",1,"form__submit",3,"click"],[3,"value"]],template:function(e,t){1&e&&(S.Sb(0,"h4"),S.zc(1,"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0438\u0440\u0443\u0435\u043c \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0443"),S.Rb(),S.Sb(2,"form",0),S.Sb(3,"mat-form-field",1),S.Sb(4,"mat-label"),S.zc(5,"\u041c\u0435\u0441\u044f\u0446\u044b"),S.Rb(),S.Sb(6,"mat-select",2),S.xc(7,oe,2,2,"mat-option",3),S.Rb(),S.Rb(),S.Sb(8,"mat-form-field",1),S.Sb(9,"mat-label"),S.zc(10,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),S.Rb(),S.Sb(11,"mat-select",4),S.xc(12,ie,2,2,"mat-option",3),S.Rb(),S.Rb(),S.Sb(13,"button",5),S.Zb("click",function(){return t.showOrderStructureSelectionDialog()}),S.zc(14,"\u0421\u043e\u0441\u0442\u0430\u0432 \u0437\u0430\u043a\u0430\u0437\u0430"),S.Rb(),S.Rb(),S.Nb(15,"ntv-subscription-orders-form")),2&e&&(S.Bb(2),S.ic("formGroup",t.addSubscriptionForm),S.Bb(5),S.ic("ngForOf",t.months),S.Bb(5),S.ic("ngForOf",t.shipmentTypes))},directives:[k.v,k.o,k.h,M.c,M.f,H.a,k.n,k.g,z.j,I.a,ne,D.n],styles:[".form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:16px;box-sizing:border-box;margin:8px 0}"]}),ae),se=i("f0Cb");function ue(e,t){if(1&e&&(S.Sb(0,"mat-option",11),S.zc(1),S.Rb()),2&e){var r=t.$implicit;S.ic("value",r.date),S.Bb(1),S.Bc(" ",r.name," ")}}function de(e,t){if(1&e&&(S.Sb(0,"mat-option",11),S.zc(1),S.Rb()),2&e){var r=t.$implicit;S.ic("value",r),S.Bb(1),S.Bc(" ",r," ")}}var be,le,me=((le=function(){function e(t,r){a(this,e),this.fb=t,this.store=r,this.months=Q.a,this.shipmentTypes=Object.values(f.c),this.destroyer$$=new x.a}return r(e,[{key:"ngOnInit",value:function(){this.addOrderForm=this.fb.group({id:O.a.onceOrder.order.id,personId:O.a.onceOrder.order.personId,comment:O.a.onceOrder.order.comment,sended:O.a.onceOrder.order.sended,shipmentDate:["",k.u.required],shipmentType:["",k.u.required],trackNumber:O.a.onceOrder.order.trackNumber,type:O.a.onceOrder.order.type,orderStructure:this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"initFormSaver",value:function(){var e=this;this.addOrderForm.valueChanges.pipe(Object(w.a)(this.destroyer$$),Object(l.a)(500)).subscribe(function(t){e.store.saveForm({onceOrder:{order:t,isValid:e.addOrderForm.valid}})})}},{key:"initFormSetter",value:function(){var e=this;this.store.select(function(e){return e.onceOrder}).pipe(Object($.a)(1),Object(v.a)(function(t){e.order=t.order;var r=Object.assign({},t.order);delete r.orderStructure,r.type=f.b.check,e.addOrderForm.patchValue(r)})).subscribe()}},{key:"initResetListener",value:function(){var e=this;this.store.select(function(e){return e.resetForm}).pipe(Object(w.a)(this.destroyer$$),Object(v.a)(function(t){t&&e.addOrderForm.reset()})).subscribe()}},{key:"orderStructure",get:function(){return this.addOrderForm.get("orderStructure")}}]),e}()).\u0275fac=function(e){return new(e||le)(S.Mb(k.e),S.Mb(C))},le.\u0275cmp=S.Gb({type:le,selectors:[["ntv-once-form"]],decls:27,vars:6,consts:[[1,"form",3,"formGroup"],[1,"form__comment"],["appearance","standard"],["matInput","","formControlName","comment"],[1,"form__block"],[1,"select-card"],["formControlName","shipmentDate"],[3,"value",4,"ngFor","ngForOf"],[3,"vertical"],["formControlName","shipmentType"],[3,"order","orderStructureGroup"],[3,"value"]],template:function(e,t){1&e&&(S.Sb(0,"form",0),S.Sb(1,"h4"),S.zc(2,"\u041e \u0437\u0430\u043a\u0430\u0437\u0435"),S.Rb(),S.Sb(3,"mat-card",1),S.Sb(4,"mat-form-field",2),S.Sb(5,"mat-label"),S.zc(6,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),S.Rb(),S.Nb(7,"textarea",3),S.Rb(),S.Rb(),S.Sb(8,"h4"),S.zc(9,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),S.Rb(),S.Sb(10,"div",4),S.Sb(11,"mat-card",5),S.Sb(12,"mat-form-field",2),S.Sb(13,"mat-label"),S.zc(14,"\u0414\u0430\u0442\u0430*"),S.Rb(),S.Sb(15,"mat-select",6),S.xc(16,ue,2,2,"mat-option",7),S.Rb(),S.Rb(),S.Rb(),S.Nb(17,"mat-divider",8),S.Sb(18,"mat-card",5),S.Sb(19,"mat-form-field",2),S.Sb(20,"mat-label"),S.zc(21,"\u0422\u0438\u043f*"),S.Rb(),S.Sb(22,"mat-select",9),S.xc(23,de,2,2,"mat-option",7),S.Rb(),S.Rb(),S.Rb(),S.Rb(),S.Sb(24,"h4"),S.zc(25,"\u0427\u0442\u043e \u0432\u0435\u0437\u0435\u043c"),S.Rb(),S.Nb(26,"ntv-order-structure",10),S.Rb()),2&e&&(S.ic("formGroup",t.addOrderForm),S.Bb(16),S.ic("ngForOf",t.months),S.Bb(1),S.ic("vertical",!0),S.Bb(6),S.ic("ngForOf",t.shipmentTypes),S.Bb(3),S.ic("order",t.order)("orderStructureGroup",t.orderStructure))},directives:[k.v,k.o,k.h,j.a,M.c,M.f,B.b,k.c,k.n,k.g,H.a,z.j,se.a,J.a,D.n],styles:["[_nghost-%COMP%]{display:block;min-width:500px}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;height:100%;box-sizing:border-box}.form__block[_ngcontent-%COMP%]{grid-template-columns:1fr 1px 1fr;grid-gap:16px}.form__block[_ngcontent-%COMP%], .form__comment[_ngcontent-%COMP%]{display:grid;width:100%}.scrollbar[_ngcontent-%COMP%]{max-height:50vh}.select-card[_ngcontent-%COMP%]{display:grid}"]}),le),fe=((be=function(){function e(t){a(this,e),this.store=t,this.orderTypes=f.b}return r(e,[{key:"setCurrentOrderType",value:function(e){var t=Object.values(f.b).reduce(function(t,r){return r===e.tab.textLabel.toLowerCase()&&(t=r),t},f.b.subscription);this.store.saveForm({orderType:t})}}]),e}()).\u0275fac=function(e){return new(e||be)(S.Mb(C))},be.\u0275cmp=S.Gb({type:be,selectors:[["ntv-order-form"]],decls:7,vars:6,consts:[["mat-stretch-tabs","","dynamicHeight","",3,"selectedTabChange"],[3,"label"]],template:function(e,t){1&e&&(S.Sb(0,"mat-tab-group",0),S.Zb("selectedTabChange",function(e){return t.setCurrentOrderType(e)}),S.Sb(1,"mat-tab",1),S.ec(2,"titlecase"),S.Nb(3,"ntv-subscription-form"),S.Rb(),S.Sb(4,"mat-tab",1),S.ec(5,"titlecase"),S.Nb(6,"ntv-once-form"),S.Rb(),S.Rb()),2&e&&(S.Bb(1),S.ic("label",S.fc(2,2,t.orderTypes.subscription)),S.Bb(3),S.ic("label",S.fc(5,4,t.orderTypes.check)))},directives:[K.b,K.a,ce,me],pipes:[z.r],styles:["[_nghost-%COMP%]{display:block}"]}),be),pe=i("4Kj8");function he(e,t){1&e&&(S.Sb(0,"span",8),S.zc(1," \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c... "),S.Nb(2,"ntv-spinner",9),S.Rb()),2&e&&(S.Bb(2),S.ic("diameter",16))}function ge(e,t){1&e&&(S.Sb(0,"span",8),S.zc(1," \u041e\u0448\u0438\u0431\u043a\u0430, \u043d\u0430\u0436\u043c\u0438 \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0441\u043d\u043e\u0432\u0430 "),S.Sb(2,"mat-icon",10),S.zc(3,"error"),S.Rb(),S.Rb())}function ve(e,t){1&e&&(S.Qb(0),S.zc(1," \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u043a\u0430\u0437 "),S.Pb())}function ye(e,t){if(1&e){var r=S.Tb();S.Qb(0),S.Sb(1,"button",5),S.Zb("click",function(){S.pc(r);var e=t.ngIf;return S.dc().registerNewOrder(e)}),S.ec(2,"async"),S.xc(3,he,3,1,"span",6),S.xc(4,ge,4,0,"span",6),S.xc(5,ve,2,0,"ng-container",7),S.Rb(),S.Pb()}if(2&e){var n=S.dc();S.Bb(1),S.ic("ngSwitch",S.fc(2,4,n.loadingState$))("disabled",!n.readyToSend),S.Bb(2),S.ic("ngSwitchCase",n.loadingStates.loading),S.Bb(1),S.ic("ngSwitchCase",n.loadingStates.err)}}var Oe,Se,Fe,Re=[{path:"",component:(Oe=function(){function e(t){a(this,e),this.store=t,this.loadingStates=m.a}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.store.setFormData(),this.loadingState$=this.store.select(function(e){return e.loadingState}).pipe(Object(l.a)(200)),this.state$=this.store.select(function(t){return e.readyToSend=t.orderType===f.b.subscription?t.customer.isValid&&t.subscriptionsOrders.isValid:t.customer.isValid&&t.onceOrder.isValid,t})}},{key:"registerNewOrder",value:function(e){this.store.registerNewOrder(e)}}]),e}(),Oe.\u0275fac=function(e){return new(e||Oe)(S.Mb(C))},Oe.\u0275cmp=S.Gb({type:Oe,selectors:[["ntv-add-order"]],features:[S.Ab([C])],decls:13,vars:3,consts:[[1,"scrollbar"],[1,"add-order"],[1,"add-order__forms-container"],[1,"add-order__form"],[4,"ngIf"],["mat-raised-button","",1,"add-order__submit-button",3,"ngSwitch","disabled","click"],["class","submit-button__content",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"submit-button__content"],[1,"submit-button__spinner",3,"diameter"],[1,"submit-button__error-icon"]],template:function(e,t){1&e&&(S.Sb(0,"ng-scrollbar",0),S.Sb(1,"div",1),S.Sb(2,"div",2),S.Sb(3,"mat-card",3),S.Sb(4,"mat-card-title"),S.zc(5,"\u041a\u043b\u0438\u0435\u043d\u0442"),S.Rb(),S.Nb(6,"ntv-customer-form"),S.Rb(),S.Sb(7,"mat-card",3),S.Sb(8,"mat-card-title"),S.zc(9,"\u0417\u0430\u043a\u0430\u0437"),S.Rb(),S.Nb(10,"ntv-order-form"),S.Rb(),S.Rb(),S.xc(11,ye,6,6,"ng-container",4),S.ec(12,"async"),S.Rb(),S.Rb()),2&e&&(S.Bb(11),S.ic("ngIf",S.fc(12,1,t.state$)))},directives:[_.a,j.a,j.c,L,fe,z.k,I.a,z.m,z.n,z.o,pe.a,T.a],pipes:[z.b],styles:["[_nghost-%COMP%]{display:block;width:100%}.add-order[_ngcontent-%COMP%]{padding:24px}.add-order__forms-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(500px,1fr));gap:16px}.add-order__submit-button[_ngcontent-%COMP%]{margin-top:16px}.add-order__submit-button__content[_ngcontent-%COMP%]{display:flex;align-items:center}.add-order__submit-button__spinner[_ngcontent-%COMP%]{margin-top:0;margin-left:8px}.add-order__submit-button__error-icon[_ngcontent-%COMP%]{margin-left:8px}.scrollbar[_ngcontent-%COMP%]{max-height:calc(100vh - 64px);min-height:calc(100vh - 64px)}"]}),Oe)}],Ce=((Fe=function e(){a(this,e)}).\u0275mod=S.Kb({type:Fe}),Fe.\u0275inj=S.Jb({factory:function(e){return new(e||Fe)},imports:[[b.h.forChild(Re)],b.h]}),Fe),_e=((Se=function e(){a(this,e)}).\u0275mod=S.Kb({type:Se}),Se.\u0275inj=S.Jb({factory:function(e){return new(e||Se)},imports:[[Ce,d.a]]}),Se)}}])}();