!function(){function t(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||o(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(s){o=!0,i=s}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}(t,e)||o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=d(t);if(e){var o=d(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return u(this,r)}}function u(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"06u4":function(e,o,i){"use strict";i.r(o),i.d(o,"AddOrderModule",function(){return jt});var u,d=i("PCNd"),b=i("tyNb"),l=i("Kj3r"),m=i("hgo/"),f=i("Wcn/"),p=i("ufcJ"),h=i("z6cu"),g=i("eIep"),v=i("vkgz"),S=i("JIr8"),O=i("groK"),y=i("fXoL"),F=i("SuJO"),R=i("dNgK"),C=((u=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(r,t);var e=s(r);function r(t,o){var i;return a(this,r),(i=e.call(this,O.a)).addOrderService=t,i.snack=o,i.saveForm=i.effect(function(t){return t.pipe(Object(g.a)(function(t){return i.reqFormPending(),i.addOrderService.updateFormData(t).pipe(Object(v.a)(function(t){i.reqFormSuccess(t)}),Object(S.a)(function(t){return i.reqFormError(),Object(h.a)(t)}))}))}),i.setFormData=i.effect(function(t){return t.pipe(Object(g.a)(function(){return i.reqFormPending(),i.addOrderService.getFormData().pipe(Object(v.a)(function(t){i.reqFormSuccess(t)}),Object(S.a)(function(t){return i.reqFormError(),Object(h.a)(t)}))}))}),i.registerNewOrder=i.effect(function(t){return t.pipe(Object(g.a)(function(t){var e;return i.reqFormPending(),console.log("\u043d\u0430\u0447\u0438\u043d\u0430\u0435\u043c \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c"),t.orderType===f.b.subscription?e=t.subscriptionsOrders.orders:t.orderType===f.b.check&&(e=[t.onceOrder.order]),i.addOrderService.getPersonsByName(t.customer.customer.name).pipe(Object(g.a)(function(r){return r.length?(e.forEach(function(t){t.personId=r[0].id}),i.addOrderService.postOrders(e).pipe(Object(v.a)(function(){i.resetState(),i.addOrderService.resetFormData(),i.snack.open("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0437\u0430\u043a\u0430\u0437",void 0,{duration:3e3}),i.toInitialState()}))):i.addOrderService.postCustomer(t.customer.customer).pipe(Object(g.a)(function(t){var r=n(t,1)[0];return e.forEach(function(t){t.personId=r.id}),i.addOrderService.postOrders(e).pipe(Object(v.a)(function(){i.resetState(),i.addOrderService.resetFormData(),i.snack.open("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0437\u0430\u043a\u0430\u0437 \u0438 \u043d\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",void 0,{duration:3e3}),i.toInitialState()}))}))}),Object(S.a)(function(t){return i.reqFormError(),Object(h.a)(t)}))}))}),i.resetState=i.updater(function(t){return Object.assign(Object.assign({},O.a),{resetForm:!0})}),i.toInitialState=i.updater(function(t){return Object.assign({},O.a)}),i.reqFormPending=i.updater(function(t){return Object.assign(Object.assign({},t),{loadingState:m.a.loading})}),i.reqFormSuccess=i.updater(function(t,e){return Object.assign(Object.assign(Object.assign({},t),e),{loadingState:null})}),i.reqFormError=i.updater(function(t){return Object.assign(Object.assign({},t),{loadingState:m.a.err})}),i}return r}(p.a)).\u0275fac=function(t){return new(t||u)(y.Wb(F.a),y.Wb(R.a))},u.\u0275prov=y.Ib({token:u,factory:u.\u0275fac}),u),j=i("G1Gu"),_=i("Wp6s"),k=i("3Pt+"),x=i("XNiG"),$=i("IzEk"),w=i("1G5W"),N=i("TaCb"),M=i("kmnG"),B=i("qFsG"),I=i("/1cH"),P=i("ofXK"),z=i("bTqV"),T=i("NFeN"),q=i("FKr1");function D(t,e){if(1&t&&(y.Sb(0,"mat-option",15),y.zc(1),y.Rb()),2&t){var r=e.$implicit;y.ic("value",r),y.Bb(1),y.Bc(" ",r.name," ")}}function G(t,e){if(1&t&&(y.Sb(0,"mat-error"),y.zc(1),y.Rb()),2&t){var r=y.dc().ngIf;y.Bb(1),y.Ac(null==r.errors?null:r.errors.oneRequired)}}function A(t,e){if(1&t&&(y.Qb(0),y.xc(1,G,2,1,"mat-error",10),y.Pb()),2&t){var r=e.ngIf;y.Bb(1),y.ic("ngIf",null==r.errors?null:r.errors.oneRequired)}}var V,E,L=((V=function(){function t(e,r,n,o){a(this,t),this.fb=e,this.store=r,this.addOrderService=n,this.hs=o,this.destroyer$$=new x.a,this.loadingStates=m.a,this.autocompleteOptions=[]}return r(t,[{key:"ngOnInit",value:function(){this.initForm(),this.loadingState$=this.store.select(function(t){return t.loadingState}),this.setFormFromStore(),this.initFormSaver(),this.initAutocomplete(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"setCustomerFromAutocomplete",value:function(t){this.addCustomerForm.setValue(t.option.value)}},{key:"resetForm",value:function(){this.addCustomerForm.reset()}},{key:"initForm",value:function(){this.addCustomerForm=this.fb.group({id:NaN,name:["",k.u.required],contacts:this.fb.group({email:["",k.u.email],inst:"",phone:[""]},{validators:[this.oneRequiredValidator]}),address:this.fb.group({city:["",k.u.required],address:["",k.u.required]})})}},{key:"setFormFromStore",value:function(){var t=this;this.store.select(function(t){return t.customer}).pipe(Object($.a)(1),Object(v.a)(function(e){t.addCustomerForm.setValue(e.customer)})).subscribe()}},{key:"initFormSaver",value:function(){var t=this;this.addCustomerForm.valueChanges.pipe(Object(w.a)(this.destroyer$$),Object(l.a)(500)).subscribe(function(e){t.store.saveForm({customer:{customer:e,isValid:t.addCustomerForm.valid}})})}},{key:"initAutocomplete",value:function(){var t,e=this;null===(t=this.addCustomerForm.get("name"))||void 0===t||t.valueChanges.pipe(Object(w.a)(this.destroyer$$),Object(l.a)(300),Object(g.a)(function(t){return e.addOrderService.getPersonsByName(t)})).subscribe(function(t){e.autocompleteOptions=t})}},{key:"initResetListener",value:function(){var t=this;this.store.select(function(t){return t.resetForm}).pipe(Object(w.a)(this.destroyer$$),Object(v.a)(function(e){e&&t.resetForm()})).subscribe()}},{key:"oneRequiredValidator",value:function(t){return Object.values(t.value).every(function(t){return 0==!!t})?{oneRequired:"\u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u0438\u043d \u043a\u043e\u043d\u0442\u0430\u043a\u0442"}:null}}]),t}()).\u0275fac=function(t){return new(t||V)(y.Mb(k.e),y.Mb(C),y.Mb(F.a),y.Mb(N.a))},V.\u0275cmp=y.Gb({type:V,selectors:[["ntv-customer-form"]],decls:34,vars:4,consts:[[1,"form",3,"formGroup"],["appearance","standard"],["matInput","","formControlName","name",3,"matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","contacts",1,"form__group"],["matInput","","formControlName","email"],["matInput","","formControlName","inst"],["matInput","","formControlName","phone"],[4,"ngIf"],["formGroupName","address",1,"form__group"],["matInput","","formControlName","city"],["matInput","","formControlName","address"],["mat-icon-button","",3,"click"],[3,"value"]],template:function(t,e){if(1&t&&(y.Sb(0,"form",0),y.Sb(1,"mat-form-field",1),y.Sb(2,"mat-label"),y.zc(3,"\u0424\u0418\u041e*"),y.Rb(),y.Nb(4,"input",2),y.Sb(5,"mat-autocomplete",3,4),y.Zb("optionSelected",function(t){return e.setCustomerFromAutocomplete(t)}),y.xc(7,D,2,2,"mat-option",5),y.Rb(),y.Rb(),y.Sb(8,"div",6),y.Sb(9,"mat-form-field",1),y.Sb(10,"mat-label"),y.zc(11,"E-mail"),y.Rb(),y.Nb(12,"input",7),y.Rb(),y.Sb(13,"mat-form-field",1),y.Sb(14,"mat-label"),y.zc(15,"\u0418\u043d\u0441\u0442\u0430\u0433\u0440\u0430\u043c"),y.Rb(),y.Nb(16,"input",8),y.Rb(),y.Sb(17,"mat-form-field",1),y.Sb(18,"mat-label"),y.zc(19,"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"),y.Rb(),y.Nb(20,"input",9),y.Rb(),y.Rb(),y.xc(21,A,2,1,"ng-container",10),y.Sb(22,"div",11),y.Sb(23,"mat-form-field",1),y.Sb(24,"mat-label"),y.zc(25,"\u0413\u043e\u0440\u043e\u0434*"),y.Rb(),y.Nb(26,"input",12),y.Rb(),y.Sb(27,"mat-form-field",1),y.Sb(28,"mat-label"),y.zc(29,"\u041e\u0441\u0442\u0430\u043b\u044c\u043d\u043e\u0439 \u0430\u0434\u0440\u0435\u0441*"),y.Rb(),y.Nb(30,"input",13),y.Rb(),y.Sb(31,"button",14),y.Zb("click",function(){return e.resetForm()}),y.Sb(32,"mat-icon"),y.zc(33,"refresh"),y.Rb(),y.Rb(),y.Rb(),y.Rb()),2&t){var r=y.nc(6);y.ic("formGroup",e.addCustomerForm),y.Bb(4),y.ic("matAutocomplete",r),y.Bb(3),y.ic("ngForOf",e.autocompleteOptions),y.Bb(14),y.ic("ngIf",e.hs.getControl(e.addCustomerForm.get("contacts")))}},directives:[k.v,k.o,k.h,M.c,M.f,B.b,k.c,I.c,k.n,k.g,I.a,P.j,k.i,P.k,z.a,T.a,q.n,M.b],styles:[".form[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:16px 0}.form__group[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:16px}.form__loading-state[_ngcontent-%COMP%]{justify-self:flex-end;align-self:flex-end}.form__refresh-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 40px;grid-gap:16px}"]}),V),K=i("wZkO"),Z=i("0IaG"),J=i("3tz+"),W=((E=function(){function t(e,r,n){a(this,t),this.dialogRef=e,this.orderStructure=r,this.fb=n}return r(t,[{key:"ngOnInit",value:function(){this.orderStructureForm=this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}},{key:"setStructure",value:function(){this.dialogRef.close(this.orderStructureForm.value)}}]),t}()).\u0275fac=function(t){return new(t||E)(y.Mb(Z.f),y.Mb(Z.a),y.Mb(k.e))},E.\u0275cmp=y.Gb({type:E,selectors:[["ntv-add-order-structure-dialog"]],decls:5,vars:3,consts:[[1,"scrollbar"],[1,"content"],[3,"orderStructureGroup","orderStructure"],["mat-raised-button","",3,"disabled","click"]],template:function(t,e){1&t&&(y.Sb(0,"ng-scrollbar",0),y.Sb(1,"div",1),y.Nb(2,"ntv-order-structure",2),y.Sb(3,"button",3),y.Zb("click",function(){return e.setStructure()}),y.zc(4," \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c "),y.Rb(),y.Rb(),y.Rb()),2&t&&(y.Bb(2),y.ic("orderStructureGroup",e.orderStructureForm)("orderStructure",e.orderStructure),y.Bb(1),y.ic("disabled",e.orderStructureForm.invalid))},directives:[j.a,J.a,z.a],styles:["[_nghost-%COMP%]{display:block;min-width:500px;margin:-24px}.scrollbar[_ngcontent-%COMP%]{max-height:70vh}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;padding:24px}"]}),E),Q=i("Qw0g"),H=i("d3UM"),X=i("e1Hi");function U(t,e){1&t&&(y.Sb(0,"h4"),y.zc(1,"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0437\u0430\u043a\u0430\u0437\u044b"),y.Rb())}function Y(t,e){if(1&t&&(y.Sb(0,"mat-option",8),y.zc(1),y.Rb()),2&t){var r=e.$implicit;y.ic("value",r.date),y.Bb(1),y.Bc(" ",r.name," ")}}function tt(t,e){if(1&t&&(y.Sb(0,"mat-option",8),y.zc(1),y.Rb()),2&t){var r=e.$implicit;y.ic("value",r),y.Bb(1),y.Bc(" ",r," ")}}function et(t,e){if(1&t){var r=y.Tb();y.Sb(0,"mat-card",2),y.Sb(1,"mat-form-field",3),y.Sb(2,"mat-label"),y.zc(3,"\u041c\u0435\u0441\u044f\u0446"),y.Rb(),y.Sb(4,"mat-select",4),y.xc(5,Y,2,2,"mat-option",5),y.Rb(),y.Rb(),y.Sb(6,"mat-form-field",3),y.Sb(7,"mat-label"),y.zc(8,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),y.Rb(),y.Sb(9,"mat-select",4),y.xc(10,tt,2,2,"mat-option",5),y.Rb(),y.Rb(),y.Sb(11,"ntv-overlined",6),y.Zb("click",function(){y.pc(r);var t=e.$implicit,n=e.index;return y.dc().showOrderStructureDialog(t.value,n)}),y.Rb(),y.Sb(12,"mat-form-field",3),y.Sb(13,"mat-label"),y.zc(14,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),y.Rb(),y.Nb(15,"input",7),y.Rb(),y.Rb()}if(2&t){var n=e.$implicit,o=y.dc();y.Bb(4),y.ic("formControl",o.hs.getControl(n.get("shipmentDate"))),y.Bb(1),y.ic("ngForOf",o.months),y.Bb(4),y.ic("formControl",o.hs.getControl(n.get("shipmentType"))),y.Bb(1),y.ic("ngForOf",o.shipmentTypes),y.Bb(1),y.ic("overline",n.value.standart?"\u043d\u0430\u0431\u043e\u0440\u044b":"\u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e"),y.Bb(4),y.ic("formControl",o.hs.getControl(n.get("comment")))}}var rt,nt=((rt=function(){function e(t,r,n,o){a(this,e),this.fb=t,this.store=r,this.dialog=n,this.hs=o,this.orders=[],this.months=Q.a,this.shipmentTypes=Object.values(f.c),this.destroyer$$=new x.a}return r(e,[{key:"ngOnInit",value:function(){this.ordersControls=this.fb.array([]),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"showOrderStructureDialog",value:function(t,e){var r=this;this.dialog.open(W,{data:t.orderStructure}).afterClosed().subscribe(function(n){if(n){var o=r.isOrderStructuresEqual(n,r.subscriptionsOrdersSavedState.subscriptionOrderStructure),i=r.fb.group(Object.assign(Object.assign({},t),{orderStructure:n,standart:o}));r.ordersControls.setControl(e,i)}})}},{key:"initFormSaver",value:function(){var t=this;this.ordersControls.valueChanges.pipe(Object(w.a)(this.destroyer$$),Object(l.a)(500)).subscribe(function(e){var r=!1;e.length&&(r=e.every(function(t){return t.shipmentDate&&t.shipmentType&&(t.orderStructure.kits.length||t.orderStructure.theatres.length)})),t.store.saveForm({subscriptionsOrders:{orders:e,isValid:r,subscriptionOrderStructure:t.subscriptionsOrdersSavedState.subscriptionOrderStructure}})})}},{key:"initFormSetter",value:function(){var t=this;this.store.select(function(t){return t.subscriptionsOrders}).pipe(Object(w.a)(this.destroyer$$),Object(v.a)(function(e){t.subscriptionsOrdersSavedState=e,e.orders.length&&!t.isOrdersEqual(e.orders,t.ordersControls.value)&&(t.ordersControls.clear(),e.orders.forEach(function(e){t.addOrder(e)}))})).subscribe()}},{key:"initResetListener",value:function(){var t=this;this.store.select(function(t){return t.resetForm}).pipe(Object(w.a)(this.destroyer$$),Object(v.a)(function(e){e&&t.ordersControls.clear()})).subscribe()}},{key:"isOrdersEqual",value:function(t,e){if(t.length!==e.length)return!1;var r=this.getDeepValues(t),n=this.getDeepValues(e);return r.length===n.length&&r.every(function(t){return n.includes(t)})}},{key:"getDeepValues",value:function(e){var r=this;return e.reduce(function(e,n){return"object"!=typeof n||null===n?e.push(n):Array.isArray(n)?e.push.apply(e,t(r.getDeepValues(n))):e.push.apply(e,t(r.getDeepValues(Object.values(n)))),e},[])}},{key:"addOrder",value:function(t){var e=this.isOrderStructuresEqual(t.orderStructure,this.subscriptionsOrdersSavedState.subscriptionOrderStructure);this.ordersControls.push(this.fb.group(Object.assign(Object.assign({},t),{standart:e})))}},{key:"isOrderStructuresEqual",value:function(t,e){return t.kits.length===e.kits.length&&t.theatres.length===e.theatres.length&&!!t.kits.every(function(r,n){return r.age===e.kits[n].age&&r.count===t.kits[n].count})&&!!t.theatres.every(function(r,n){return r.age===e.theatres[n].age&&r.count===t.theatres[n].count})}}]),e}()).\u0275fac=function(t){return new(t||rt)(y.Mb(k.e),y.Mb(C),y.Mb(Z.b),y.Mb(N.a))},rt.\u0275cmp=y.Gb({type:rt,selectors:[["ntv-subscription-orders-form"]],inputs:{orders:"orders"},decls:2,vars:2,consts:[[4,"ngIf"],["class","array-item",4,"ngFor","ngForOf"],[1,"array-item"],["appearance","standard"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["value","\u041d\u0430\u0436\u043c\u0438",1,"clickable",3,"overline","click"],["matInput","",3,"formControl"],[3,"value"]],template:function(t,e){1&t&&(y.xc(0,U,2,0,"h4",0),y.xc(1,et,16,6,"mat-card",1)),2&t&&(y.ic("ngIf",e.ordersControls.length),y.Bb(1),y.ic("ngForOf",e.ordersControls.controls))},directives:[P.k,P.j,_.a,M.c,M.f,H.a,k.n,k.f,X.a,B.b,k.c,q.n],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:16px}.array-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:16px}"]}),rt);function ot(t,e){if(1&t&&(y.Sb(0,"mat-option",6),y.zc(1),y.Rb()),2&t){var r=e.$implicit;y.ic("value",r.date),y.Bb(1),y.Bc(" ",r.name," ")}}function it(t,e){if(1&t&&(y.Sb(0,"mat-option",6),y.zc(1),y.Rb()),2&t){var r=e.$implicit;y.ic("value",r),y.Bb(1),y.Bc(" ",r," ")}}var at,ct=((at=function(){function t(e,r,n){a(this,t),this.fb=e,this.store=r,this.dialog=n,this.shipmentTypes=Object.values(f.c),this.months=Q.a,this.destroyer$$=new x.a}return r(t,[{key:"ngOnInit",value:function(){this.addSubscriptionForm=this.fb.group({months:["",k.u.required],shipmentType:["",k.u.required],orderStructure:O.a.onceOrder.order.orderStructure}),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"initFormSetter",value:function(){var t=this;this.store.select(function(t){return t.subscriptionsOrders}).pipe(Object($.a)(1),Object(v.a)(function(e){var r=e.orders;if(r.length){var n={months:r.map(function(t){return t.shipmentDate}),shipmentType:r[0].shipmentType,orderStructure:r[0].orderStructure||O.a.onceOrder.order.orderStructure};t.addSubscriptionForm.setValue(n)}})).subscribe()}},{key:"initFormSaver",value:function(){var t=this;this.addSubscriptionForm.valueChanges.pipe(Object(w.a)(this.destroyer$$),Object(l.a)(500)).subscribe(function(e){if(Array.isArray(e.months)){var r;r=!(!e.orderStructure.kits.length&&!e.orderStructure.theatres.length)&&t.addSubscriptionForm.valid;var n=e.months.map(function(t){return{id:O.a.onceOrder.order.id,personId:O.a.onceOrder.order.personId,comment:O.a.onceOrder.order.comment,sended:O.a.onceOrder.order.sended,shipmentDate:t,shipmentType:e.shipmentType,trackNumber:O.a.onceOrder.order.trackNumber,type:f.b.subscription,orderStructure:e.orderStructure,orderDate:(new Date).toISOString()}});t.store.saveForm({subscriptionsOrders:{orders:n,isValid:r,subscriptionOrderStructure:e.orderStructure}})}})}},{key:"initResetListener",value:function(){var t=this;this.store.select(function(t){return t.resetForm}).pipe(Object(w.a)(this.destroyer$$),Object(v.a)(function(e){e&&t.addSubscriptionForm.setValue({months:"",shipmentType:"",orderStructure:O.a.onceOrder.order.orderStructure})})).subscribe()}},{key:"showOrderStructureSelectionDialog",value:function(){var t=this;this.store.select(function(t){return t.subscriptionsOrders}).pipe(Object($.a)(1)).subscribe(function(e){t.dialog.open(W,{data:e.subscriptionOrderStructure}).afterClosed().subscribe(function(e){e&&t.addSubscriptionForm.patchValue({orderStructure:e})})})}}]),t}()).\u0275fac=function(t){return new(t||at)(y.Mb(k.e),y.Mb(C),y.Mb(Z.b))},at.\u0275cmp=y.Gb({type:at,selectors:[["ntv-subscription-form"]],decls:16,vars:3,consts:[[1,"form",3,"formGroup"],["appearance","standard"],["formControlName","months","multiple",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","shipmentType"],["mat-flat-button","",1,"form__submit",3,"click"],[3,"value"]],template:function(t,e){1&t&&(y.Sb(0,"h4"),y.zc(1,"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0438\u0440\u0443\u0435\u043c \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0443"),y.Rb(),y.Sb(2,"form",0),y.Sb(3,"mat-form-field",1),y.Sb(4,"mat-label"),y.zc(5,"\u041c\u0435\u0441\u044f\u0446\u044b"),y.Rb(),y.Sb(6,"mat-select",2),y.xc(7,ot,2,2,"mat-option",3),y.Rb(),y.Rb(),y.Sb(8,"mat-form-field",1),y.Sb(9,"mat-label"),y.zc(10,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),y.Rb(),y.Sb(11,"mat-select",4),y.xc(12,it,2,2,"mat-option",3),y.Rb(),y.Rb(),y.Sb(13,"button",5),y.Zb("click",function(){return e.showOrderStructureSelectionDialog()}),y.zc(14,"\u0421\u043e\u0441\u0442\u0430\u0432 \u0437\u0430\u043a\u0430\u0437\u0430"),y.Rb(),y.Rb(),y.Nb(15,"ntv-subscription-orders-form")),2&t&&(y.Bb(2),y.ic("formGroup",e.addSubscriptionForm),y.Bb(5),y.ic("ngForOf",e.months),y.Bb(5),y.ic("ngForOf",e.shipmentTypes))},directives:[k.v,k.o,k.h,M.c,M.f,H.a,k.n,k.g,P.j,z.a,nt,q.n],styles:[".form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:16px;box-sizing:border-box;margin:8px 0}"]}),at),st=i("f0Cb");function ut(t,e){if(1&t&&(y.Sb(0,"mat-option",11),y.zc(1),y.Rb()),2&t){var r=e.$implicit;y.ic("value",r.date),y.Bb(1),y.Bc(" ",r.name," ")}}function dt(t,e){if(1&t&&(y.Sb(0,"mat-option",11),y.zc(1),y.Rb()),2&t){var r=e.$implicit;y.ic("value",r),y.Bb(1),y.Bc(" ",r," ")}}var bt,lt,mt=((lt=function(){function t(e,r){a(this,t),this.fb=e,this.store=r,this.months=Q.a,this.shipmentTypes=Object.values(f.c),this.destroyer$$=new x.a}return r(t,[{key:"ngOnInit",value:function(){this.addOrderForm=this.fb.group({id:O.a.onceOrder.order.id,personId:O.a.onceOrder.order.personId,comment:O.a.onceOrder.order.comment,sended:O.a.onceOrder.order.sended,shipmentDate:["",k.u.required],shipmentType:["",k.u.required],trackNumber:O.a.onceOrder.order.trackNumber,type:O.a.onceOrder.order.type,orderStructure:this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"initFormSaver",value:function(){var t=this;this.addOrderForm.valueChanges.pipe(Object(w.a)(this.destroyer$$),Object(l.a)(500)).subscribe(function(e){t.store.saveForm({onceOrder:{order:e,isValid:t.addOrderForm.valid}})})}},{key:"initFormSetter",value:function(){var t=this;this.store.select(function(t){return t.onceOrder}).pipe(Object($.a)(1),Object(v.a)(function(e){t.order=e.order;var r=Object.assign({},e.order);delete r.orderStructure,r.type=f.b.check,t.addOrderForm.patchValue(r)})).subscribe()}},{key:"initResetListener",value:function(){var t=this;this.store.select(function(t){return t.resetForm}).pipe(Object(w.a)(this.destroyer$$),Object(v.a)(function(e){e&&t.addOrderForm.reset()})).subscribe()}},{key:"orderStructure",get:function(){return this.addOrderForm.get("orderStructure")}}]),t}()).\u0275fac=function(t){return new(t||lt)(y.Mb(k.e),y.Mb(C))},lt.\u0275cmp=y.Gb({type:lt,selectors:[["ntv-once-form"]],decls:27,vars:6,consts:[[1,"form",3,"formGroup"],[1,"form__comment"],["appearance","standard"],["matInput","","formControlName","comment"],[1,"form__block"],[1,"select-card"],["formControlName","shipmentDate"],[3,"value",4,"ngFor","ngForOf"],[3,"vertical"],["formControlName","shipmentType"],[3,"orderStructure","orderStructureGroup"],[3,"value"]],template:function(t,e){1&t&&(y.Sb(0,"form",0),y.Sb(1,"h4"),y.zc(2,"\u041e \u0437\u0430\u043a\u0430\u0437\u0435"),y.Rb(),y.Sb(3,"mat-card",1),y.Sb(4,"mat-form-field",2),y.Sb(5,"mat-label"),y.zc(6,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),y.Rb(),y.Nb(7,"textarea",3),y.Rb(),y.Rb(),y.Sb(8,"h4"),y.zc(9,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),y.Rb(),y.Sb(10,"div",4),y.Sb(11,"mat-card",5),y.Sb(12,"mat-form-field",2),y.Sb(13,"mat-label"),y.zc(14,"\u0414\u0430\u0442\u0430*"),y.Rb(),y.Sb(15,"mat-select",6),y.xc(16,ut,2,2,"mat-option",7),y.Rb(),y.Rb(),y.Rb(),y.Nb(17,"mat-divider",8),y.Sb(18,"mat-card",5),y.Sb(19,"mat-form-field",2),y.Sb(20,"mat-label"),y.zc(21,"\u0422\u0438\u043f*"),y.Rb(),y.Sb(22,"mat-select",9),y.xc(23,dt,2,2,"mat-option",7),y.Rb(),y.Rb(),y.Rb(),y.Rb(),y.Sb(24,"h4"),y.zc(25,"\u0427\u0442\u043e \u0432\u0435\u0437\u0435\u043c"),y.Rb(),y.Nb(26,"ntv-order-structure",10),y.Rb()),2&t&&(y.ic("formGroup",e.addOrderForm),y.Bb(16),y.ic("ngForOf",e.months),y.Bb(1),y.ic("vertical",!0),y.Bb(6),y.ic("ngForOf",e.shipmentTypes),y.Bb(3),y.ic("orderStructure",e.order.orderStructure)("orderStructureGroup",e.orderStructure))},directives:[k.v,k.o,k.h,_.a,M.c,M.f,B.b,k.c,k.n,k.g,H.a,P.j,st.a,J.a,q.n],styles:["[_nghost-%COMP%]{display:block;min-width:500px}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;height:100%;box-sizing:border-box}.form__block[_ngcontent-%COMP%]{grid-template-columns:1fr 1px 1fr;grid-gap:16px}.form__block[_ngcontent-%COMP%], .form__comment[_ngcontent-%COMP%]{display:grid;width:100%}.scrollbar[_ngcontent-%COMP%]{max-height:50vh}.select-card[_ngcontent-%COMP%]{display:grid}"]}),lt),ft=((bt=function(){function t(e){a(this,t),this.store=e,this.orderTypes=f.b}return r(t,[{key:"setCurrentOrderType",value:function(t){var e=Object.values(f.b).reduce(function(e,r){return r===t.tab.textLabel.toLowerCase()&&(e=r),e},f.b.subscription);this.store.saveForm({orderType:e})}}]),t}()).\u0275fac=function(t){return new(t||bt)(y.Mb(C))},bt.\u0275cmp=y.Gb({type:bt,selectors:[["ntv-order-form"]],decls:7,vars:6,consts:[["mat-stretch-tabs","","dynamicHeight","",3,"selectedTabChange"],[3,"label"]],template:function(t,e){1&t&&(y.Sb(0,"mat-tab-group",0),y.Zb("selectedTabChange",function(t){return e.setCurrentOrderType(t)}),y.Sb(1,"mat-tab",1),y.ec(2,"titlecase"),y.Nb(3,"ntv-subscription-form"),y.Rb(),y.Sb(4,"mat-tab",1),y.ec(5,"titlecase"),y.Nb(6,"ntv-once-form"),y.Rb(),y.Rb()),2&t&&(y.Bb(1),y.ic("label",y.fc(2,2,e.orderTypes.subscription)),y.Bb(3),y.ic("label",y.fc(5,4,e.orderTypes.check)))},directives:[K.b,K.a,ct,mt],pipes:[P.r],styles:["[_nghost-%COMP%]{display:block}"]}),bt),pt=i("4Kj8");function ht(t,e){1&t&&(y.Sb(0,"span",8),y.zc(1," \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c... "),y.Nb(2,"ntv-spinner",9),y.Rb()),2&t&&(y.Bb(2),y.ic("diameter",16))}function gt(t,e){1&t&&(y.Sb(0,"span",8),y.zc(1," \u041e\u0448\u0438\u0431\u043a\u0430, \u043d\u0430\u0436\u043c\u0438 \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0441\u043d\u043e\u0432\u0430 "),y.Sb(2,"mat-icon",10),y.zc(3,"error"),y.Rb(),y.Rb())}function vt(t,e){1&t&&(y.Qb(0),y.zc(1," \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u043a\u0430\u0437 "),y.Pb())}function St(t,e){if(1&t){var r=y.Tb();y.Qb(0),y.Sb(1,"button",5),y.Zb("click",function(){y.pc(r);var t=e.ngIf;return y.dc().registerNewOrder(t)}),y.ec(2,"async"),y.xc(3,ht,3,1,"span",6),y.xc(4,gt,4,0,"span",6),y.xc(5,vt,2,0,"ng-container",7),y.Rb(),y.Pb()}if(2&t){var n=y.dc();y.Bb(1),y.ic("ngSwitch",y.fc(2,4,n.loadingState$))("disabled",!n.readyToSend),y.Bb(2),y.ic("ngSwitchCase",n.loadingStates.loading),y.Bb(1),y.ic("ngSwitchCase",n.loadingStates.err)}}var Ot,yt,Ft,Rt=[{path:"",component:(Ot=function(){function t(e){a(this,t),this.store=e,this.loadingStates=m.a}return r(t,[{key:"ngOnInit",value:function(){var t=this;this.store.setFormData(),this.loadingState$=this.store.select(function(t){return t.loadingState}).pipe(Object(l.a)(200)),this.state$=this.store.select(function(e){return t.readyToSend=e.orderType===f.b.subscription?e.customer.isValid&&e.subscriptionsOrders.isValid:e.customer.isValid&&e.onceOrder.isValid,e})}},{key:"registerNewOrder",value:function(t){this.store.registerNewOrder(t)}}]),t}(),Ot.\u0275fac=function(t){return new(t||Ot)(y.Mb(C))},Ot.\u0275cmp=y.Gb({type:Ot,selectors:[["ntv-add-order"]],features:[y.Ab([C])],decls:13,vars:3,consts:[[1,"scrollbar"],[1,"add-order"],[1,"add-order__forms-container"],[1,"add-order__form"],[4,"ngIf"],["mat-raised-button","",1,"add-order__submit-button",3,"ngSwitch","disabled","click"],["class","submit-button__content",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"submit-button__content"],[1,"submit-button__spinner",3,"diameter"],[1,"submit-button__error-icon"]],template:function(t,e){1&t&&(y.Sb(0,"ng-scrollbar",0),y.Sb(1,"div",1),y.Sb(2,"div",2),y.Sb(3,"mat-card",3),y.Sb(4,"mat-card-title"),y.zc(5,"\u041a\u043b\u0438\u0435\u043d\u0442"),y.Rb(),y.Nb(6,"ntv-customer-form"),y.Rb(),y.Sb(7,"mat-card",3),y.Sb(8,"mat-card-title"),y.zc(9,"\u0417\u0430\u043a\u0430\u0437"),y.Rb(),y.Nb(10,"ntv-order-form"),y.Rb(),y.Rb(),y.xc(11,St,6,6,"ng-container",4),y.ec(12,"async"),y.Rb(),y.Rb()),2&t&&(y.Bb(11),y.ic("ngIf",y.fc(12,1,e.state$)))},directives:[j.a,_.a,_.c,L,ft,P.k,z.a,P.m,P.n,P.o,pt.a,T.a],pipes:[P.b],styles:["[_nghost-%COMP%]{display:block;width:100%}.add-order[_ngcontent-%COMP%]{padding:24px}.add-order__forms-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(500px,1fr));gap:16px}.add-order__submit-button[_ngcontent-%COMP%]{margin-top:16px}.add-order__submit-button__content[_ngcontent-%COMP%]{display:flex;align-items:center}.add-order__submit-button__spinner[_ngcontent-%COMP%]{margin-top:0;margin-left:8px}.add-order__submit-button__error-icon[_ngcontent-%COMP%]{margin-left:8px}.scrollbar[_ngcontent-%COMP%]{max-height:calc(100vh - 64px);min-height:calc(100vh - 64px)}"]}),Ot)}],Ct=((Ft=function t(){a(this,t)}).\u0275mod=y.Kb({type:Ft}),Ft.\u0275inj=y.Jb({factory:function(t){return new(t||Ft)},imports:[[b.h.forChild(Rt)],b.h]}),Ft),jt=((yt=function t(){a(this,t)}).\u0275mod=y.Kb({type:yt}),yt.\u0275inj=y.Jb({factory:function(t){return new(t||yt)},imports:[[Ct,d.a]]}),yt)}}])}();