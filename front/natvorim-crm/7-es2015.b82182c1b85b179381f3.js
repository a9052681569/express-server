(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"06u4":function(e,t,r){"use strict";r.r(t),r.d(t,"AddOrderModule",function(){return de});var o=r("PCNd"),s=r("tyNb"),i=r("Kj3r"),n=r("hgo/"),a=r("Wcn/"),c=r("ufcJ"),d=r("z6cu"),b=r("eIep"),m=r("vkgz"),u=r("JIr8"),l=r("groK"),p=r("fXoL"),h=r("SuJO"),f=r("dNgK");let g=(()=>{class e extends c.a{constructor(e,t){super(l.a),this.addOrderService=e,this.snack=t,this.saveForm=this.effect(e=>e.pipe(Object(b.a)(e=>(this.reqFormPending(),this.addOrderService.updateFormData(e).pipe(Object(m.a)(e=>{this.reqFormSuccess(e)}),Object(u.a)(e=>(this.reqFormError(),Object(d.a)(e)))))))),this.setFormData=this.effect(e=>e.pipe(Object(b.a)(()=>(this.reqFormPending(),this.addOrderService.getFormData().pipe(Object(m.a)(e=>{this.reqFormSuccess(e)}),Object(u.a)(e=>(this.reqFormError(),Object(d.a)(e)))))))),this.registerNewOrder=this.effect(e=>e.pipe(Object(b.a)(e=>{let t;return this.reqFormPending(),console.log("\u043d\u0430\u0447\u0438\u043d\u0430\u0435\u043c \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c"),e.orderType===a.b.subscription?t=e.subscriptionsOrders.orders:e.orderType===a.b.check&&(t=[e.onceOrder.order]),this.addOrderService.getPersonsByName(e.customer.customer.name).pipe(Object(b.a)(r=>r.length?(t.forEach(e=>{e.personId=r[0].id}),this.addOrderService.postOrders(t).pipe(Object(m.a)(()=>{this.resetState(),this.addOrderService.resetFormData(),this.snack.open("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0437\u0430\u043a\u0430\u0437",void 0,{duration:3e3})}))):this.addOrderService.postCustomer(e.customer.customer).pipe(Object(b.a)(([e])=>(t.forEach(t=>{t.personId=e.id}),this.addOrderService.postOrders(t).pipe(Object(m.a)(()=>{this.resetState(),this.addOrderService.resetFormData(),this.snack.open("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0437\u0430\u043a\u0430\u0437 \u0438 \u043d\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",void 0,{duration:3e3})})))))),Object(u.a)(e=>(this.reqFormError(),Object(d.a)(e))))}))),this.resetState=this.updater(e=>Object.assign(Object.assign({},l.a),{resetForm:!0})),this.reqFormPending=this.updater(e=>Object.assign(Object.assign({},e),{loadingState:n.a.loading})),this.reqFormSuccess=this.updater((e,t)=>Object.assign(Object.assign(Object.assign({},e),t),{loadingState:null})),this.reqFormError=this.updater(e=>Object.assign(Object.assign({},e),{loadingState:n.a.err}))}}return e.\u0275fac=function(t){return new(t||e)(p.Wb(h.a),p.Wb(f.a))},e.\u0275prov=p.Ib({token:e,factory:e.\u0275fac}),e})();var S=r("G1Gu"),O=r("Wp6s"),v=r("3Pt+"),y=r("XNiG"),F=r("IzEk"),R=r("1G5W"),C=r("TaCb"),_=r("kmnG"),j=r("qFsG"),x=r("/1cH"),$=r("ofXK"),N=r("bTqV"),M=r("NFeN"),B=r("FKr1");function w(e,t){if(1&e&&(p.Sb(0,"mat-option",15),p.zc(1),p.Rb()),2&e){const e=t.$implicit;p.ic("value",e),p.Bb(1),p.Bc(" ",e.name," ")}}function z(e,t){if(1&e&&(p.Sb(0,"mat-error"),p.zc(1),p.Rb()),2&e){const e=p.dc().ngIf;p.Bb(1),p.Ac(null==e.errors?null:e.errors.oneRequired)}}function k(e,t){if(1&e&&(p.Qb(0),p.xc(1,z,2,1,"mat-error",10),p.Pb()),2&e){const e=t.ngIf;p.Bb(1),p.ic("ngIf",null==e.errors?null:e.errors.oneRequired)}}let P=(()=>{class e{constructor(e,t,r,o){this.fb=e,this.store=t,this.addOrderService=r,this.hs=o,this.destroyer$$=new y.a,this.loadingStates=n.a,this.autocompleteOptions=[]}ngOnInit(){this.initForm(),this.loadingState$=this.store.select(e=>e.loadingState),this.setFormFromStore(),this.initFormSaver(),this.initAutocomplete(),this.initResetListener()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}setCustomerFromAutocomplete(e){this.addCustomerForm.setValue(e.option.value)}resetForm(){this.addCustomerForm.reset()}initForm(){this.addCustomerForm=this.fb.group({id:NaN,name:["",v.u.required],contacts:this.fb.group({email:["",v.u.email],inst:"",phone:[""]},{validators:[this.oneRequiredValidator]}),address:this.fb.group({city:["",v.u.required],address:["",v.u.required]})})}setFormFromStore(){this.store.select(e=>e.customer).pipe(Object(F.a)(1),Object(m.a)(e=>{this.addCustomerForm.setValue(e.customer)})).subscribe()}initFormSaver(){this.addCustomerForm.valueChanges.pipe(Object(R.a)(this.destroyer$$),Object(i.a)(500)).subscribe(e=>{this.store.saveForm({customer:{customer:e,isValid:this.addCustomerForm.valid}})})}initAutocomplete(){var e;null===(e=this.addCustomerForm.get("name"))||void 0===e||e.valueChanges.pipe(Object(R.a)(this.destroyer$$),Object(i.a)(300),Object(b.a)(e=>this.addOrderService.getPersonsByName(e))).subscribe(e=>{this.autocompleteOptions=e})}initResetListener(){this.store.select(e=>e.resetForm).pipe(Object(R.a)(this.destroyer$$),Object(m.a)(e=>{e&&this.resetForm()})).subscribe()}oneRequiredValidator(e){return Object.values(e.value).every(e=>0==!!e)?{oneRequired:"\u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u0438\u043d \u043a\u043e\u043d\u0442\u0430\u043a\u0442"}:null}}return e.\u0275fac=function(t){return new(t||e)(p.Mb(v.e),p.Mb(g),p.Mb(h.a),p.Mb(C.a))},e.\u0275cmp=p.Gb({type:e,selectors:[["ntv-customer-form"]],decls:34,vars:4,consts:[[1,"form",3,"formGroup"],["appearance","standard"],["matInput","","formControlName","name",3,"matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","contacts",1,"form__group"],["matInput","","formControlName","email"],["matInput","","formControlName","inst"],["matInput","","formControlName","phone"],[4,"ngIf"],["formGroupName","address",1,"form__group"],["matInput","","formControlName","city"],["matInput","","formControlName","address"],["mat-icon-button","",3,"click"],[3,"value"]],template:function(e,t){if(1&e&&(p.Sb(0,"form",0),p.Sb(1,"mat-form-field",1),p.Sb(2,"mat-label"),p.zc(3,"\u0424\u0418\u041e*"),p.Rb(),p.Nb(4,"input",2),p.Sb(5,"mat-autocomplete",3,4),p.Zb("optionSelected",function(e){return t.setCustomerFromAutocomplete(e)}),p.xc(7,w,2,2,"mat-option",5),p.Rb(),p.Rb(),p.Sb(8,"div",6),p.Sb(9,"mat-form-field",1),p.Sb(10,"mat-label"),p.zc(11,"E-mail"),p.Rb(),p.Nb(12,"input",7),p.Rb(),p.Sb(13,"mat-form-field",1),p.Sb(14,"mat-label"),p.zc(15,"\u0418\u043d\u0441\u0442\u0430\u0433\u0440\u0430\u043c"),p.Rb(),p.Nb(16,"input",8),p.Rb(),p.Sb(17,"mat-form-field",1),p.Sb(18,"mat-label"),p.zc(19,"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"),p.Rb(),p.Nb(20,"input",9),p.Rb(),p.Rb(),p.xc(21,k,2,1,"ng-container",10),p.Sb(22,"div",11),p.Sb(23,"mat-form-field",1),p.Sb(24,"mat-label"),p.zc(25,"\u0413\u043e\u0440\u043e\u0434*"),p.Rb(),p.Nb(26,"input",12),p.Rb(),p.Sb(27,"mat-form-field",1),p.Sb(28,"mat-label"),p.zc(29,"\u041e\u0441\u0442\u0430\u043b\u044c\u043d\u043e\u0439 \u0430\u0434\u0440\u0435\u0441*"),p.Rb(),p.Nb(30,"input",13),p.Rb(),p.Sb(31,"button",14),p.Zb("click",function(){return t.resetForm()}),p.Sb(32,"mat-icon"),p.zc(33,"refresh"),p.Rb(),p.Rb(),p.Rb(),p.Rb()),2&e){const e=p.nc(6);p.ic("formGroup",t.addCustomerForm),p.Bb(4),p.ic("matAutocomplete",e),p.Bb(3),p.ic("ngForOf",t.autocompleteOptions),p.Bb(14),p.ic("ngIf",t.hs.getControl(t.addCustomerForm.get("contacts")))}},directives:[v.v,v.o,v.h,_.c,_.f,j.b,v.c,x.c,v.n,v.g,x.a,$.j,v.i,$.k,N.a,M.a,B.n,_.b],styles:[".form[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:16px 0}.form__group[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:16px}.form__loading-state[_ngcontent-%COMP%]{justify-self:flex-end;align-self:flex-end}.form__refresh-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 40px;grid-gap:16px}"]}),e})();var I=r("wZkO"),T=r("0IaG"),D=r("3tz+");let q=(()=>{class e{constructor(e,t,r){this.dialogRef=e,this.order=t,this.fb=r}ngOnInit(){this.orderStructureForm=this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}setStructure(){this.dialogRef.close(this.orderStructureForm.value)}}return e.\u0275fac=function(t){return new(t||e)(p.Mb(T.f),p.Mb(T.a),p.Mb(v.e))},e.\u0275cmp=p.Gb({type:e,selectors:[["ntv-add-order-structure-dialog"]],decls:5,vars:3,consts:[[1,"scrollbar"],[1,"content"],[3,"orderStructureGroup","order"],["mat-raised-button","",3,"disabled","click"]],template:function(e,t){1&e&&(p.Sb(0,"ng-scrollbar",0),p.Sb(1,"div",1),p.Nb(2,"ntv-order-structure",2),p.Sb(3,"button",3),p.Zb("click",function(){return t.setStructure()}),p.zc(4," \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c "),p.Rb(),p.Rb(),p.Rb()),2&e&&(p.Bb(2),p.ic("orderStructureGroup",t.orderStructureForm)("order",t.order),p.Bb(1),p.ic("disabled",t.orderStructureForm.invalid))},directives:[S.a,D.a,N.a],styles:["[_nghost-%COMP%]{display:block;min-width:500px;margin:-24px}.scrollbar[_ngcontent-%COMP%]{max-height:70vh}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;padding:24px}"]}),e})();var G=r("Qw0g"),V=r("d3UM"),A=r("e1Hi");function E(e,t){1&e&&(p.Sb(0,"h4"),p.zc(1,"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0437\u0430\u043a\u0430\u0437\u044b"),p.Rb())}function L(e,t){if(1&e&&(p.Sb(0,"mat-option",8),p.zc(1),p.Rb()),2&e){const e=t.$implicit;p.ic("value",e.date),p.Bb(1),p.Bc(" ",e.name," ")}}function K(e,t){if(1&e&&(p.Sb(0,"mat-option",8),p.zc(1),p.Rb()),2&e){const e=t.$implicit;p.ic("value",e),p.Bb(1),p.Bc(" ",e," ")}}function Z(e,t){if(1&e){const e=p.Tb();p.Sb(0,"mat-card",2),p.Sb(1,"mat-form-field",3),p.Sb(2,"mat-label"),p.zc(3,"\u041c\u0435\u0441\u044f\u0446"),p.Rb(),p.Sb(4,"mat-select",4),p.xc(5,L,2,2,"mat-option",5),p.Rb(),p.Rb(),p.Sb(6,"mat-form-field",3),p.Sb(7,"mat-label"),p.zc(8,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),p.Rb(),p.Sb(9,"mat-select",4),p.xc(10,K,2,2,"mat-option",5),p.Rb(),p.Rb(),p.Sb(11,"ntv-overlined",6),p.Zb("click",function(){p.pc(e);const r=t.$implicit,o=t.index;return p.dc().showOrderStructureDialog(r.value,o)}),p.Rb(),p.Sb(12,"mat-form-field",3),p.Sb(13,"mat-label"),p.zc(14,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),p.Rb(),p.Nb(15,"input",7),p.Rb(),p.Rb()}if(2&e){const e=t.$implicit,r=p.dc();p.Bb(4),p.ic("formControl",r.hs.getControl(e.get("shipmentDate"))),p.Bb(1),p.ic("ngForOf",r.months),p.Bb(4),p.ic("formControl",r.hs.getControl(e.get("shipmentType"))),p.Bb(1),p.ic("ngForOf",r.shipmentTypes),p.Bb(5),p.ic("formControl",r.hs.getControl(e.get("comment")))}}let J=(()=>{class e{constructor(e,t,r,o){this.fb=e,this.store=t,this.dialog=r,this.hs=o,this.orders=[],this.months=G.a,this.shipmentTypes=Object.values(a.c),this.destroyer$$=new y.a}ngOnInit(){this.ordersControls=this.fb.array([]),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}showOrderStructureDialog(e,t){this.dialog.open(q,{data:e}).afterClosed().subscribe(r=>{if(r){const o=this.fb.group(Object.assign(Object.assign({},e),{orderStructure:r}));this.ordersControls.setControl(t,o)}})}initFormSaver(){this.ordersControls.valueChanges.pipe(Object(R.a)(this.destroyer$$),Object(i.a)(500)).subscribe(e=>{let t=!1;e.length&&(t=e.every(e=>e.shipmentDate&&e.shipmentType&&(e.orderStructure.kits.length||e.orderStructure.theatres.length))),this.store.saveForm({subscriptionsOrders:{orders:e,isValid:t}})})}initFormSetter(){this.store.select(e=>e.subscriptionsOrders).pipe(Object(R.a)(this.destroyer$$),Object(m.a)(e=>{e.orders.length&&!this.isOrdersEqual(e.orders,this.ordersControls.value)&&(this.ordersControls.clear(),e.orders.forEach(e=>{this.addOrder(e)}))})).subscribe()}initResetListener(){this.store.select(e=>e.resetForm).pipe(Object(R.a)(this.destroyer$$),Object(m.a)(e=>{e&&this.ordersControls.clear()})).subscribe()}isOrdersEqual(e,t){if(e.length!==t.length)return!1;const r=this.getDeepValues(e),o=this.getDeepValues(t);return r.length===o.length&&r.every(e=>o.includes(e))}getDeepValues(e){return e.reduce((e,t)=>("object"!=typeof t||null===t?e.push(t):Array.isArray(t)?e.push(...this.getDeepValues(t)):e.push(...this.getDeepValues(Object.values(t))),e),[])}addOrder(e){this.ordersControls.push(this.fb.group(e))}}return e.\u0275fac=function(t){return new(t||e)(p.Mb(v.e),p.Mb(g),p.Mb(T.b),p.Mb(C.a))},e.\u0275cmp=p.Gb({type:e,selectors:[["ntv-subscription-orders-form"]],inputs:{orders:"orders"},decls:2,vars:2,consts:[[4,"ngIf"],["class","array-item",4,"ngFor","ngForOf"],[1,"array-item"],["appearance","standard"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["overline","\u043d\u0430\u0431\u043e\u0440\u044b","value","\u041d\u0430\u0436\u043c\u0438",3,"click"],["matInput","",3,"formControl"],[3,"value"]],template:function(e,t){1&e&&(p.xc(0,E,2,0,"h4",0),p.xc(1,Z,16,5,"mat-card",1)),2&e&&(p.ic("ngIf",t.ordersControls.length),p.Bb(1),p.ic("ngForOf",t.ordersControls.controls))},directives:[$.k,$.j,O.a,_.c,_.f,V.a,v.n,v.f,A.a,j.b,v.c,B.n],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:16px}.array-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:16px}"]}),e})();function W(e,t){if(1&e&&(p.Sb(0,"mat-option",6),p.zc(1),p.Rb()),2&e){const e=t.$implicit;p.ic("value",e.date),p.Bb(1),p.Bc(" ",e.name," ")}}function Q(e,t){if(1&e&&(p.Sb(0,"mat-option",6),p.zc(1),p.Rb()),2&e){const e=t.$implicit;p.ic("value",e),p.Bb(1),p.Bc(" ",e," ")}}let H=(()=>{class e{constructor(e,t,r){this.fb=e,this.store=t,this.dialog=r,this.shipmentTypes=Object.values(a.c),this.months=G.a,this.destroyer$$=new y.a}ngOnInit(){this.addSubscriptionForm=this.fb.group({months:["",v.u.required],shipmentType:["",v.u.required],orderStructure:l.a.onceOrder.order.orderStructure}),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}initFormSetter(){this.store.select(e=>e.subscriptionsOrders).pipe(Object(F.a)(1),Object(m.a)(e=>{const t=e.orders;if(t.length){const e={months:t.map(e=>e.shipmentDate),shipmentType:t[0].shipmentType,orderStructure:t[0].orderStructure||l.a.onceOrder.order.orderStructure};this.addSubscriptionForm.setValue(e)}})).subscribe()}initFormSaver(){this.addSubscriptionForm.valueChanges.pipe(Object(R.a)(this.destroyer$$),Object(i.a)(500)).subscribe(e=>{if(Array.isArray(e.months)){let t=!0;t=!(!e.orderStructure.kits.length&&!e.orderStructure.theatres.length)&&this.addSubscriptionForm.valid;const r=e.months.map(t=>({id:l.a.onceOrder.order.id,personId:l.a.onceOrder.order.personId,comment:l.a.onceOrder.order.comment,sended:l.a.onceOrder.order.sended,shipmentDate:t,shipmentType:e.shipmentType,trackNumber:l.a.onceOrder.order.trackNumber,type:a.b.subscription,orderStructure:e.orderStructure,orderDate:(new Date).toISOString()}));this.store.saveForm({subscriptionsOrders:{orders:r,isValid:t}})}})}initResetListener(){this.store.select(e=>e.resetForm).pipe(Object(R.a)(this.destroyer$$),Object(m.a)(e=>{e&&this.addSubscriptionForm.setValue({months:"",shipmentType:"",orderStructure:l.a.onceOrder.order.orderStructure})})).subscribe()}showOrderStructureSelectionDialog(){this.store.select(e=>e.subscriptionsOrders).pipe(Object(F.a)(1)).subscribe(e=>{let t;t=e.orders.length?e.orders[0]:l.a.onceOrder.order,this.dialog.open(q,{data:t}).afterClosed().subscribe(e=>{e&&this.addSubscriptionForm.patchValue({orderStructure:e})})})}}return e.\u0275fac=function(t){return new(t||e)(p.Mb(v.e),p.Mb(g),p.Mb(T.b))},e.\u0275cmp=p.Gb({type:e,selectors:[["ntv-subscription-form"]],decls:16,vars:3,consts:[[1,"form",3,"formGroup"],["appearance","standard"],["formControlName","months","multiple",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","shipmentType"],["mat-flat-button","",1,"form__submit",3,"click"],[3,"value"]],template:function(e,t){1&e&&(p.Sb(0,"h4"),p.zc(1,"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0438\u0440\u0443\u0435\u043c \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0443"),p.Rb(),p.Sb(2,"form",0),p.Sb(3,"mat-form-field",1),p.Sb(4,"mat-label"),p.zc(5,"\u041c\u0435\u0441\u044f\u0446\u044b"),p.Rb(),p.Sb(6,"mat-select",2),p.xc(7,W,2,2,"mat-option",3),p.Rb(),p.Rb(),p.Sb(8,"mat-form-field",1),p.Sb(9,"mat-label"),p.zc(10,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),p.Rb(),p.Sb(11,"mat-select",4),p.xc(12,Q,2,2,"mat-option",3),p.Rb(),p.Rb(),p.Sb(13,"button",5),p.Zb("click",function(){return t.showOrderStructureSelectionDialog()}),p.zc(14,"\u0421\u043e\u0441\u0442\u0430\u0432 \u0437\u0430\u043a\u0430\u0437\u0430"),p.Rb(),p.Rb(),p.Nb(15,"ntv-subscription-orders-form")),2&e&&(p.Bb(2),p.ic("formGroup",t.addSubscriptionForm),p.Bb(5),p.ic("ngForOf",t.months),p.Bb(5),p.ic("ngForOf",t.shipmentTypes))},directives:[v.v,v.o,v.h,_.c,_.f,V.a,v.n,v.g,$.j,N.a,J,B.n],styles:[".form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:16px;box-sizing:border-box;margin:8px 0}"]}),e})();var X=r("f0Cb");function U(e,t){if(1&e&&(p.Sb(0,"mat-option",11),p.zc(1),p.Rb()),2&e){const e=t.$implicit;p.ic("value",e.date),p.Bb(1),p.Bc(" ",e.name," ")}}function Y(e,t){if(1&e&&(p.Sb(0,"mat-option",11),p.zc(1),p.Rb()),2&e){const e=t.$implicit;p.ic("value",e),p.Bb(1),p.Bc(" ",e," ")}}let ee=(()=>{class e{constructor(e,t){this.fb=e,this.store=t,this.months=G.a,this.shipmentTypes=Object.values(a.c),this.destroyer$$=new y.a}get orderStructure(){return this.addOrderForm.get("orderStructure")}ngOnInit(){this.addOrderForm=this.fb.group({id:l.a.onceOrder.order.id,personId:l.a.onceOrder.order.personId,comment:l.a.onceOrder.order.comment,sended:l.a.onceOrder.order.sended,shipmentDate:["",v.u.required],shipmentType:["",v.u.required],trackNumber:l.a.onceOrder.order.trackNumber,type:l.a.onceOrder.order.type,orderStructure:this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}initFormSaver(){this.addOrderForm.valueChanges.pipe(Object(R.a)(this.destroyer$$),Object(i.a)(500)).subscribe(e=>{this.store.saveForm({onceOrder:{order:e,isValid:this.addOrderForm.valid}})})}initFormSetter(){this.store.select(e=>e.onceOrder).pipe(Object(F.a)(1),Object(m.a)(e=>{this.order=e.order;const t=Object.assign({},e.order);delete t.orderStructure,t.type=a.b.check,this.addOrderForm.patchValue(t)})).subscribe()}initResetListener(){this.store.select(e=>e.resetForm).pipe(Object(R.a)(this.destroyer$$),Object(m.a)(e=>{e&&this.addOrderForm.reset()})).subscribe()}}return e.\u0275fac=function(t){return new(t||e)(p.Mb(v.e),p.Mb(g))},e.\u0275cmp=p.Gb({type:e,selectors:[["ntv-once-form"]],decls:27,vars:6,consts:[[1,"form",3,"formGroup"],[1,"form__comment"],["appearance","standard"],["matInput","","formControlName","comment"],[1,"form__block"],[1,"select-card"],["formControlName","shipmentDate"],[3,"value",4,"ngFor","ngForOf"],[3,"vertical"],["formControlName","shipmentType"],[3,"order","orderStructureGroup"],[3,"value"]],template:function(e,t){1&e&&(p.Sb(0,"form",0),p.Sb(1,"h4"),p.zc(2,"\u041e \u0437\u0430\u043a\u0430\u0437\u0435"),p.Rb(),p.Sb(3,"mat-card",1),p.Sb(4,"mat-form-field",2),p.Sb(5,"mat-label"),p.zc(6,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),p.Rb(),p.Nb(7,"textarea",3),p.Rb(),p.Rb(),p.Sb(8,"h4"),p.zc(9,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),p.Rb(),p.Sb(10,"div",4),p.Sb(11,"mat-card",5),p.Sb(12,"mat-form-field",2),p.Sb(13,"mat-label"),p.zc(14,"\u0414\u0430\u0442\u0430*"),p.Rb(),p.Sb(15,"mat-select",6),p.xc(16,U,2,2,"mat-option",7),p.Rb(),p.Rb(),p.Rb(),p.Nb(17,"mat-divider",8),p.Sb(18,"mat-card",5),p.Sb(19,"mat-form-field",2),p.Sb(20,"mat-label"),p.zc(21,"\u0422\u0438\u043f*"),p.Rb(),p.Sb(22,"mat-select",9),p.xc(23,Y,2,2,"mat-option",7),p.Rb(),p.Rb(),p.Rb(),p.Rb(),p.Sb(24,"h4"),p.zc(25,"\u0427\u0442\u043e \u0432\u0435\u0437\u0435\u043c"),p.Rb(),p.Nb(26,"ntv-order-structure",10),p.Rb()),2&e&&(p.ic("formGroup",t.addOrderForm),p.Bb(16),p.ic("ngForOf",t.months),p.Bb(1),p.ic("vertical",!0),p.Bb(6),p.ic("ngForOf",t.shipmentTypes),p.Bb(3),p.ic("order",t.order)("orderStructureGroup",t.orderStructure))},directives:[v.v,v.o,v.h,O.a,_.c,_.f,j.b,v.c,v.n,v.g,V.a,$.j,X.a,D.a,B.n],styles:["[_nghost-%COMP%]{display:block;min-width:500px}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;height:100%;box-sizing:border-box}.form__block[_ngcontent-%COMP%]{grid-template-columns:1fr 1px 1fr;grid-gap:16px}.form__block[_ngcontent-%COMP%], .form__comment[_ngcontent-%COMP%]{display:grid;width:100%}.scrollbar[_ngcontent-%COMP%]{max-height:50vh}.select-card[_ngcontent-%COMP%]{display:grid}"]}),e})(),te=(()=>{class e{constructor(e){this.store=e,this.orderTypes=a.b}setCurrentOrderType(e){const t=Object.values(a.b).reduce((t,r)=>(r===e.tab.textLabel.toLowerCase()&&(t=r),t),a.b.subscription);this.store.saveForm({orderType:t})}}return e.\u0275fac=function(t){return new(t||e)(p.Mb(g))},e.\u0275cmp=p.Gb({type:e,selectors:[["ntv-order-form"]],decls:7,vars:6,consts:[["mat-stretch-tabs","","dynamicHeight","",3,"selectedTabChange"],[3,"label"]],template:function(e,t){1&e&&(p.Sb(0,"mat-tab-group",0),p.Zb("selectedTabChange",function(e){return t.setCurrentOrderType(e)}),p.Sb(1,"mat-tab",1),p.ec(2,"titlecase"),p.Nb(3,"ntv-subscription-form"),p.Rb(),p.Sb(4,"mat-tab",1),p.ec(5,"titlecase"),p.Nb(6,"ntv-once-form"),p.Rb(),p.Rb()),2&e&&(p.Bb(1),p.ic("label",p.fc(2,2,t.orderTypes.subscription)),p.Bb(3),p.ic("label",p.fc(5,4,t.orderTypes.check)))},directives:[I.b,I.a,H,ee],pipes:[$.r],styles:["[_nghost-%COMP%]{display:block}"]}),e})();var re=r("4Kj8");function oe(e,t){1&e&&(p.Sb(0,"span",8),p.zc(1," \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c... "),p.Nb(2,"ntv-spinner",9),p.Rb()),2&e&&(p.Bb(2),p.ic("diameter",16))}function se(e,t){1&e&&(p.Sb(0,"span",8),p.zc(1," \u041e\u0448\u0438\u0431\u043a\u0430, \u043d\u0430\u0436\u043c\u0438 \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0441\u043d\u043e\u0432\u0430 "),p.Sb(2,"mat-icon",10),p.zc(3,"error"),p.Rb(),p.Rb())}function ie(e,t){1&e&&(p.Qb(0),p.zc(1," \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u043a\u0430\u0437 "),p.Pb())}function ne(e,t){if(1&e){const e=p.Tb();p.Qb(0),p.Sb(1,"button",5),p.Zb("click",function(){p.pc(e);const r=t.ngIf;return p.dc().registerNewOrder(r)}),p.ec(2,"async"),p.xc(3,oe,3,1,"span",6),p.xc(4,se,4,0,"span",6),p.xc(5,ie,2,0,"ng-container",7),p.Rb(),p.Pb()}if(2&e){const e=p.dc();p.Bb(1),p.ic("ngSwitch",p.fc(2,4,e.loadingState$))("disabled",!e.readyToSend),p.Bb(2),p.ic("ngSwitchCase",e.loadingStates.loading),p.Bb(1),p.ic("ngSwitchCase",e.loadingStates.err)}}const ae=[{path:"",component:(()=>{class e{constructor(e){this.store=e,this.loadingStates=n.a}ngOnInit(){this.store.setFormData(),this.loadingState$=this.store.select(e=>e.loadingState).pipe(Object(i.a)(200)),this.state$=this.store.select(e=>(this.readyToSend=e.orderType===a.b.subscription?e.customer.isValid&&e.subscriptionsOrders.isValid:e.customer.isValid&&e.onceOrder.isValid,e))}registerNewOrder(e){this.store.registerNewOrder(e)}}return e.\u0275fac=function(t){return new(t||e)(p.Mb(g))},e.\u0275cmp=p.Gb({type:e,selectors:[["ntv-add-order"]],features:[p.Ab([g])],decls:13,vars:3,consts:[[1,"scrollbar"],[1,"add-order"],[1,"add-order__forms-container"],[1,"add-order__form"],[4,"ngIf"],["mat-raised-button","",1,"add-order__submit-button",3,"ngSwitch","disabled","click"],["class","submit-button__content",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"submit-button__content"],[1,"submit-button__spinner",3,"diameter"],[1,"submit-button__error-icon"]],template:function(e,t){1&e&&(p.Sb(0,"ng-scrollbar",0),p.Sb(1,"div",1),p.Sb(2,"div",2),p.Sb(3,"mat-card",3),p.Sb(4,"mat-card-title"),p.zc(5,"\u041a\u043b\u0438\u0435\u043d\u0442"),p.Rb(),p.Nb(6,"ntv-customer-form"),p.Rb(),p.Sb(7,"mat-card",3),p.Sb(8,"mat-card-title"),p.zc(9,"\u0417\u0430\u043a\u0430\u0437"),p.Rb(),p.Nb(10,"ntv-order-form"),p.Rb(),p.Rb(),p.xc(11,ne,6,6,"ng-container",4),p.ec(12,"async"),p.Rb(),p.Rb()),2&e&&(p.Bb(11),p.ic("ngIf",p.fc(12,1,t.state$)))},directives:[S.a,O.a,O.c,P,te,$.k,N.a,$.m,$.n,$.o,re.a,M.a],pipes:[$.b],styles:["[_nghost-%COMP%]{display:block;width:100%}.add-order[_ngcontent-%COMP%]{padding:24px}.add-order__forms-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(500px,1fr));gap:16px}.add-order__submit-button[_ngcontent-%COMP%]{margin-top:16px}.add-order__submit-button__content[_ngcontent-%COMP%]{display:flex;align-items:center}.add-order__submit-button__spinner[_ngcontent-%COMP%]{margin-top:0;margin-left:8px}.add-order__submit-button__error-icon[_ngcontent-%COMP%]{margin-left:8px}.scrollbar[_ngcontent-%COMP%]{max-height:calc(100vh - 64px);min-height:calc(100vh - 64px)}"]}),e})()}];let ce=(()=>{class e{}return e.\u0275mod=p.Kb({type:e}),e.\u0275inj=p.Jb({factory:function(t){return new(t||e)},imports:[[s.h.forChild(ae)],s.h]}),e})(),de=(()=>{class e{}return e.\u0275mod=p.Kb({type:e}),e.\u0275inj=p.Jb({factory:function(t){return new(t||e)},imports:[[ce,o.a]]}),e})()}}]);