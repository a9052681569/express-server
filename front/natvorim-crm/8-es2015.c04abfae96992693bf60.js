(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"5tjk":function(t,e,r){"use strict";r.r(e),r.d(e,"PeopleModule",function(){return we});var o=r("tyNb"),n=r("XNiG"),i=r("1G5W"),s=r("HnnZ"),a=r("Kj3r"),c=function(t){return t.loading="loading",t.err="err",t}({}),b=r("HDdC"),d=r("quSY"),l=r("7Hc7"),m=r("jtHE"),u=r("7+OI"),p=r("LRne"),h=r("7HRe"),f=r("qgXg"),g=r("z6cu"),S=r("itXk"),v=r("bOdf"),O=r("zp1y"),_=r("IzEk"),R=r("lJxs"),y=r("/uUt"),C=r("UXun"),x=r("fXoL");function k(){return t=>new b.a(e=>{let r,o;const n=new d.a;return n.add(t.subscribe({complete:()=>{r&&e.next(o),e.complete()},error:t=>{e.error(t)},next:t=>{o=t,r||(r=l.a.schedule(()=>{e.next(o),r=void 0}),n.add(r))}})),n})}const j=new x.s("ComponentStore InitState");let F=(()=>{class t{constructor(t){this.destroySubject$=new m.a(1),this.destroy$=this.destroySubject$.asObservable(),this.stateSubject$=new m.a(1),this.isInitialized=!1,this.notInitializedErrorMessage=this.constructor.name+" has not been initialized yet. Please make sure it is initialized before updating/getting.",this.state$=this.select(t=>t),t&&this.initState(t)}ngOnDestroy(){this.stateSubject$.complete(),this.destroySubject$.next()}updater(t){return e=>{let r;const o=(Object(u.a)(e)?e:Object(p.a)(e)).pipe(Object(v.a)(t=>this.isInitialized?Object(h.a)([t],f.b).pipe(Object(O.a)(this.stateSubject$)):Object(g.a)(new Error(this.notInitializedErrorMessage))),Object(i.a)(this.destroy$)).subscribe({next:([e,r])=>{this.stateSubject$.next(t(r,e))},error:t=>{r=t,this.stateSubject$.error(t)}});if(r)throw r;return o}}initState(t){Object(h.a)([t],f.b).subscribe(t=>{this.isInitialized=!0,this.stateSubject$.next(t)})}setState(t){"function"!=typeof t?this.initState(t):this.updater(t)()}get(t){if(!this.isInitialized)throw new Error(this.notInitializedErrorMessage);let e;return this.stateSubject$.pipe(Object(_.a)(1)).subscribe(r=>{e=t?t(r):r}),e}select(...t){const{observables:e,projector:r,config:o}=function(t){const e=Array.from(t);let r,o={debounce:!1};const n=e.pop();return"function"!=typeof n?(o=Object.assign(Object.assign({},o),n),r=e.pop()):r=n,{observables:e,projector:r,config:o}}(t);let n;return n=0===e.length?this.stateSubject$.pipe(o.debounce?k():t=>t,Object(R.a)(r)):Object(S.b)(e).pipe(o.debounce?k():t=>t,Object(R.a)(t=>r(...t))),n.pipe(Object(y.a)(),Object(C.a)({refCount:!0,bufferSize:1}),Object(i.a)(this.destroy$))}effect(t){const e=new n.a;return t(e).pipe(Object(i.a)(this.destroy$)).subscribe(),t=>(Object(u.a)(t)?t:Object(p.a)(t)).pipe(Object(i.a)(this.destroy$)).subscribe(t=>{e.next(t)})}}return t.\u0275fac=function(e){return new(e||t)(x.Wb(j,8))},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac}),t})();var M=r("eIep"),B=r("vkgz"),z=r("JIr8"),N=function(t){return t.cdek="\u0441\u0434\u044d\u043a",t.post="\u043f\u043e\u0447\u0442\u0430",t.courier="\u043a\u0443\u0440\u044c\u0435\u0440",t}({}),w=function(t){return t.check="\u043f\u0440\u043e\u0431\u043d\u044b\u0439",t.subscription="\u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0430",t}({}),$=function(t){return t.twoThree="2-3",t.fourSix="4-6",t.sevenNine="7-9",t}({});const I={customer:{id:NaN,_id:NaN,name:"",contacts:{email:"",inst:"",phone:""},address:{city:"",address:""}},orders:[{id:NaN,_id:NaN,personId:NaN,sended:!1,shipmentDate:"",shipmentType:N.post,trackNumber:"",type:w.check,orderDate:"",orderStructure:{kits:[],theatres:[]},comment:""}],loadingState:null};var P=r("AytR"),T=r("tk/3");let D=(()=>{class t{constructor(t){this.http=t,this.formDataInitState={orders:[],customer:I.customer}}updateFormData(t){const e=localStorage.getItem("ntv-add-order-form-data");let r;return r=Object.assign(Object.assign({},e?JSON.parse(e):this.formDataInitState),t),localStorage.setItem("ntv-add-order-form-data",JSON.stringify(r)),Object(p.a)(r)}getFormData(){const t=localStorage.getItem("ntv-add-order-form-data"),e=t?JSON.parse(t):this.formDataInitState;return Object(p.a)(e)}getPersonsByName(t){return this.http.post(P.a.apiEndpoints.customersForAutocomplete,{name:t})}postOrders(t){return this.http.post(P.a.apiEndpoints.postOrders,t)}postCustomer(t){return this.http.post(P.a.apiEndpoints.postCustomer,t)}}return t.\u0275fac=function(e){return new(e||t)(x.Wb(T.a))},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var A=r("0IaG");let G=(()=>{class t extends F{constructor(t,e){super(I),this.addOrderService=t,this.dialog=e,this.saveForm=this.effect(t=>t.pipe(Object(M.a)(t=>{const e={},r=Array.isArray(t);return this.reqFormPending(),r?e.orders=t:e.customer=t,this.addOrderService.updateFormData(e).pipe(Object(B.a)(t=>{this.reqFormSuccess(t)}),Object(z.a)(t=>(this.reqFormError(),Object(g.a)(t))))}))),this.setFormData=this.effect(t=>t.pipe(Object(M.a)(()=>(this.reqFormPending(),this.addOrderService.getFormData().pipe(Object(B.a)(t=>{this.reqFormSuccess(t)}),Object(z.a)(t=>(this.reqFormError(),Object(g.a)(t)))))))),this.registerNewOrder=this.effect(t=>t.pipe(Object(M.a)(t=>(this.reqFormPending(),this.addOrderService.getPersonsByName(t.customer.name).pipe(Object(M.a)(e=>e.length?(t.orders.forEach(t=>{t.personId=e[0].id,t.id=Math.round(1e6*Math.random())}),this.addOrderService.postOrders(t.orders).pipe(Object(B.a)(()=>{this.resetState(),this.dialog.closeAll()}))):(t.customer.id=Math.round(1e6*Math.random()),t.orders.forEach(e=>{e.personId=t.customer.id,e.id=Math.round(1e6*Math.random())}),this.addOrderService.postCustomer(t.customer).pipe(Object(M.a)(()=>this.addOrderService.postOrders(t.orders).pipe(Object(B.a)(()=>{this.resetState(),this.dialog.closeAll()})))))),Object(z.a)(t=>(this.reqFormError(),Object(g.a)(t)))))))),this.resetState=this.updater(t=>I),this.reqFormPending=this.updater(t=>Object.assign(Object.assign({},t),{loadingState:c.loading})),this.reqFormSuccess=this.updater((t,e)=>Object.assign(Object.assign({},e),{loadingState:null})),this.reqFormError=this.updater(t=>Object.assign(Object.assign({},t),{loadingState:c.err}))}}return t.\u0275fac=function(e){return new(e||t)(x.Wb(D),x.Wb(A.b))},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac}),t})();var E=r("7EHt"),K=r("3Pt+"),Z=r("kmnG"),V=r("qFsG"),q=r("/1cH"),H=r("ofXK"),W=r("bTqV"),J=r("NFeN"),Q=r("FKr1");function X(t,e){if(1&t&&(x.Sb(0,"mat-option",14),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t.name," ")}}let U=(()=>{class t{constructor(t,e,r){this.fb=t,this.store=e,this.addOrderService=r,this.destroyer$$=new n.a,this.loadingStates=c,this.autocompleteOptions=[]}ngOnInit(){this.initForm(),this.loadingState$=this.store.select(t=>t.loadingState),this.initFormSetter(),this.initFormSaver(),this.initAutocomplete()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}setCustomerFromAutocomplete(t){this.store.saveForm(t.option.value)}resetForm(){this.store.saveForm(I.customer)}initForm(){this.addCustomerForm=this.fb.group({id:NaN,_id:"",name:"",contacts:this.fb.group({email:"",inst:"",phone:""}),address:this.fb.group({city:"",address:""})})}initFormSetter(){this.store.select(t=>t.customer).pipe(Object(i.a)(this.destroyer$$),Object(B.a)(t=>{this.isCustomersEqual(this.addCustomerForm.value,t)||(console.log(t),this.addCustomerForm.setValue(t))})).subscribe()}initFormSaver(){this.addCustomerForm.valueChanges.pipe(Object(i.a)(this.destroyer$$),Object(a.a)(500)).subscribe(t=>this.store.saveForm(t))}initAutocomplete(){var t;null===(t=this.addCustomerForm.get("name"))||void 0===t||t.valueChanges.pipe(Object(i.a)(this.destroyer$$),Object(a.a)(300),Object(M.a)(t=>this.addOrderService.getPersonsByName(t))).subscribe(t=>{this.autocompleteOptions=t})}isCustomersEqual(t,e){const r=this.getDeepValues(Object.values(t)),o=this.getDeepValues(Object.values(e));return r.every(t=>o.includes(t))}getDeepValues(t){return t.reduce((t,e)=>("object"!=typeof e||null===e?t.push(e):Array.isArray(e)?t.push(...this.getDeepValues(e)):t.push(...this.getDeepValues(Object.values(e))),t),[])}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(K.e),x.Mb(G),x.Mb(D))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-customer-form"]],decls:33,vars:3,consts:[[1,"form",3,"formGroup"],["appearance","standard"],["matInput","","formControlName","name",3,"matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","contacts",1,"form__group"],["matInput","","formControlName","email"],["matInput","","formControlName","inst"],["matInput","","formControlName","phone"],["formGroupName","address",1,"form__group"],["matInput","","formControlName","city"],["matInput","","formControlName","address"],["mat-icon-button","",3,"click"],[3,"value"]],template:function(t,e){if(1&t&&(x.Sb(0,"form",0),x.Sb(1,"mat-form-field",1),x.Sb(2,"mat-label"),x.zc(3,"\u0424\u0418\u041e"),x.Rb(),x.Nb(4,"input",2),x.Sb(5,"mat-autocomplete",3,4),x.Zb("optionSelected",function(t){return e.setCustomerFromAutocomplete(t)}),x.xc(7,X,2,2,"mat-option",5),x.Rb(),x.Rb(),x.Sb(8,"div",6),x.Sb(9,"mat-form-field",1),x.Sb(10,"mat-label"),x.zc(11,"E-mail"),x.Rb(),x.Nb(12,"input",7),x.Rb(),x.Sb(13,"mat-form-field",1),x.Sb(14,"mat-label"),x.zc(15,"\u0418\u043d\u0441\u0442\u0430\u0433\u0440\u0430\u043c"),x.Rb(),x.Nb(16,"input",8),x.Rb(),x.Sb(17,"mat-form-field",1),x.Sb(18,"mat-label"),x.zc(19,"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"),x.Rb(),x.Nb(20,"input",9),x.Rb(),x.Rb(),x.Sb(21,"div",10),x.Sb(22,"mat-form-field",1),x.Sb(23,"mat-label"),x.zc(24,"\u0413\u043e\u0440\u043e\u0434"),x.Rb(),x.Nb(25,"input",11),x.Rb(),x.Sb(26,"mat-form-field",1),x.Sb(27,"mat-label"),x.zc(28,"\u041e\u0441\u0442\u0430\u043b\u044c\u043d\u043e\u0439 \u0430\u0434\u0440\u0435\u0441"),x.Rb(),x.Nb(29,"input",12),x.Rb(),x.Sb(30,"button",13),x.Zb("click",function(){return e.resetForm()}),x.Sb(31,"mat-icon"),x.zc(32,"refresh"),x.Rb(),x.Rb(),x.Rb(),x.Rb()),2&t){const t=x.nc(6);x.ic("formGroup",e.addCustomerForm),x.Bb(4),x.ic("matAutocomplete",t),x.Bb(3),x.ic("ngForOf",e.autocompleteOptions)}},directives:[K.w,K.p,K.h,Z.c,Z.f,V.b,K.c,q.c,K.o,K.g,q.a,H.j,K.i,W.b,J.a,Q.n],styles:[".form[_ngcontent-%COMP%]{flex-direction:column;padding:16px 0}.form[_ngcontent-%COMP%], .form__group[_ngcontent-%COMP%]{display:flex;gap:16px}.form__loading-state[_ngcontent-%COMP%]{justify-self:flex-end;align-self:flex-end}.form__refresh-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 40px;grid-gap:16px}"]}),t})();var L=r("wZkO"),Y=r("G1Gu"),tt=r("f0Cb"),et=r("Wp6s"),rt=r("d3UM");function ot(t,e){if(1&t&&(x.Sb(0,"mat-option",15),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t," ")}}function nt(t,e){if(1&t){const t=x.Tb();x.Sb(0,"mat-card",10),x.Sb(1,"mat-form-field",11),x.Sb(2,"mat-label"),x.zc(3,"\u0441\u043a\u043e\u043b\u044c\u043a\u043e"),x.Rb(),x.Nb(4,"input",12),x.Rb(),x.Sb(5,"button",5),x.Zb("click",function(){x.pc(t);const r=e.index;return x.dc().removeKit(r)}),x.Sb(6,"mat-icon"),x.zc(7,"delete"),x.Rb(),x.Rb(),x.Sb(8,"mat-form-field",11),x.Sb(9,"mat-label"),x.zc(10,"\u0432\u043e\u0437\u0440\u0430\u0441\u0442"),x.Rb(),x.Sb(11,"mat-select",13),x.xc(12,ot,2,2,"mat-option",14),x.Rb(),x.Rb(),x.Rb()}if(2&t){const t=e.$implicit,r=x.dc();x.Bb(4),x.ic("formControl",r.getControl(t.get("count"))),x.Bb(7),x.ic("formControl",r.getControl(t.get("age"))),x.Bb(1),x.ic("ngForOf",r.ages)}}function it(t,e){if(1&t&&(x.Sb(0,"mat-option",17),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t," ")}}function st(t,e){if(1&t){const t=x.Tb();x.Sb(0,"mat-card",10),x.Sb(1,"mat-form-field",11),x.Sb(2,"mat-label"),x.zc(3,"\u0441\u043a\u043e\u043b\u044c\u043a\u043e"),x.Rb(),x.Nb(4,"input",12),x.Rb(),x.Sb(5,"button",5),x.Zb("click",function(){x.pc(t);const r=e.index;return x.dc().removeTheatre(r)}),x.Sb(6,"mat-icon"),x.zc(7,"delete"),x.Rb(),x.Rb(),x.Sb(8,"mat-form-field",11),x.Sb(9,"mat-label"),x.zc(10,"\u0432\u043e\u0437\u0440\u0430\u0441\u0442"),x.Rb(),x.Sb(11,"mat-select",13),x.xc(12,it,2,2,"mat-option",16),x.Rb(),x.Rb(),x.Rb()}if(2&t){const t=e.$implicit,r=x.dc();x.Bb(4),x.ic("formControl",r.getControl(t.get("count"))),x.Bb(7),x.ic("formControl",r.getControl(t.get("age"))),x.Bb(1),x.ic("ngForOf",r.ages)}}let at=(()=>{class t{constructor(t,e,r){this.dialogRef=t,this.order=e,this.fb=r,this.ages=Object.values($),this.initialKitGroupState={age:$.twoThree,count:0}}ngOnInit(){this.orderStructureForm=this.fb.group({orderStructure:this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}),this.setKitsAndTheatresControls(this.order)}get kits(){return this.orderStructureForm.get("orderStructure").get("kits")}get theatres(){return this.orderStructureForm.get("orderStructure").get("theatres")}setStructure(){this.dialogRef.close(this.orderStructureForm.value.orderStructure)}addKit(t){this.kits.push(this.fb.group(t))}addTheatre(t){this.theatres.push(this.fb.group(t))}removeKit(t){this.kits.removeAt(t)}removeTheatre(t){this.theatres.removeAt(t)}getControl(t){return t}setKitsAndTheatresControls(t){t.orderStructure.kits.forEach(t=>{this.addKit(t)}),t.orderStructure.theatres.forEach(t=>{this.addTheatre(t)})}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(A.d),x.Mb(A.a),x.Mb(K.e))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-add-order-structure-dialog"]],decls:24,vars:4,consts:[[1,"scrollbar"],[1,"form",3,"formGroup","ngSubmit"],["formGroupName","orderStructure",1,"form__block"],["formArrayName","kits",1,"form__array"],[1,"form__array-title"],["mat-icon-button","","type","button",3,"click"],["class","form__array-item",4,"ngFor","ngForOf"],[3,"vertical"],["formArrayName","theatres",1,"form__array"],["mat-raised-button",""],[1,"form__array-item"],["appearance","standard"],["type","number","matInput","",3,"formControl"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["name","dsfsd",3,"value",4,"ngFor","ngForOf"],["name","dsfsd",3,"value"]],template:function(t,e){1&t&&(x.Sb(0,"ng-scrollbar",0),x.Sb(1,"form",1),x.Zb("ngSubmit",function(){return e.setStructure()}),x.Sb(2,"h4"),x.zc(3,"\u0427\u0442\u043e \u0432\u0435\u0437\u0435\u043c"),x.Rb(),x.Sb(4,"div",2),x.Sb(5,"div",3),x.Sb(6,"div",4),x.Sb(7,"h6"),x.zc(8,"\u041d\u0430\u0431\u043e\u0440\u044b"),x.Rb(),x.Sb(9,"button",5),x.Zb("click",function(){return e.addKit(e.initialKitGroupState)}),x.Sb(10,"mat-icon"),x.zc(11,"add"),x.Rb(),x.Rb(),x.Rb(),x.xc(12,nt,13,3,"mat-card",6),x.Rb(),x.Nb(13,"mat-divider",7),x.Sb(14,"div",8),x.Sb(15,"div",4),x.Sb(16,"h6"),x.zc(17,"\u0422\u0435\u0430\u0442\u0440\u044b"),x.Rb(),x.Sb(18,"button",5),x.Zb("click",function(){return e.addTheatre(e.initialKitGroupState)}),x.Sb(19,"mat-icon"),x.zc(20,"add"),x.Rb(),x.Rb(),x.Rb(),x.xc(21,st,13,3,"mat-card",6),x.Rb(),x.Rb(),x.Sb(22,"button",9),x.zc(23,"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),x.Rb(),x.Rb(),x.Rb()),2&t&&(x.Bb(1),x.ic("formGroup",e.orderStructureForm),x.Bb(11),x.ic("ngForOf",e.kits.controls),x.Bb(1),x.ic("vertical",!0),x.Bb(8),x.ic("ngForOf",e.theatres.controls))},directives:[Y.a,K.w,K.p,K.h,K.i,K.d,W.b,J.a,H.j,tt.a,et.a,Z.c,Z.f,K.s,V.b,K.c,K.o,K.f,rt.a,Q.n],styles:["[_nghost-%COMP%]{display:block;min-width:500px;margin:-24px}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;height:100%;padding:16px;box-sizing:border-box}.form__block[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1px 1fr;grid-gap:16px;width:100%}.form__array[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.form__array-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 40px;grid-template-rows:repeat(auto-fill,41px);grid-gap:16px}.form__array-title[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.scrollbar[_ngcontent-%COMP%]{max-height:70vh}"]}),t})();var ct=r("Qw0g"),bt=r("e1Hi");function dt(t,e){1&t&&(x.Sb(0,"h4"),x.zc(1,"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0437\u0430\u043a\u0430\u0437\u044b"),x.Rb())}function lt(t,e){if(1&t&&(x.Sb(0,"mat-option",8),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t.date),x.Bb(1),x.Bc(" ",t.name," ")}}function mt(t,e){if(1&t&&(x.Sb(0,"mat-option",8),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t," ")}}function ut(t,e){if(1&t){const t=x.Tb();x.Sb(0,"mat-card",2),x.Sb(1,"mat-form-field",3),x.Sb(2,"mat-label"),x.zc(3,"\u041c\u0435\u0441\u044f\u0446"),x.Rb(),x.Sb(4,"mat-select",4),x.xc(5,lt,2,2,"mat-option",5),x.Rb(),x.Rb(),x.Sb(6,"mat-form-field",3),x.Sb(7,"mat-label"),x.zc(8,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),x.Rb(),x.Sb(9,"mat-select",4),x.xc(10,mt,2,2,"mat-option",5),x.Rb(),x.Rb(),x.Sb(11,"ntv-overlined",6),x.Zb("click",function(){x.pc(t);const r=e.$implicit;return x.dc().showOrderStructureDialog(r.value)}),x.Rb(),x.Sb(12,"mat-form-field",3),x.Sb(13,"mat-label"),x.zc(14,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),x.Rb(),x.Nb(15,"input",7),x.Rb(),x.Rb()}if(2&t){const t=e.$implicit,r=x.dc();x.Bb(4),x.ic("formControl",r.getControl(t.get("shipmentDate"))),x.Bb(1),x.ic("ngForOf",r.months),x.Bb(4),x.ic("formControl",r.getControl(t.get("shipmentType"))),x.Bb(1),x.ic("ngForOf",r.shipmentTypes),x.Bb(5),x.ic("formControl",r.getControl(t.get("comment")))}}let pt=(()=>{class t{constructor(t,e,r){this.fb=t,this.store=e,this.dialog=r,this.orders=[],this.months=ct.a,this.shipmentTypes=Object.values(N),this.destroyer$$=new n.a}ngOnInit(){this.ordersControls=this.fb.array([]),this.initFormSetter(),this.initFormSaver()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}showOrderStructureDialog(t){this.dialog.open(at,{data:t})}initFormSaver(){this.ordersControls.valueChanges.pipe(Object(i.a)(this.destroyer$$),Object(a.a)(500)).subscribe(t=>{this.store.saveForm(t)})}initFormSetter(){this.store.select(t=>t.orders).pipe(Object(i.a)(this.destroyer$$),Object(B.a)(t=>{t.length&&!this.isOrdersEqual(this.ordersControls.value,t)&&(this.ordersControls.clear(),t.forEach(t=>{this.addOrder(t)}))})).subscribe()}isOrdersEqual(t,e){if(t.length!==e.length)return!1;const r=this.getDeepValues(t),o=this.getDeepValues(e);return r.length===o.length&&r.every(t=>o.includes(t))}getDeepValues(t){return t.reduce((t,e)=>("object"!=typeof e||null===e?t.push(e):Array.isArray(e)?t.push(...this.getDeepValues(e)):t.push(...this.getDeepValues(Object.values(e))),t),[])}addOrder(t){this.ordersControls.push(this.fb.group(t))}getControl(t){return t}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(K.e),x.Mb(G),x.Mb(A.b))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-subscription-orders-form"]],inputs:{orders:"orders"},decls:2,vars:2,consts:[[4,"ngIf"],["class","array-item",4,"ngFor","ngForOf"],[1,"array-item"],["appearance","standard"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["overline","\u043d\u0430\u0431\u043e\u0440\u044b","value","\u041d\u0430\u0436\u043c\u0438",3,"click"],["matInput","",3,"formControl"],[3,"value"]],template:function(t,e){1&t&&(x.xc(0,dt,2,0,"h4",0),x.xc(1,ut,16,5,"mat-card",1)),2&t&&(x.ic("ngIf",e.ordersControls.length),x.Bb(1),x.ic("ngForOf",e.ordersControls.controls))},directives:[H.k,H.j,et.a,Z.c,Z.f,rt.a,K.o,K.f,bt.a,V.b,K.c,Q.n],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:16px}.array-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:16px}"]}),t})();function ht(t,e){if(1&t&&(x.Sb(0,"mat-option",8),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t.date),x.Bb(1),x.Bc(" ",t.name," ")}}function ft(t,e){if(1&t&&(x.Sb(0,"mat-option",8),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t," ")}}let gt=(()=>{class t{constructor(t,e,r){this.fb=t,this.store=e,this.dialog=r,this.shipmentTypes=Object.values(N),this.months=ct.a,this.destroyer$$=new n.a}ngOnInit(){this.addSubscriptionForm=this.fb.group({months:"",shipmentType:"",orderStructure:""}),this.initFormSetter(),this.initFormSaver()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}initFormSetter(){this.store.select(t=>t.orders).pipe(Object(i.a)(this.destroyer$$),Object(B.a)(t=>{if(t.length){const e={months:t.map(t=>t.shipmentDate),shipmentType:t[0].shipmentType,orderStructure:t[0].orderStructure||I.orders[0].orderStructure};this.isArraysEqual(Object.values(e),Object.values(this.addSubscriptionForm.value))||this.addSubscriptionForm.setValue(e)}})).subscribe()}initFormSaver(){this.addSubscriptionForm.valueChanges.pipe(Object(i.a)(this.destroyer$$),Object(a.a)(500)).subscribe(t=>{if(Array.isArray(t.months)){const e=t.months.map(e=>({id:I.orders[0].id,personId:I.orders[0].personId,comment:I.orders[0].comment,sended:I.orders[0].sended,shipmentDate:e,shipmentType:t.shipmentType,trackNumber:I.orders[0].trackNumber,type:w.subscription,orderStructure:t.orderStructure,orderDate:(new Date).toISOString()}));this.store.saveForm(e)}})}showOrderStructureSelectionDialog(){this.store.select(t=>t.orders[0]).pipe(Object(_.a)(1)).subscribe(t=>{this.dialog.open(at,{data:t}).afterClosed().subscribe(t=>{this.addSubscriptionForm.patchValue({orderStructure:t})})})}isArraysEqual(t,e){if(t.length!==e.length)return!1;const r=this.getDeepValues(t),o=this.getDeepValues(e);return r.length===o.length&&r.every(t=>o.includes(t))}getDeepValues(t){return t.reduce((t,e)=>("object"!=typeof e||null===e?t.push(e):Array.isArray(e)?t.push(...this.getDeepValues(e)):t.push(...this.getDeepValues(Object.values(e))),t),[])}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(K.e),x.Mb(G),x.Mb(A.b))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-subscription-form"]],decls:18,vars:3,consts:[[1,"scrollbar"],[1,"form-container"],[1,"form",3,"formGroup"],["appearance","standard"],["formControlName","months","multiple",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","shipmentType"],["mat-flat-button","",3,"click"],[3,"value"]],template:function(t,e){1&t&&(x.Sb(0,"ng-scrollbar",0),x.Sb(1,"div",1),x.Sb(2,"h4"),x.zc(3,"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0438\u0440\u0443\u0435\u043c \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0443"),x.Rb(),x.Sb(4,"form",2),x.Sb(5,"mat-form-field",3),x.Sb(6,"mat-label"),x.zc(7,"\u041c\u0435\u0441\u044f\u0446\u044b"),x.Rb(),x.Sb(8,"mat-select",4),x.xc(9,ht,2,2,"mat-option",5),x.Rb(),x.Rb(),x.Sb(10,"mat-form-field",3),x.Sb(11,"mat-label"),x.zc(12,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),x.Rb(),x.Sb(13,"mat-select",6),x.xc(14,ft,2,2,"mat-option",5),x.Rb(),x.Rb(),x.Sb(15,"button",7),x.Zb("click",function(){return e.showOrderStructureSelectionDialog()}),x.zc(16,"\u0421\u043e\u0441\u0442\u0430\u0432 \u0437\u0430\u043a\u0430\u0437\u0430"),x.Rb(),x.Rb(),x.Nb(17,"ntv-subscription-orders-form"),x.Rb(),x.Rb()),2&t&&(x.Bb(4),x.ic("formGroup",e.addSubscriptionForm),x.Bb(5),x.ic("ngForOf",e.months),x.Bb(5),x.ic("ngForOf",e.shipmentTypes))},directives:[Y.a,K.w,K.p,K.h,Z.c,Z.f,rt.a,K.o,K.g,H.j,W.b,pt,Q.n],styles:[".form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:16px;height:100%;box-sizing:border-box}.form__order-structure-selector[_ngcontent-%COMP%]{cursor:pointer}.form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding:16px}.scrollbar[_ngcontent-%COMP%]{max-height:50vh}"]}),t})();function St(t,e){if(1&t&&(x.Sb(0,"mat-option",17),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t.date),x.Bb(1),x.Bc(" ",t.name," ")}}function vt(t,e){if(1&t&&(x.Sb(0,"mat-option",17),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t," ")}}function Ot(t,e){if(1&t&&(x.Sb(0,"mat-option",17),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t," ")}}function _t(t,e){if(1&t){const t=x.Tb();x.Sb(0,"mat-card",18),x.Sb(1,"mat-form-field",3),x.Sb(2,"mat-label"),x.zc(3,"\u0441\u043a\u043e\u043b\u044c\u043a\u043e"),x.Rb(),x.Nb(4,"input",19),x.Rb(),x.Sb(5,"button",14),x.Zb("click",function(){x.pc(t);const r=e.index;return x.dc().removeKit(r)}),x.Sb(6,"mat-icon"),x.zc(7,"delete"),x.Rb(),x.Rb(),x.Sb(8,"mat-form-field",3),x.Sb(9,"mat-label"),x.zc(10,"\u0432\u043e\u0437\u0440\u0430\u0441\u0442"),x.Rb(),x.Sb(11,"mat-select",20),x.xc(12,Ot,2,2,"mat-option",8),x.Rb(),x.Rb(),x.Rb()}if(2&t){const t=e.$implicit,r=x.dc();x.Bb(4),x.ic("formControl",r.getControl(t.get("count"))),x.Bb(7),x.ic("formControl",r.getControl(t.get("age"))),x.Bb(1),x.ic("ngForOf",r.ages)}}function Rt(t,e){if(1&t&&(x.Sb(0,"mat-option",22),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t," ")}}function yt(t,e){if(1&t){const t=x.Tb();x.Sb(0,"mat-card",18),x.Sb(1,"mat-form-field",3),x.Sb(2,"mat-label"),x.zc(3,"\u0441\u043a\u043e\u043b\u044c\u043a\u043e"),x.Rb(),x.Nb(4,"input",19),x.Rb(),x.Sb(5,"button",14),x.Zb("click",function(){x.pc(t);const r=e.index;return x.dc().removeTheatre(r)}),x.Sb(6,"mat-icon"),x.zc(7,"delete"),x.Rb(),x.Rb(),x.Sb(8,"mat-form-field",3),x.Sb(9,"mat-label"),x.zc(10,"\u0432\u043e\u0437\u0440\u0430\u0441\u0442"),x.Rb(),x.Sb(11,"mat-select",20),x.xc(12,Rt,2,2,"mat-option",21),x.Rb(),x.Rb(),x.Rb()}if(2&t){const t=e.$implicit,r=x.dc();x.Bb(4),x.ic("formControl",r.getControl(t.get("count"))),x.Bb(7),x.ic("formControl",r.getControl(t.get("age"))),x.Bb(1),x.ic("ngForOf",r.ages)}}let Ct=(()=>{class t{constructor(t,e){this.fb=t,this.store=e,this.months=ct.a,this.ages=Object.values($),this.shipmentTypes=Object.values(N),this.initialKitGroupState={age:$.twoThree,count:0},this.destroyer$$=new n.a}get kits(){return this.addOrderForm.get("orderStructure").get("kits")}get theatres(){return this.addOrderForm.get("orderStructure").get("theatres")}ngOnInit(){this.addOrderForm=this.fb.group({id:I.orders[0].id,personId:I.orders[0].personId,comment:I.orders[0].comment,sended:I.orders[0].sended,shipmentDate:I.orders[0].shipmentDate,shipmentType:I.orders[0].shipmentType,trackNumber:I.orders[0].trackNumber,type:I.orders[0].type,orderStructure:this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}),this.initFormSetter(),this.initFormSaver()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}initFormSaver(){this.addOrderForm.valueChanges.pipe(Object(i.a)(this.destroyer$$),Object(a.a)(500)).subscribe(t=>{this.store.saveForm([t])})}initFormSetter(){this.store.select(t=>t.orders).pipe(Object(i.a)(this.destroyer$$),Object(B.a)(t=>{if(t[0]&&!this.isOrdersEqual(this.addOrderForm.value,t[0])){this.setKitsAndTheatresControls(t[0]);const e=Object.assign({},t[0]);delete e.orderStructure,e.type=w.check,this.addOrderForm.patchValue(e)}})).subscribe()}isOrdersEqual(t,e){const r=this.getDeepValues(Object.values(t)),o=this.getDeepValues(Object.values(e));return r.every(t=>o.includes(t))}getDeepValues(t){return t.reduce((t,e)=>("object"!=typeof e||null===e?t.push(e):Array.isArray(e)?t.push(...this.getDeepValues(e)):t.push(...this.getDeepValues(Object.values(e))),t),[])}addKit(t){this.kits.push(this.fb.group(t))}addTheatre(t){this.theatres.push(this.fb.group(t))}removeKit(t){this.kits.removeAt(t)}removeTheatre(t){this.theatres.removeAt(t)}getControl(t){return t}setKitsAndTheatresControls(t){t.orderStructure.kits.forEach(t=>{this.addKit(t)}),t.orderStructure.theatres.forEach(t=>{this.addTheatre(t)})}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(K.e),x.Mb(G))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-once-form"]],decls:45,vars:7,consts:[[1,"scrollbar"],[1,"form",3,"formGroup"],[1,"form__comment"],["appearance","standard"],["matInput","","formControlName","comment"],[1,"form__block"],[1,"select-card"],["formControlName","shipmentDate"],[3,"value",4,"ngFor","ngForOf"],[3,"vertical"],["formControlName","shipmentType"],["formGroupName","orderStructure",1,"form__block"],["formArrayName","kits",1,"form__array"],[1,"form__array-title"],["mat-icon-button","","type","button",3,"click"],["class","form__array-item",4,"ngFor","ngForOf"],["formArrayName","theatres",1,"form__array"],[3,"value"],[1,"form__array-item"],["type","number","matInput","",3,"formControl"],[3,"formControl"],["name","dsfsd",3,"value",4,"ngFor","ngForOf"],["name","dsfsd",3,"value"]],template:function(t,e){1&t&&(x.Sb(0,"ng-scrollbar",0),x.Sb(1,"form",1),x.Sb(2,"h4"),x.zc(3,"\u041e \u0437\u0430\u043a\u0430\u0437\u0435"),x.Rb(),x.Sb(4,"mat-card",2),x.Sb(5,"mat-form-field",3),x.Sb(6,"mat-label"),x.zc(7,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),x.Rb(),x.Nb(8,"textarea",4),x.Rb(),x.Rb(),x.Sb(9,"h4"),x.zc(10,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),x.Rb(),x.Sb(11,"div",5),x.Sb(12,"mat-card",6),x.Sb(13,"mat-form-field",3),x.Sb(14,"mat-label"),x.zc(15,"\u0414\u0430\u0442\u0430"),x.Rb(),x.Sb(16,"mat-select",7),x.xc(17,St,2,2,"mat-option",8),x.Rb(),x.Rb(),x.Rb(),x.Nb(18,"mat-divider",9),x.Sb(19,"mat-card",6),x.Sb(20,"mat-form-field",3),x.Sb(21,"mat-label"),x.zc(22,"\u0422\u0438\u043f"),x.Rb(),x.Sb(23,"mat-select",10),x.xc(24,vt,2,2,"mat-option",8),x.Rb(),x.Rb(),x.Rb(),x.Rb(),x.Sb(25,"h4"),x.zc(26,"\u0427\u0442\u043e \u0432\u0435\u0437\u0435\u043c"),x.Rb(),x.Sb(27,"div",11),x.Sb(28,"div",12),x.Sb(29,"div",13),x.Sb(30,"h6"),x.zc(31,"\u041d\u0430\u0431\u043e\u0440\u044b"),x.Rb(),x.Sb(32,"button",14),x.Zb("click",function(){return e.addKit(e.initialKitGroupState)}),x.Sb(33,"mat-icon"),x.zc(34,"add"),x.Rb(),x.Rb(),x.Rb(),x.xc(35,_t,13,3,"mat-card",15),x.Rb(),x.Nb(36,"mat-divider",9),x.Sb(37,"div",16),x.Sb(38,"div",13),x.Sb(39,"h6"),x.zc(40,"\u0422\u0435\u0430\u0442\u0440\u044b"),x.Rb(),x.Sb(41,"button",14),x.Zb("click",function(){return e.addTheatre(e.initialKitGroupState)}),x.Sb(42,"mat-icon"),x.zc(43,"add"),x.Rb(),x.Rb(),x.Rb(),x.xc(44,yt,13,3,"mat-card",15),x.Rb(),x.Rb(),x.Rb(),x.Rb()),2&t&&(x.Bb(1),x.ic("formGroup",e.addOrderForm),x.Bb(16),x.ic("ngForOf",e.months),x.Bb(1),x.ic("vertical",!0),x.Bb(6),x.ic("ngForOf",e.shipmentTypes),x.Bb(11),x.ic("ngForOf",e.kits.controls),x.Bb(1),x.ic("vertical",!0),x.Bb(8),x.ic("ngForOf",e.theatres.controls))},directives:[Y.a,K.w,K.p,K.h,et.a,Z.c,Z.f,V.b,K.c,K.o,K.g,rt.a,H.j,tt.a,K.i,K.d,W.b,J.a,Q.n,K.s,K.f],styles:["[_nghost-%COMP%]{display:block;min-width:500px}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;height:100%;padding:16px;box-sizing:border-box}.form__block[_ngcontent-%COMP%]{grid-template-columns:1fr 1px 1fr;grid-gap:16px}.form__block[_ngcontent-%COMP%], .form__comment[_ngcontent-%COMP%]{display:grid;width:100%}.form__array[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.form__array-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 40px;grid-template-rows:repeat(auto-fill,41px);grid-gap:16px}.form__array-title[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.scrollbar[_ngcontent-%COMP%]{max-height:50vh}.select-card[_ngcontent-%COMP%]{display:grid}"]}),t})();function xt(t,e){1&t&&x.Nb(0,"ntv-subscription-form",4)}function kt(t,e){1&t&&x.Nb(0,"ntv-once-form",4)}let jt=(()=>{class t{constructor(t){this.store=t}ngOnInit(){this.orders$=this.store.select(t=>t.orders)}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(G))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-order-form"]],decls:5,vars:0,consts:[["mat-stretch-tabs",""],["label","\u041f\u043e\u0434\u043f\u0438\u0441\u043a\u0430"],["matTabContent",""],["label","\u041f\u0440\u043e\u0431\u043d\u044b\u0439"],[1,"tabs__tab"]],template:function(t,e){1&t&&(x.Sb(0,"mat-tab-group",0),x.Sb(1,"mat-tab",1),x.xc(2,xt,1,0,"ng-template",2),x.Rb(),x.Sb(3,"mat-tab",3),x.xc(4,kt,1,0,"ng-template",2),x.Rb(),x.Rb())},directives:[L.c,L.a,L.b,gt,Ct],styles:["[_nghost-%COMP%]{display:block;margin:0 -24px -16px}.tabs__tab[_ngcontent-%COMP%]{min-height:50vh;display:block}"]}),t})();var Ft=r("4Kj8");function Mt(t,e){1&t&&(x.Sb(0,"span",5),x.zc(1," \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c... "),x.Nb(2,"ntv-spinner",6),x.Rb()),2&t&&(x.Bb(2),x.ic("diameter",16))}function Bt(t,e){1&t&&(x.Sb(0,"span",5),x.zc(1," \u041e\u0448\u0438\u0431\u043a\u0430, \u043d\u0430\u0436\u043c\u0438 \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0441\u043d\u043e\u0432\u0430 "),x.Sb(2,"mat-icon",7),x.zc(3,"error"),x.Rb(),x.Rb())}function zt(t,e){1&t&&(x.Qb(0),x.zc(1," \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u043a\u0430\u0437 "),x.Pb())}function Nt(t,e){if(1&t){const t=x.Tb();x.Qb(0),x.Sb(1,"button",2),x.Zb("click",function(){x.pc(t);const r=e.ngIf;return x.dc().registerNewOrder(r)}),x.ec(2,"async"),x.xc(3,Mt,3,1,"span",3),x.xc(4,Bt,4,0,"span",3),x.xc(5,zt,2,0,"ng-container",4),x.Rb(),x.Pb()}if(2&t){const t=x.dc();x.Bb(1),x.ic("ngSwitch",x.fc(2,3,t.loadingState$)),x.Bb(2),x.ic("ngSwitchCase",t.loadingStates.loading),x.Bb(1),x.ic("ngSwitchCase",t.loadingStates.err)}}let wt=(()=>{class t{constructor(t){this.store=t,this.loadingStates=c}ngOnInit(){this.store.setFormData(),this.loadingState$=this.store.select(t=>t.loadingState).pipe(Object(a.a)(200)),this.state$=this.store.select(t=>t)}registerNewOrder(t){this.store.registerNewOrder(t)}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(G))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-add-order-dialog"]],features:[x.Ab([G])],decls:13,vars:3,consts:[["hideToggle",""],[4,"ngIf"],["mat-raised-button","",1,"submit-button",3,"ngSwitch","click"],["class","submit-button__content",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"submit-button__content"],[1,"submit-button__spinner",3,"diameter"],[1,"submit-button__error-icon"]],template:function(t,e){1&t&&(x.Sb(0,"mat-accordion"),x.Sb(1,"mat-expansion-panel",0),x.Sb(2,"mat-expansion-panel-header"),x.Sb(3,"mat-panel-title"),x.zc(4," \u041a\u043b\u0438\u0435\u043d\u0442 "),x.Rb(),x.Rb(),x.Nb(5,"ntv-customer-form"),x.Rb(),x.Sb(6,"mat-expansion-panel",0),x.Sb(7,"mat-expansion-panel-header"),x.Sb(8,"mat-panel-title"),x.zc(9," \u0417\u0430\u043a\u0430\u0437 "),x.Rb(),x.Rb(),x.Nb(10,"ntv-order-form"),x.Rb(),x.Rb(),x.xc(11,Nt,6,5,"ng-container",1),x.ec(12,"async")),2&t&&(x.Bb(11),x.ic("ngIf",x.fc(12,1,e.state$)))},directives:[E.a,E.c,E.f,E.g,U,jt,H.k,W.b,H.m,H.n,H.o,Ft.a,J.a],pipes:[H.b],styles:["[_nghost-%COMP%]{flex-direction:column;gap:16px}.submit-button__content[_ngcontent-%COMP%], [_nghost-%COMP%]{display:flex;align-items:center}.submit-button__spinner[_ngcontent-%COMP%]{margin-top:0;margin-left:8px}.submit-button__error-icon[_ngcontent-%COMP%]{margin-left:8px}"]}),t})();var $t=r("l7P3"),It=r("dlKe");let Pt=(()=>{class t{constructor(t,e,r){this.data=t,this.fb=e,this.store=r}ngOnInit(){this.editPersonForm=this.fb.group({name:this.data.person.name,email:this.data.person.contacts.email||"",inst:this.data.person.contacts.inst||"",phone:this.data.person.contacts.phone||"",city:this.data.person.address.city,address:this.data.person.address.address})}patchPerson(){var t,e,r,o,n,i;const a={id:this.data.person.id,_id:this.data.person._id,name:null===(t=this.editPersonForm.get("name"))||void 0===t?void 0:t.value,contacts:{email:null===(e=this.editPersonForm.get("email"))||void 0===e?void 0:e.value,inst:null===(r=this.editPersonForm.get("inst"))||void 0===r?void 0:r.value,phone:null===(o=this.editPersonForm.get("phone"))||void 0===o?void 0:o.value},address:{city:null===(n=this.editPersonForm.get("city"))||void 0===n?void 0:n.value,address:null===(i=this.editPersonForm.get("address"))||void 0===i?void 0:i.value}};this.store.dispatch(s.a.patchPending({customer:a}))}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(A.a),x.Mb(K.e),x.Mb($t.h))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-edit-person-dialog"]],decls:27,vars:1,consts:[[1,"form",3,"formGroup","ngSubmit"],["appearance","standard"],["matInput","","formControlName","name"],["matInput","","formControlName","email"],["matInput","","formControlName","inst"],["matInput","","formControlName","phone"],["matInput","","formControlName","city"],["matInput","","formControlName","address"],["mat-flat-button","","type","submit"]],template:function(t,e){1&t&&(x.Sb(0,"form",0),x.Zb("ngSubmit",function(){return e.patchPerson()}),x.Sb(1,"mat-form-field",1),x.Sb(2,"mat-label"),x.zc(3,"\u0424\u0418\u041e"),x.Rb(),x.Nb(4,"input",2),x.Rb(),x.Sb(5,"mat-form-field",1),x.Sb(6,"mat-label"),x.zc(7,"E-mail"),x.Rb(),x.Nb(8,"input",3),x.Rb(),x.Sb(9,"mat-form-field",1),x.Sb(10,"mat-label"),x.zc(11,"\u0418\u043d\u0441\u0442\u0430\u0433\u0440\u0430\u043c"),x.Rb(),x.Nb(12,"input",4),x.Rb(),x.Sb(13,"mat-form-field",1),x.Sb(14,"mat-label"),x.zc(15,"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"),x.Rb(),x.Nb(16,"input",5),x.Rb(),x.Sb(17,"mat-form-field",1),x.Sb(18,"mat-label"),x.zc(19,"\u0413\u043e\u0440\u043e\u0434"),x.Rb(),x.Nb(20,"input",6),x.Rb(),x.Sb(21,"mat-form-field",1),x.Sb(22,"mat-label"),x.zc(23,"\u041e\u0441\u0442\u0430\u043b\u044c\u043d\u043e\u0439 \u0430\u0434\u0440\u0435\u0441"),x.Rb(),x.Nb(24,"input",7),x.Rb(),x.Sb(25,"button",8),x.zc(26,"\u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c"),x.Rb(),x.Rb()),2&t&&x.ic("formGroup",e.editPersonForm)},directives:[K.w,K.p,K.h,Z.c,Z.f,V.b,K.c,K.o,K.g,W.b],styles:["[_nghost-%COMP%]{display:block;min-width:500px}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}"]}),t})();var Tt=r("dNgK");let Dt=(()=>{class t{constructor(t){this.snack=t}clip(t){navigator.clipboard.writeText(t.toString()).then(()=>{this.snack.open("\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430",void 0,{duration:2e3})}).catch(t=>{this.snack.open("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043a\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0432 \u0431\u0443\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430",void 0,{duration:2e3})})}}return t.\u0275fac=function(e){return new(e||t)(x.Wb(Tt.a))},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),At=(()=>{class t{constructor(t){this.http=t}getOrders(t){return this.http.post(P.a.apiEndpoints.getOrdersById,{personId:t})}patchOrder(t){return this.http.post(P.a.apiEndpoints.patchOrder,t)}}return t.\u0275fac=function(e){return new(e||t)(x.Wb(T.a))},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Gt=(()=>{class t extends F{constructor(t){super(Et),this.ordersService=t,this.getOrders=this.effect(t=>t.pipe(Object(M.a)(t=>(this.addOrdersPending(),this.ordersService.getOrders(t).pipe(Object(B.a)(t=>{console.log(t),this.addOrdersSuccess(t)}),Object(z.a)(t=>(this.addOrdersError(),Object(g.a)(t)))))))),this.patchOrder=this.updater((t,e)=>{const r=t.orders.slice();return r[r.findIndex(t=>t.id===e.id)]=Object.assign({},e),Object.assign(Object.assign({},t),{orders:r})}),this.addOrdersPending=this.updater(t=>Object.assign(Object.assign({},t),{loading:!0})),this.addOrdersSuccess=this.updater((t,e)=>({orders:[...t.orders,...e],loading:!1,err:!1})),this.addOrdersError=this.updater(t=>Object.assign(Object.assign({},t),{err:!0,loading:!1}))}}return t.\u0275fac=function(e){return new(e||t)(x.Wb(At))},t.\u0275prov=x.Ib({token:t,factory:t.\u0275fac}),t})();const Et={orders:[],loading:!1,err:!1};var Kt=r("wJZa");let Zt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-kit"]],inputs:{kit:"kit"},decls:3,vars:6,consts:[[3,"overline","value"]],template:function(t,e){1&t&&(x.Nb(0,"ntv-overlined",0),x.Nb(1,"ntv-overlined",0),x.ec(2,"numberToString")),2&t&&(x.ic("overline","\u0432\u043e\u0437\u0440\u0430\u0441\u0442")("value",e.kit.age),x.Bb(1),x.ic("overline","\u0441\u043a\u043e\u043b\u044c\u043a\u043e")("value",x.fc(2,4,e.kit.count)))},directives:[bt.a],pipes:[Kt.a],styles:["[_nghost-%COMP%]{display:flex;gap:16px}"]}),t})();function Vt(t,e){1&t&&x.Nb(0,"ntv-kit",4),2&t&&x.ic("kit",e.$implicit)}function qt(t,e){1&t&&x.Nb(0,"ntv-kit",4),2&t&&x.ic("kit",e.$implicit)}let Ht=(()=>{class t{constructor(t){this.data=t}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(A.a))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-order-structure-dialog"]],decls:9,vars:3,consts:[[1,"kits"],[3,"kit",4,"ngFor","ngForOf"],[3,"vertical"],[1,"theatres"],[3,"kit"]],template:function(t,e){1&t&&(x.Sb(0,"div",0),x.Sb(1,"h6"),x.zc(2,"\u041d\u0430\u0431\u043e\u0440\u044b"),x.Rb(),x.xc(3,Vt,1,1,"ntv-kit",1),x.Rb(),x.Nb(4,"mat-divider",2),x.Sb(5,"div",3),x.Sb(6,"h6"),x.zc(7,"\u0422\u0435\u0430\u0442\u0440\u044b"),x.Rb(),x.xc(8,qt,1,1,"ntv-kit",1),x.Rb()),2&t&&(x.Bb(3),x.ic("ngForOf",e.data.orderStructure.kits),x.Bb(1),x.ic("vertical",!0),x.Bb(4),x.ic("ngForOf",e.data.orderStructure.theatres))},directives:[H.j,tt.a,Zt],styles:["[_nghost-%COMP%]{display:grid;grid-template-columns:1fr 1px 1fr;grid-template-rows:repeat(auto-fill,100px);grid-gap:16px}"]}),t})();var Wt=r("bSwM");function Jt(t,e){if(1&t&&(x.Sb(0,"mat-option",22),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t," ")}}function Qt(t,e){if(1&t&&(x.Sb(0,"mat-option",22),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t.date),x.Bb(1),x.Bc(" ",t.name," ")}}function Xt(t,e){if(1&t&&(x.Sb(0,"mat-option",22),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t," ")}}function Ut(t,e){if(1&t&&(x.Sb(0,"mat-option",22),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t," ")}}function Lt(t,e){if(1&t){const t=x.Tb();x.Sb(0,"mat-card",23),x.Sb(1,"mat-form-field",4),x.Sb(2,"mat-label"),x.zc(3,"\u0441\u043a\u043e\u043b\u044c\u043a\u043e"),x.Rb(),x.Nb(4,"input",24),x.Rb(),x.Sb(5,"button",16),x.Zb("click",function(){x.pc(t);const r=e.index;return x.dc().removeKit(r)}),x.Sb(6,"mat-icon"),x.zc(7,"delete"),x.Rb(),x.Rb(),x.Sb(8,"mat-form-field",4),x.Sb(9,"mat-label"),x.zc(10,"\u0432\u043e\u0437\u0440\u0430\u0441\u0442"),x.Rb(),x.Sb(11,"mat-select",25),x.xc(12,Ut,2,2,"mat-option",10),x.Rb(),x.Rb(),x.Rb()}if(2&t){const t=e.$implicit,r=x.dc();x.Bb(4),x.ic("formControl",r.getControl(t.get("count"))),x.Bb(7),x.ic("formControl",r.getControl(t.get("age"))),x.Bb(1),x.ic("ngForOf",r.ages)}}function Yt(t,e){if(1&t&&(x.Sb(0,"mat-option",27),x.zc(1),x.Rb()),2&t){const t=e.$implicit;x.ic("value",t),x.Bb(1),x.Bc(" ",t," ")}}function te(t,e){if(1&t){const t=x.Tb();x.Sb(0,"mat-card",23),x.Sb(1,"mat-form-field",4),x.Sb(2,"mat-label"),x.zc(3,"\u0441\u043a\u043e\u043b\u044c\u043a\u043e"),x.Rb(),x.Nb(4,"input",24),x.Rb(),x.Sb(5,"button",16),x.Zb("click",function(){x.pc(t);const r=e.index;return x.dc().removeTheatre(r)}),x.Sb(6,"mat-icon"),x.zc(7,"delete"),x.Rb(),x.Rb(),x.Sb(8,"mat-form-field",4),x.Sb(9,"mat-label"),x.zc(10,"\u0432\u043e\u0437\u0440\u0430\u0441\u0442"),x.Rb(),x.Sb(11,"mat-select",25),x.xc(12,Yt,2,2,"mat-option",26),x.Rb(),x.Rb(),x.Rb()}if(2&t){const t=e.$implicit,r=x.dc();x.Bb(4),x.ic("formControl",r.getControl(t.get("count"))),x.Bb(7),x.ic("formControl",r.getControl(t.get("age"))),x.Bb(1),x.ic("ngForOf",r.ages)}}function ee(t,e){1&t&&(x.Sb(0,"span",28),x.zc(1," \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c... "),x.Nb(2,"ntv-spinner",29),x.Rb()),2&t&&(x.Bb(2),x.ic("diameter",16))}function re(t,e){1&t&&(x.Sb(0,"span",28),x.zc(1," \u041e\u0448\u0438\u0431\u043a\u0430, \u043d\u0430\u0436\u043c\u0438 \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0441\u043d\u043e\u0432\u0430 "),x.Sb(2,"mat-icon",30),x.zc(3,"error"),x.Rb(),x.Rb())}function oe(t,e){1&t&&(x.Qb(0),x.zc(1," \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c "),x.Pb())}let ne=(()=>{class t{constructor(t,e,r,o){this.dialogRef=t,this.order=e,this.fb=r,this.ordersService=o,this.loadingStates=c,this.months=ct.a,this.ages=Object.values($),this.orderTypes=Object.values(w),this.shipmentTypes=Object.values(N),this.initialKitGroupState={age:$.twoThree,count:0}}get kits(){return this.editOrderForm.get("orderStructure").get("kits")}get theatres(){return this.editOrderForm.get("orderStructure").get("theatres")}ngOnInit(){this.editOrderForm=this.fb.group({comment:this.order.comment,sended:this.order.sended,shipmentDate:this.order.shipmentDate,shipmentType:this.order.shipmentType,trackNumber:this.order.trackNumber,type:this.order.type,orderStructure:this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}),this.initKitsAndTheatresControls()}patchOrder(){const t=Object.assign({id:this.order.id,personId:this.order.personId},this.editOrderForm.value);this.loadingState=this.loadingStates.loading,this.ordersService.patchOrder(t).pipe(Object(B.a)(t=>{this.loadingState=null,this.dialogRef.close(t)}),Object(z.a)(t=>(this.loadingState=this.loadingStates.err,Object(g.a)(t)))).subscribe()}addKit(t){this.kits.push(this.fb.group(t))}addTheatre(t){this.theatres.push(this.fb.group(t))}removeKit(t){this.kits.removeAt(t)}removeTheatre(t){this.theatres.removeAt(t)}getControl(t){return t}initKitsAndTheatresControls(){this.order.orderStructure.kits.forEach(t=>{this.addKit(t)}),this.order.orderStructure.theatres.forEach(t=>{this.addTheatre(t)})}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(A.d),x.Mb(A.a),x.Mb(K.e),x.Mb(At))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-edit-order-dialog"]],decls:61,vars:12,consts:[[1,"scrollbar"],[1,"form",3,"formGroup","ngSubmit"],[1,"form__block"],[1,"select-card"],["appearance","standard"],["matInput","","formControlName","comment"],[3,"vertical"],[1,"form__block-colomn"],["formControlName","sended"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],["formControlName","shipmentDate"],["formControlName","shipmentType"],["formGroupName","orderStructure",1,"form__block"],["formArrayName","kits",1,"form__array"],[1,"form__array-title"],["mat-icon-button","","type","button",3,"click"],["class","form__array-item",4,"ngFor","ngForOf"],["formArrayName","theatres",1,"form__array"],["mat-raised-button","","type","submit",1,"submit-button",3,"ngSwitch"],["class","submit-button__content",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"value"],[1,"form__array-item"],["type","number","matInput","",3,"formControl"],[3,"formControl"],["name","dsfsd",3,"value",4,"ngFor","ngForOf"],["name","dsfsd",3,"value"],[1,"submit-button__content"],[1,"submit-button__spinner",3,"diameter"],[1,"submit-button__error-icon"]],template:function(t,e){1&t&&(x.Sb(0,"ng-scrollbar",0),x.Sb(1,"form",1),x.Zb("ngSubmit",function(){return e.patchOrder()}),x.Sb(2,"h4"),x.zc(3,"\u041e \u0437\u0430\u043a\u0430\u0437\u0435"),x.Rb(),x.Sb(4,"div",2),x.Sb(5,"mat-card",3),x.Sb(6,"mat-form-field",4),x.Sb(7,"mat-label"),x.zc(8,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),x.Rb(),x.Nb(9,"textarea",5),x.Rb(),x.Rb(),x.Nb(10,"mat-divider",6),x.Sb(11,"div",7),x.Sb(12,"mat-card",3),x.Sb(13,"mat-checkbox",8),x.zc(14,"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e"),x.Rb(),x.Rb(),x.Sb(15,"mat-card",3),x.Sb(16,"mat-form-field",4),x.Sb(17,"mat-label"),x.zc(18,"\u0422\u0438\u043f"),x.Rb(),x.Sb(19,"mat-select",9),x.xc(20,Jt,2,2,"mat-option",10),x.Rb(),x.Rb(),x.Rb(),x.Rb(),x.Rb(),x.Sb(21,"h4"),x.zc(22,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),x.Rb(),x.Sb(23,"div",2),x.Sb(24,"mat-card",3),x.Sb(25,"mat-form-field",4),x.Sb(26,"mat-label"),x.zc(27,"\u0414\u0430\u0442\u0430"),x.Rb(),x.Sb(28,"mat-select",11),x.xc(29,Qt,2,2,"mat-option",10),x.Rb(),x.Rb(),x.Rb(),x.Nb(30,"mat-divider",6),x.Sb(31,"mat-card",3),x.Sb(32,"mat-form-field",4),x.Sb(33,"mat-label"),x.zc(34,"\u0422\u0438\u043f"),x.Rb(),x.Sb(35,"mat-select",12),x.xc(36,Xt,2,2,"mat-option",10),x.Rb(),x.Rb(),x.Rb(),x.Rb(),x.Sb(37,"h4"),x.zc(38,"\u0427\u0442\u043e \u0432\u0435\u0437\u0435\u043c"),x.Rb(),x.Sb(39,"div",13),x.Sb(40,"div",14),x.Sb(41,"div",15),x.Sb(42,"h6"),x.zc(43,"\u041d\u0430\u0431\u043e\u0440\u044b"),x.Rb(),x.Sb(44,"button",16),x.Zb("click",function(){return e.addKit(e.initialKitGroupState)}),x.Sb(45,"mat-icon"),x.zc(46,"add"),x.Rb(),x.Rb(),x.Rb(),x.xc(47,Lt,13,3,"mat-card",17),x.Rb(),x.Nb(48,"mat-divider",6),x.Sb(49,"div",18),x.Sb(50,"div",15),x.Sb(51,"h6"),x.zc(52,"\u0422\u0435\u0430\u0442\u0440\u044b"),x.Rb(),x.Sb(53,"button",16),x.Zb("click",function(){return e.addTheatre(e.initialKitGroupState)}),x.Sb(54,"mat-icon"),x.zc(55,"add"),x.Rb(),x.Rb(),x.Rb(),x.xc(56,te,13,3,"mat-card",17),x.Rb(),x.Rb(),x.Sb(57,"button",19),x.xc(58,ee,3,1,"span",20),x.xc(59,re,4,0,"span",20),x.xc(60,oe,2,0,"ng-container",21),x.Rb(),x.Rb(),x.Rb()),2&t&&(x.Bb(1),x.ic("formGroup",e.editOrderForm),x.Bb(9),x.ic("vertical",!0),x.Bb(10),x.ic("ngForOf",e.orderTypes),x.Bb(9),x.ic("ngForOf",e.months),x.Bb(1),x.ic("vertical",!0),x.Bb(6),x.ic("ngForOf",e.shipmentTypes),x.Bb(11),x.ic("ngForOf",e.kits.controls),x.Bb(1),x.ic("vertical",!0),x.Bb(8),x.ic("ngForOf",e.theatres.controls),x.Bb(1),x.ic("ngSwitch",e.loadingState),x.Bb(1),x.ic("ngSwitchCase",e.loadingStates.loading),x.Bb(1),x.ic("ngSwitchCase",e.loadingStates.err))},directives:[Y.a,K.w,K.p,K.h,et.a,Z.c,Z.f,V.b,K.c,K.o,K.g,tt.a,Wt.a,rt.a,H.j,K.i,K.d,W.b,J.a,H.m,H.n,H.o,Q.n,K.s,K.f,Ft.a],styles:["[_nghost-%COMP%]{display:block;min-width:500px;margin:-24px}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;width:100%;height:100%;padding:16px}.form__block[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1px 1fr;grid-gap:16px;width:100%}.form__block-colomn[_ngcontent-%COMP%]{width:100%}.form__array[_ngcontent-%COMP%], .form__block-colomn[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.form__array-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 40px;grid-template-rows:repeat(auto-fill,41px);grid-gap:16px}.form__array-title[_ngcontent-%COMP%]{gap:16px}.form__array-title[_ngcontent-%COMP%], .submit-button__content[_ngcontent-%COMP%]{display:flex;align-items:center}.submit-button__spinner[_ngcontent-%COMP%]{margin-top:0;margin-left:8px}.submit-button__error-icon[_ngcontent-%COMP%]{margin-left:8px}.scrollbar[_ngcontent-%COMP%]{max-height:90vh}.select-card[_ngcontent-%COMP%]{display:grid}"]}),t})();function ie(t,e){if(1&t){const t=x.Tb();x.Sb(0,"ntv-overlined",16),x.Zb("click",function(){return x.pc(t),x.dc().showOrderStructureDialog()}),x.Rb()}2&t&&x.ic("overline","\u043d\u0430\u0431\u043e\u0440\u044b")("value","\u043d\u0430\u0436\u043c\u0438 \u0434\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430")}function se(t,e){if(1&t&&(x.Qb(0),x.Nb(1,"ntv-overlined",18),x.Nb(2,"ntv-kit",19),x.Pb()),2&t){const t=x.dc(2);x.Bb(2),x.ic("kit",t.order.orderStructure.kits[0])}}function ae(t,e){if(1&t&&(x.Qb(0),x.Nb(1,"ntv-overlined",20),x.Nb(2,"ntv-kit",19),x.Pb()),2&t){const t=x.dc(2);x.Bb(2),x.ic("kit",t.order.orderStructure.theatres[0])}}function ce(t,e){if(1&t&&(x.xc(0,se,3,1,"ng-container",17),x.xc(1,ae,3,1,"ng-container",17)),2&t){const t=x.dc();x.ic("ngIf",t.order.orderStructure.kits.length),x.Bb(1),x.ic("ngIf",t.order.orderStructure.theatres.length)}}function be(t,e){1&t&&(x.Sb(0,"span"),x.zc(1,"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."),x.Rb())}function de(t,e){1&t&&(x.Sb(0,"span"),x.zc(1,"\u041e\u0448\u0438\u0431\u043a\u0430"),x.Rb())}function le(t,e){1&t&&(x.Sb(0,"span"),x.zc(1,"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e"),x.Rb())}function me(t,e){if(1&t){const t=x.Tb();x.Sb(0,"mat-icon",21),x.Zb("click",function(){x.pc(t);const e=x.dc();return e.clipService.clip(e.trackControl.value)}),x.zc(1," copy "),x.Rb()}}function ue(t,e){1&t&&x.Nb(0,"ntv-spinner",22),2&t&&x.ic("diameter",16)}function pe(t,e){1&t&&(x.Sb(0,"mat-icon",23),x.zc(1," error "),x.Rb())}let he=(()=>{class t{constructor(t,e,r,o,i){this.dialog=t,this.fb=e,this.ordersStore=r,this.ordersService=o,this.clipService=i,this.controlStates=c,this.sendMarkerControlValueChanger=new n.a,this.destroyer$$=new n.a}get moreThanOneKit(){const t=this.order.orderStructure.kits.length,e=this.order.orderStructure.theatres.length;return t>1||e>1||t>0&&e>0}ngOnInit(){this.sendMarkerControl=this.fb.control(this.order.sended),this.trackControl=this.fb.control(this.order.trackNumber),this.trackControlChangesHandler().subscribe(),this.sendMarkerControlChangesHandler().subscribe()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}showOrderStructureDialog(){this.dialog.open(Ht,{data:{orderStructure:this.order.orderStructure}})}showEditor(){this.dialog.open(ne,{data:this.order}).afterClosed().subscribe(t=>{t&&this.ordersStore.patchOrder(t)})}trackControlChangesHandler(){return this.trackControl.valueChanges.pipe(Object(i.a)(this.destroyer$$),Object(B.a)(()=>{this.trackControlState=this.controlStates.loading}),Object(a.a)(500),Object(M.a)(t=>this.ordersService.patchOrder(Object.assign(Object.assign({},this.order),{trackNumber:t})).pipe(Object(B.a)(t=>{this.ordersStore.patchOrder(t),this.trackControlState=null}),Object(z.a)(t=>(this.trackControlState=this.controlStates.err,t)))))}sendMarkerControlChangesHandler(){return this.sendMarkerControlValueChanger.pipe(Object(i.a)(this.destroyer$$),Object(B.a)(()=>{this.sendMarkerControlState=this.controlStates.loading}),Object(a.a)(500),Object(M.a)(t=>this.ordersService.patchOrder(Object.assign(Object.assign({},this.order),{sended:t})).pipe(Object(B.a)(t=>{this.ordersStore.patchOrder(t),this.sendMarkerControl.setValue(t.sended),this.sendMarkerControlState=null}),Object(z.a)(t=>(this.sendMarkerControlState=this.controlStates.err,t)))))}changeSended(t){this.sendMarkerControlValueChanger.next(t)}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(A.b),x.Mb(K.e),x.Mb(Gt),x.Mb(At),x.Mb(Dt))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-person-order"]],inputs:{order:"order"},decls:24,vars:18,consts:[[1,"order"],[1,"order__data"],[3,"overline","value"],["class","order__kits",3,"overline","value","click",4,"ngIf","ngIfElse"],["oneKit",""],["color","accent",3,"formControl","click"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["appearance","standard",1,"order__track"],["matInput","",3,"formControl"],["matSuffix","","class","order__track-copy-icon",3,"click",4,"ngIf"],["matSuffix","","class","order__track-control-spinner",3,"diameter",4,"ngIf"],["title","\u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u0445, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437","matSuffix","",4,"ngIf"],[1,"order__comment",3,"overline","value"],["mat-icon-button","",1,"order__edit",3,"click"],[1,"order__kits",3,"overline","value","click"],[4,"ngIf"],["overline","\u0447\u0442\u043e \u043f\u0440\u0438\u0432\u0435\u0437\u0442\u0438","value","\u043d\u0430\u0431\u043e\u0440"],[3,"kit"],["overline","\u0447\u0442\u043e \u043f\u0440\u0438\u0432\u0435\u0437\u0442\u0438","value","\u0442\u0435\u0430\u0442\u0440"],["matSuffix","",1,"order__track-copy-icon",3,"click"],["matSuffix","",1,"order__track-control-spinner",3,"diameter"],["title","\u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u0445, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437","matSuffix",""]],template:function(t,e){if(1&t&&(x.Sb(0,"mat-card",0),x.Sb(1,"div",1),x.Nb(2,"ntv-overlined",2),x.Nb(3,"ntv-overlined",2),x.Nb(4,"ntv-overlined",2),x.xc(5,ie,1,2,"ntv-overlined",3),x.xc(6,ce,2,2,"ng-template",null,4,x.yc),x.Sb(8,"mat-checkbox",5),x.Zb("click",function(t){return t.preventDefault(),e.changeSended(!e.sendMarkerControl.value)}),x.Qb(9,6),x.xc(10,be,2,0,"span",7),x.xc(11,de,2,0,"span",7),x.xc(12,le,2,0,"span",8),x.Pb(),x.Rb(),x.Sb(13,"mat-form-field",9),x.Sb(14,"mat-label"),x.zc(15,"\u0442\u0440\u0435\u043a"),x.Rb(),x.Nb(16,"input",10),x.xc(17,me,2,0,"mat-icon",11),x.xc(18,ue,1,1,"ntv-spinner",12),x.xc(19,pe,2,0,"mat-icon",13),x.Rb(),x.Rb(),x.Nb(20,"ntv-overlined",14),x.Sb(21,"button",15),x.Zb("click",function(){return e.showEditor()}),x.Sb(22,"mat-icon"),x.zc(23,"edit"),x.Rb(),x.Rb(),x.Rb()),2&t){const t=x.nc(7);x.Bb(2),x.ic("overline","\u0442\u0438\u043f \u0437\u0430\u043a\u0430\u0437\u0430")("value",e.order.type),x.Bb(1),x.ic("overline","\u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")("value",e.order.shipmentDate),x.Bb(1),x.ic("overline","\u043f\u043e\u0432\u0435\u0437\u0435\u0442")("value",e.order.shipmentType||"\u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d"),x.Bb(1),x.ic("ngIf",e.moreThanOneKit)("ngIfElse",t),x.Bb(3),x.ic("formControl",e.sendMarkerControl),x.Bb(1),x.ic("ngSwitch",e.sendMarkerControlState),x.Bb(1),x.ic("ngSwitchCase","loading"),x.Bb(1),x.ic("ngSwitchCase","err"),x.Bb(5),x.ic("formControl",e.trackControl),x.Bb(1),x.ic("ngIf","loading"!==e.trackControlState&&"err"!==e.trackControlState),x.Bb(1),x.ic("ngIf","loading"===e.trackControlState),x.Bb(1),x.ic("ngIf","err"===e.trackControlState),x.Bb(1),x.ic("overline","\u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439")("value",e.order.comment||"\u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d")}},directives:[et.a,bt.a,H.k,Wt.a,K.o,K.f,H.m,H.n,H.o,Z.c,Z.f,V.b,K.c,W.b,J.a,Zt,Z.g,Ft.a],styles:['[_nghost-%COMP%]{display:block}.order[_ngcontent-%COMP%]{display:grid;grid-template-areas:"data edit" "comment comment";grid-template-columns:1fr 40px;grid-template-rows:auto auto;grid-gap:8px}.order__data[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;grid-area:data}.order__comment[_ngcontent-%COMP%]{grid-area:comment}.order__edit[_ngcontent-%COMP%]{grid-area:edit}.order__kits[_ngcontent-%COMP%]{cursor:pointer}.order__track-control-spinner[_ngcontent-%COMP%]{margin-top:16px}.order__track-copy-icon[_ngcontent-%COMP%]{cursor:pointer}']}),t})();function fe(t,e){1&t&&x.Nb(0,"ntv-person-order",4),2&t&&x.ic("order",e.$implicit)}function ge(t,e){1&t&&(x.Sb(0,"p"),x.zc(1,"\u0423 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0435\u0442 \u0437\u0430\u043a\u0430\u0437\u043e\u0432"),x.Rb())}function Se(t,e){if(1&t){const t=x.Tb();x.Sb(0,"p"),x.zc(1,"\u041e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 "),x.Sb(2,"span",5),x.Zb("click",function(){return x.pc(t),x.dc(2).getOrders()}),x.zc(3,"\u0435\u0449\u0435 \u0440\u0430\u0437"),x.Rb(),x.Rb()}}function ve(t,e){1&t&&x.Nb(0,"ntv-spinner",6),2&t&&x.ic("diameter",24)}function Oe(t,e){if(1&t&&(x.Qb(0),x.Sb(1,"mat-accordion"),x.xc(2,fe,1,1,"ntv-person-order",1),x.xc(3,ge,2,0,"p",0),x.Rb(),x.xc(4,Se,4,0,"p",0),x.Nb(5,"div",2),x.xc(6,ve,1,1,"ntv-spinner",3),x.Pb()),2&t){const t=e.ngIf;x.Bb(2),x.ic("ngForOf",t.orders),x.Bb(1),x.ic("ngIf",!t.orders.length&&!t.err&&!t.loading),x.Bb(1),x.ic("ngIf",t.err),x.Bb(2),x.ic("ngIf",t.loading)}}let _e=(()=>{class t{constructor(t){this.ordersStore=t}ngOnInit(){this.state$=this.ordersStore.select(t=>t),this.getOrders()}getOrders(){this.ordersStore.getOrders(this.personId)}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(Gt))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-person-orders"]],inputs:{personId:"personId"},features:[x.Ab([Gt])],decls:2,vars:3,consts:[[4,"ngIf"],["class","order",3,"order",4,"ngFor","ngForOf"],["if",""],[3,"diameter",4,"ngIf"],[1,"order",3,"order"],[1,"text-button",3,"click"],[3,"diameter"]],template:function(t,e){1&t&&(x.xc(0,Oe,7,4,"ng-container",0),x.ec(1,"async")),2&t&&x.ic("ngIf",x.fc(1,1,e.state$))},directives:[H.k,E.a,H.j,he,Ft.a],pipes:[H.b],styles:[".text-button[_ngcontent-%COMP%]{color:red;cursor:pointer}.order[_ngcontent-%COMP%]{margin-bottom:8px}"]}),t})();function Re(t,e){if(1&t){const t=x.Tb();x.Sb(0,"div",6),x.Zb("click",function(){x.pc(t);const r=e.$implicit;return x.dc().clipService.clip(r.value)}),x.Sb(1,"div",7),x.zc(2),x.Rb(),x.Sb(3,"div",8),x.zc(4),x.Rb(),x.Rb()}if(2&t){const t=e.$implicit;x.Bb(2),x.Bc(" ",t.name," "),x.Bb(2),x.Bc(" ",t.value," ")}}function ye(t,e){if(1&t){const t=x.Tb();x.Sb(0,"div",9),x.Sb(1,"h6",10),x.zc(2,"\u0410\u0434\u0440\u0435\u0441"),x.Rb(),x.Sb(3,"ntv-overlined",11),x.Zb("click",function(){x.pc(t);const e=x.dc();return e.clipService.clip(e.person.address.city)}),x.Rb(),x.Sb(4,"ntv-overlined",12),x.Zb("click",function(){x.pc(t);const e=x.dc();return e.clipService.clip(e.person.address.address)}),x.Rb(),x.Rb(),x.Sb(5,"h6"),x.zc(6,"\u0417\u0430\u043a\u0430\u0437\u044b"),x.Rb(),x.Nb(7,"ntv-person-orders",13)}if(2&t){const t=x.dc();x.Bb(3),x.ic("value",t.person.address.city||"\u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d"),x.Bb(1),x.ic("value",t.person.address.address||"\u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d"),x.Bb(3),x.ic("personId",t.person.id)}}let Ce=(()=>{class t{constructor(t,e){this.clipService=t,this.dialog=e}ngOnInit(){this.contactItems=[{name:"\u041f\u043e\u0447\u0442\u0430",value:this.person.contacts.email||"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d"},{name:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",value:this.person.contacts.phone||"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d"},{name:"\u0418\u043d\u0441\u0442\u0430\u0433\u0440\u0430\u043c",value:this.person.contacts.inst||"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d"}]}showEditor(){this.dialog.open(Pt,{data:{person:this.person}})}}return t.\u0275fac=function(e){return new(e||t)(x.Mb(Dt),x.Mb(A.b))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-person"]],inputs:{person:"person"},decls:10,vars:2,consts:[[1,"person"],[1,"person__title",3,"click"],[1,"person__description",3,"click"],["class","person__contact",3,"click",4,"ngFor","ngForOf"],["mat-icon-button","",3,"click"],["matExpansionPanelContent",""],[1,"person__contact",3,"click"],[1,"overline"],[1,"person__contact-value"],[1,"person__address"],[1,"person__address-title"],["overline","\u0433\u043e\u0440\u043e\u0434",1,"person__address-item",3,"value","click"],["overline","\u043e\u0441\u0442\u0430\u043b\u044c\u043d\u043e\u0435",1,"person__address-item",3,"value","click"],[3,"personId"]],template:function(t,e){1&t&&(x.Sb(0,"mat-expansion-panel",0),x.Sb(1,"mat-expansion-panel-header"),x.Sb(2,"mat-panel-title",1),x.Zb("click",function(t){return t.stopPropagation(),e.clipService.clip(e.person.name)}),x.zc(3),x.Rb(),x.Sb(4,"mat-panel-description",2),x.Zb("click",function(t){return t.stopPropagation()}),x.xc(5,Re,5,2,"div",3),x.Sb(6,"button",4),x.Zb("click",function(){return e.showEditor()}),x.Sb(7,"mat-icon"),x.zc(8,"edit"),x.Rb(),x.Rb(),x.Rb(),x.Rb(),x.xc(9,ye,8,3,"ng-template",5),x.Rb()),2&t&&(x.Bb(3),x.Bc(" ",e.person.name," "),x.Bb(2),x.ic("ngForOf",e.contactItems))},directives:[E.c,E.f,E.g,E.e,H.j,W.b,J.a,E.d,bt.a,_e],styles:['[_nghost-%COMP%]{display:block;overflow:hidden}.person__title[_ngcontent-%COMP%]{min-width:200px;max-width:200px}.person__description[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr) auto;grid-gap:16px}.person__address[_ngcontent-%COMP%]{display:grid;grid-template-areas:"title title" "item item";grid-template-columns:auto auto;grid-template-rows:auto auto}.person__address-title[_ngcontent-%COMP%]{grid-area:title}.person__address-item[_ngcontent-%COMP%]{cursor:pointer}.person.mat-expansion-panel[_ngcontent-%COMP%]{border-radius:0!important}']}),t})();function xe(t,e){1&t&&x.Nb(0,"ntv-person",8),2&t&&x.ic("person",e.$implicit)}function ke(t,e){if(1&t&&(x.Sb(0,"mat-accordion",6),x.xc(1,xe,1,1,"ntv-person",7),x.Rb()),2&t){const t=x.dc().ngIf;x.Bb(1),x.ic("ngForOf",t.customers)}}function je(t,e){1&t&&(x.Sb(0,"p",6),x.zc(1,"\u041e\u0448\u0438\u0431\u043a\u0430"),x.Rb())}function Fe(t,e){1&t&&x.Nb(0,"ntv-spinner")}function Me(t,e){if(1&t){const t=x.Tb();x.Sb(0,"ng-scrollbar",2),x.Sb(1,"div",3),x.Zb("scrolled",function(){return x.pc(t),x.dc().getMoreCustomers()}),x.xc(2,ke,2,1,"mat-accordion",4),x.xc(3,je,2,0,"p",4),x.xc(4,Fe,1,0,"ntv-spinner",5),x.Rb(),x.Rb()}if(2&t){const t=e.ngIf;x.Bb(1),x.ic("scrollWindow",!1),x.Bb(1),x.ic("ngIf",t.customers.length),x.Bb(1),x.ic("ngIf",t.err),x.Bb(1),x.ic("ngIf",t.loading)}}const Be=[{path:"",component:(()=>{class t{constructor(t,e){this.store=t,this.dialog=e,this.destroyer$$=new n.a}ngOnInit(){this.state=this.store.select("customers"),this.state.pipe(Object(i.a)(this.destroyer$$)).subscribe(t=>{this.length=t.customers.length}),this.store.dispatch(s.a.setPending({start:0,limit:50}))}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}getMoreCustomers(){this.store.dispatch(s.a.setPending({start:this.length,limit:10}))}showAddOrderDialog(){this.dialog.open(wt)}}return t.\u0275fac=function(e){return new(e||t)(x.Mb($t.h),x.Mb(A.b))},t.\u0275cmp=x.Gb({type:t,selectors:[["ntv-people"]],decls:5,vars:3,consts:[["class","scrollbar",4,"ngIf"],["mat-fab","",1,"add-order",3,"click"],[1,"scrollbar"],["infiniteScroll","","scrollViewport","",3,"scrollWindow","scrolled"],["class","scrollbar__content",4,"ngIf"],[4,"ngIf"],[1,"scrollbar__content"],[3,"person",4,"ngFor","ngForOf"],[3,"person"]],template:function(t,e){1&t&&(x.xc(0,Me,5,4,"ng-scrollbar",0),x.ec(1,"async"),x.Sb(2,"button",1),x.Zb("click",function(){return e.showAddOrderDialog()}),x.Sb(3,"mat-icon"),x.zc(4,"add"),x.Rb(),x.Rb()),2&t&&x.ic("ngIf",x.fc(1,1,e.state))},directives:[H.k,W.b,J.a,Y.a,It.a,Y.c,E.a,H.j,Ce,Ft.a],pipes:[H.b],styles:["[_nghost-%COMP%]{display:block}.scrollbar[_ngcontent-%COMP%]{max-height:calc(100vh - 64px);min-height:calc(100vh - 64px)}.scrollbar__content[_ngcontent-%COMP%]{padding:16px}.sc[_ngcontent-%COMP%]{height:2rem}.add-order[_ngcontent-%COMP%]{position:fixed;right:24px;bottom:24px;z-index:2}"]}),t})()}];let ze=(()=>{class t{}return t.\u0275mod=x.Kb({type:t}),t.\u0275inj=x.Jb({factory:function(e){return new(e||t)},imports:[[o.i.forChild(Be)],o.i]}),t})();var Ne=r("PCNd");let we=(()=>{class t{}return t.\u0275mod=x.Kb({type:t}),t.\u0275inj=x.Jb({factory:function(e){return new(e||t)},imports:[[ze,Ne.a]]}),t})()}}]);