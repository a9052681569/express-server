(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"06u4":function(t,e,r){"use strict";r.r(e),r.d(e,"AddOrderModule",function(){return ut});var o=r("PCNd"),i=r("tyNb"),s=r("Kj3r"),n=r("hgo/"),a=r("ufcJ"),c=r("z6cu"),b=r("eIep"),m=r("vkgz"),d=r("JIr8"),l=r("Wcn/"),u=r("groK"),p=r("fXoL"),f=r("SuJO"),h=r("dNgK");let g=(()=>{class t extends a.a{constructor(t,e){super(u.a),this.addOrderService=t,this.snack=e,this.saveForm=this.effect(t=>t.pipe(Object(b.a)(t=>(this.reqFormPending(),this.addOrderService.updateFormData(t).pipe(Object(m.a)(t=>{this.reqFormSuccess(t)}),Object(d.a)(t=>(this.reqFormError(),Object(c.a)(t)))))))),this.setFormData=this.effect(t=>t.pipe(Object(b.a)(()=>(this.reqFormPending(),this.addOrderService.getFormData().pipe(Object(m.a)(t=>{this.reqFormSuccess(t)}),Object(d.a)(t=>(this.reqFormError(),Object(c.a)(t)))))))),this.registerNewOrder=this.effect(t=>t.pipe(Object(b.a)(t=>{let e;return this.reqFormPending(),console.log("\u043d\u0430\u0447\u0438\u043d\u0430\u0435\u043c \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c"),t.orderType===l.b.subscription?e=t.subscriptionsOrders:t.orderType===l.b.check&&(e=[t.onceOrder]),this.addOrderService.getPersonsByName(t.customer.name).pipe(Object(b.a)(r=>r.length?(e.forEach(t=>{t.personId=r[0].id}),this.addOrderService.postOrders(e).pipe(Object(m.a)(()=>{this.resetState(),this.addOrderService.resetFormData(),this.snack.open("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0437\u0430\u043a\u0430\u0437",void 0,{duration:3e3})}))):this.addOrderService.postCustomer(t.customer).pipe(Object(b.a)(([t])=>(e.forEach(e=>{e.personId=t.id}),this.addOrderService.postOrders(e).pipe(Object(m.a)(()=>{this.resetState(),this.addOrderService.resetFormData(),this.snack.open("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0437\u0430\u043a\u0430\u0437 \u0438 \u043d\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",void 0,{duration:3e3})})))))),Object(d.a)(t=>(this.reqFormError(),Object(c.a)(t))))}))),this.resetState=this.updater(t=>Object.assign(Object.assign({},u.a),{resetForm:!0})),this.reqFormPending=this.updater(t=>Object.assign(Object.assign({},t),{loadingState:n.a.loading})),this.reqFormSuccess=this.updater((t,e)=>Object.assign(Object.assign(Object.assign({},t),e),{loadingState:null})),this.reqFormError=this.updater(t=>Object.assign(Object.assign({},t),{loadingState:n.a.err}))}}return t.\u0275fac=function(e){return new(e||t)(p.Wb(f.a),p.Wb(h.a))},t.\u0275prov=p.Ib({token:t,factory:t.\u0275fac}),t})();var S=r("G1Gu"),O=r("wZkO"),v=r("XNiG"),R=r("IzEk"),y=r("1G5W"),F=r("0IaG"),C=r("3Pt+"),_=r("bTqV"),x=r("NFeN"),j=r("ofXK"),z=r("f0Cb"),$=r("Wp6s"),B=r("kmnG"),k=r("qFsG"),N=r("d3UM"),M=r("FKr1");function T(t,e){if(1&t&&(p.Sb(0,"mat-option",15),p.zc(1),p.Rb()),2&t){const t=e.$implicit;p.ic("value",t),p.Bb(1),p.Bc(" ",t," ")}}function w(t,e){if(1&t){const t=p.Tb();p.Sb(0,"mat-card",10),p.Sb(1,"mat-form-field",11),p.Sb(2,"mat-label"),p.zc(3,"\u0441\u043a\u043e\u043b\u044c\u043a\u043e"),p.Rb(),p.Nb(4,"input",12),p.Rb(),p.Sb(5,"button",5),p.Zb("click",function(){p.pc(t);const r=e.index;return p.dc().removeKit(r)}),p.Sb(6,"mat-icon"),p.zc(7,"delete"),p.Rb(),p.Rb(),p.Sb(8,"mat-form-field",11),p.Sb(9,"mat-label"),p.zc(10,"\u0432\u043e\u0437\u0440\u0430\u0441\u0442"),p.Rb(),p.Sb(11,"mat-select",13),p.xc(12,T,2,2,"mat-option",14),p.Rb(),p.Rb(),p.Rb()}if(2&t){const t=e.$implicit,r=p.dc();p.Bb(4),p.ic("formControl",r.getControl(t.get("count"))),p.Bb(7),p.ic("formControl",r.getControl(t.get("age"))),p.Bb(1),p.ic("ngForOf",r.ages)}}function P(t,e){if(1&t&&(p.Sb(0,"mat-option",17),p.zc(1),p.Rb()),2&t){const t=e.$implicit;p.ic("value",t),p.Bb(1),p.Bc(" ",t," ")}}function I(t,e){if(1&t){const t=p.Tb();p.Sb(0,"mat-card",10),p.Sb(1,"mat-form-field",11),p.Sb(2,"mat-label"),p.zc(3,"\u0441\u043a\u043e\u043b\u044c\u043a\u043e"),p.Rb(),p.Nb(4,"input",12),p.Rb(),p.Sb(5,"button",5),p.Zb("click",function(){p.pc(t);const r=e.index;return p.dc().removeTheatre(r)}),p.Sb(6,"mat-icon"),p.zc(7,"delete"),p.Rb(),p.Rb(),p.Sb(8,"mat-form-field",11),p.Sb(9,"mat-label"),p.zc(10,"\u0432\u043e\u0437\u0440\u0430\u0441\u0442"),p.Rb(),p.Sb(11,"mat-select",13),p.xc(12,P,2,2,"mat-option",16),p.Rb(),p.Rb(),p.Rb()}if(2&t){const t=e.$implicit,r=p.dc();p.Bb(4),p.ic("formControl",r.getControl(t.get("count"))),p.Bb(7),p.ic("formControl",r.getControl(t.get("age"))),p.Bb(1),p.ic("ngForOf",r.ages)}}let G=(()=>{class t{constructor(t,e,r){this.dialogRef=t,this.order=e,this.fb=r,this.ages=Object.values(l.a),this.initialKitGroupState={age:l.a.twoThree,count:1}}ngOnInit(){this.orderStructureForm=this.fb.group({orderStructure:this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}),this.setKitsAndTheatresControls(this.order)}get kits(){return this.orderStructureForm.get("orderStructure").get("kits")}get theatres(){return this.orderStructureForm.get("orderStructure").get("theatres")}setStructure(){this.dialogRef.close(this.orderStructureForm.value.orderStructure)}addKit(t){this.kits.push(this.fb.group(t))}addTheatre(t){this.theatres.push(this.fb.group(t))}removeKit(t){this.kits.removeAt(t)}removeTheatre(t){this.theatres.removeAt(t)}getControl(t){return t}setKitsAndTheatresControls(t){var e,r,o,i;null===(r=null===(e=t.orderStructure)||void 0===e?void 0:e.kits)||void 0===r||r.forEach(t=>{this.addKit(t)}),null===(i=null===(o=t.orderStructure)||void 0===o?void 0:o.theatres)||void 0===i||i.forEach(t=>{this.addTheatre(t)})}}return t.\u0275fac=function(e){return new(e||t)(p.Mb(F.d),p.Mb(F.a),p.Mb(C.e))},t.\u0275cmp=p.Gb({type:t,selectors:[["ntv-add-order-structure-dialog"]],decls:24,vars:4,consts:[[1,"scrollbar"],[1,"form",3,"formGroup","ngSubmit"],["formGroupName","orderStructure",1,"form__block"],["formArrayName","kits",1,"form__array"],[1,"form__array-title"],["mat-icon-button","","type","button",3,"click"],["class","form__array-item",4,"ngFor","ngForOf"],[3,"vertical"],["formArrayName","theatres",1,"form__array"],["mat-raised-button",""],[1,"form__array-item"],["appearance","standard"],["type","number","matInput","",3,"formControl"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["name","dsfsd",3,"value",4,"ngFor","ngForOf"],["name","dsfsd",3,"value"]],template:function(t,e){1&t&&(p.Sb(0,"ng-scrollbar",0),p.Sb(1,"form",1),p.Zb("ngSubmit",function(){return e.setStructure()}),p.Sb(2,"h4"),p.zc(3,"\u0427\u0442\u043e \u0432\u0435\u0437\u0435\u043c"),p.Rb(),p.Sb(4,"div",2),p.Sb(5,"div",3),p.Sb(6,"div",4),p.Sb(7,"h6"),p.zc(8,"\u041d\u0430\u0431\u043e\u0440\u044b"),p.Rb(),p.Sb(9,"button",5),p.Zb("click",function(){return e.addKit(e.initialKitGroupState)}),p.Sb(10,"mat-icon"),p.zc(11,"add"),p.Rb(),p.Rb(),p.Rb(),p.xc(12,w,13,3,"mat-card",6),p.Rb(),p.Nb(13,"mat-divider",7),p.Sb(14,"div",8),p.Sb(15,"div",4),p.Sb(16,"h6"),p.zc(17,"\u0422\u0435\u0430\u0442\u0440\u044b"),p.Rb(),p.Sb(18,"button",5),p.Zb("click",function(){return e.addTheatre(e.initialKitGroupState)}),p.Sb(19,"mat-icon"),p.zc(20,"add"),p.Rb(),p.Rb(),p.Rb(),p.xc(21,I,13,3,"mat-card",6),p.Rb(),p.Rb(),p.Sb(22,"button",9),p.zc(23,"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),p.Rb(),p.Rb(),p.Rb()),2&t&&(p.Bb(1),p.ic("formGroup",e.orderStructureForm),p.Bb(11),p.ic("ngForOf",e.kits.controls),p.Bb(1),p.ic("vertical",!0),p.Bb(8),p.ic("ngForOf",e.theatres.controls))},directives:[S.a,C.v,C.o,C.h,C.i,C.d,_.a,x.a,j.j,z.a,$.a,B.c,B.f,C.r,k.b,C.c,C.n,C.f,N.a,M.n],styles:["[_nghost-%COMP%]{display:block;min-width:500px;margin:-24px}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;height:100%;padding:16px;box-sizing:border-box}.form__block[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1px 1fr;grid-gap:16px;width:100%}.form__array[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.form__array-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 40px;grid-template-rows:repeat(auto-fill,41px);grid-gap:16px}.form__array-title[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.scrollbar[_ngcontent-%COMP%]{max-height:70vh}"]}),t})();var D=r("Qw0g"),K=r("e1Hi");function A(t,e){1&t&&(p.Sb(0,"h4"),p.zc(1,"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0437\u0430\u043a\u0430\u0437\u044b"),p.Rb())}function Z(t,e){if(1&t&&(p.Sb(0,"mat-option",8),p.zc(1),p.Rb()),2&t){const t=e.$implicit;p.ic("value",t.date),p.Bb(1),p.Bc(" ",t.name," ")}}function q(t,e){if(1&t&&(p.Sb(0,"mat-option",8),p.zc(1),p.Rb()),2&t){const t=e.$implicit;p.ic("value",t),p.Bb(1),p.Bc(" ",t," ")}}function E(t,e){if(1&t){const t=p.Tb();p.Sb(0,"mat-card",2),p.Sb(1,"mat-form-field",3),p.Sb(2,"mat-label"),p.zc(3,"\u041c\u0435\u0441\u044f\u0446"),p.Rb(),p.Sb(4,"mat-select",4),p.xc(5,Z,2,2,"mat-option",5),p.Rb(),p.Rb(),p.Sb(6,"mat-form-field",3),p.Sb(7,"mat-label"),p.zc(8,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),p.Rb(),p.Sb(9,"mat-select",4),p.xc(10,q,2,2,"mat-option",5),p.Rb(),p.Rb(),p.Sb(11,"ntv-overlined",6),p.Zb("click",function(){p.pc(t);const r=e.$implicit,o=e.index;return p.dc().showOrderStructureDialog(r.value,o)}),p.Rb(),p.Sb(12,"mat-form-field",3),p.Sb(13,"mat-label"),p.zc(14,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),p.Rb(),p.Nb(15,"input",7),p.Rb(),p.Rb()}if(2&t){const t=e.$implicit,r=p.dc();p.Bb(4),p.ic("formControl",r.getControl(t.get("shipmentDate"))),p.Bb(1),p.ic("ngForOf",r.months),p.Bb(4),p.ic("formControl",r.getControl(t.get("shipmentType"))),p.Bb(1),p.ic("ngForOf",r.shipmentTypes),p.Bb(5),p.ic("formControl",r.getControl(t.get("comment")))}}let L=(()=>{class t{constructor(t,e,r){this.fb=t,this.store=e,this.dialog=r,this.orders=[],this.months=D.a,this.shipmentTypes=Object.values(l.c),this.destroyer$$=new v.a}ngOnInit(){this.ordersControls=this.fb.array([]),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}showOrderStructureDialog(t,e){this.dialog.open(G,{data:t}).afterClosed().subscribe(r=>{if(r){const o=this.fb.group(Object.assign(Object.assign({},t),{orderStructure:r}));this.ordersControls.setControl(e,o)}})}initFormSaver(){this.ordersControls.valueChanges.pipe(Object(y.a)(this.destroyer$$),Object(s.a)(500)).subscribe(t=>{this.store.saveForm({subscriptionsOrders:t})})}initFormSetter(){this.store.select(t=>t.subscriptionsOrders).pipe(Object(y.a)(this.destroyer$$),Object(m.a)(t=>{t.length&&!this.isOrdersEqual(t,this.ordersControls.value)&&(this.ordersControls.clear(),t.forEach(t=>{this.addOrder(t)}))})).subscribe()}initResetListener(){this.store.select(t=>t.resetForm).pipe(Object(y.a)(this.destroyer$$),Object(m.a)(t=>{t&&this.ordersControls.clear()})).subscribe()}isOrdersEqual(t,e){if(t.length!==e.length)return!1;const r=this.getDeepValues(t),o=this.getDeepValues(e);return r.length===o.length&&r.every(t=>o.includes(t))}getDeepValues(t){return t.reduce((t,e)=>("object"!=typeof e||null===e?t.push(e):Array.isArray(e)?t.push(...this.getDeepValues(e)):t.push(...this.getDeepValues(Object.values(e))),t),[])}addOrder(t){this.ordersControls.push(this.fb.group(t))}getControl(t){return t}}return t.\u0275fac=function(e){return new(e||t)(p.Mb(C.e),p.Mb(g),p.Mb(F.b))},t.\u0275cmp=p.Gb({type:t,selectors:[["ntv-subscription-orders-form"]],inputs:{orders:"orders"},decls:2,vars:2,consts:[[4,"ngIf"],["class","array-item",4,"ngFor","ngForOf"],[1,"array-item"],["appearance","standard"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["overline","\u043d\u0430\u0431\u043e\u0440\u044b","value","\u041d\u0430\u0436\u043c\u0438",3,"click"],["matInput","",3,"formControl"],[3,"value"]],template:function(t,e){1&t&&(p.xc(0,A,2,0,"h4",0),p.xc(1,E,16,5,"mat-card",1)),2&t&&(p.ic("ngIf",e.ordersControls.length),p.Bb(1),p.ic("ngForOf",e.ordersControls.controls))},directives:[j.k,j.j,$.a,B.c,B.f,N.a,C.n,C.f,K.a,k.b,C.c,M.n],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:16px}.array-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:16px}"]}),t})();function V(t,e){if(1&t&&(p.Sb(0,"mat-option",6),p.zc(1),p.Rb()),2&t){const t=e.$implicit;p.ic("value",t.date),p.Bb(1),p.Bc(" ",t.name," ")}}function J(t,e){if(1&t&&(p.Sb(0,"mat-option",6),p.zc(1),p.Rb()),2&t){const t=e.$implicit;p.ic("value",t),p.Bb(1),p.Bc(" ",t," ")}}let W=(()=>{class t{constructor(t,e,r){this.fb=t,this.store=e,this.dialog=r,this.shipmentTypes=Object.values(l.c),this.months=D.a,this.destroyer$$=new v.a}ngOnInit(){this.addSubscriptionForm=this.fb.group({months:"",shipmentType:"",orderStructure:""}),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}initFormSetter(){this.store.select(t=>t.subscriptionsOrders).pipe(Object(R.a)(1),Object(m.a)(t=>{if(t.length){const e={months:t.map(t=>t.shipmentDate),shipmentType:t[0].shipmentType,orderStructure:t[0].orderStructure||u.a.onceOrder.orderStructure};this.addSubscriptionForm.setValue(e)}})).subscribe()}initFormSaver(){this.addSubscriptionForm.valueChanges.pipe(Object(y.a)(this.destroyer$$),Object(s.a)(500)).subscribe(t=>{if(Array.isArray(t.months)){const e=t.months.map(e=>({id:u.a.onceOrder.id,personId:u.a.onceOrder.personId,comment:u.a.onceOrder.comment,sended:u.a.onceOrder.sended,shipmentDate:e,shipmentType:t.shipmentType,trackNumber:u.a.onceOrder.trackNumber,type:l.b.subscription,orderStructure:t.orderStructure,orderDate:(new Date).toISOString()}));this.store.saveForm({subscriptionsOrders:e})}})}initResetListener(){this.store.select(t=>t.resetForm).pipe(Object(y.a)(this.destroyer$$),Object(m.a)(t=>{t&&this.addSubscriptionForm.reset()})).subscribe()}showOrderStructureSelectionDialog(){this.store.select(t=>t.subscriptionsOrders).pipe(Object(R.a)(1)).subscribe(t=>{let e;e=t.length?t[0]:u.a.onceOrder,this.dialog.open(G,{data:e}).afterClosed().subscribe(t=>{t&&this.addSubscriptionForm.patchValue({orderStructure:t})})})}}return t.\u0275fac=function(e){return new(e||t)(p.Mb(C.e),p.Mb(g),p.Mb(F.b))},t.\u0275cmp=p.Gb({type:t,selectors:[["ntv-subscription-form"]],decls:16,vars:3,consts:[[1,"form",3,"formGroup"],["appearance","standard"],["formControlName","months","multiple",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","shipmentType"],["mat-flat-button","",1,"form__submit",3,"click"],[3,"value"]],template:function(t,e){1&t&&(p.Sb(0,"h4"),p.zc(1,"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0438\u0440\u0443\u0435\u043c \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0443"),p.Rb(),p.Sb(2,"form",0),p.Sb(3,"mat-form-field",1),p.Sb(4,"mat-label"),p.zc(5,"\u041c\u0435\u0441\u044f\u0446\u044b"),p.Rb(),p.Sb(6,"mat-select",2),p.xc(7,V,2,2,"mat-option",3),p.Rb(),p.Rb(),p.Sb(8,"mat-form-field",1),p.Sb(9,"mat-label"),p.zc(10,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),p.Rb(),p.Sb(11,"mat-select",4),p.xc(12,J,2,2,"mat-option",3),p.Rb(),p.Rb(),p.Sb(13,"button",5),p.Zb("click",function(){return e.showOrderStructureSelectionDialog()}),p.zc(14,"\u0421\u043e\u0441\u0442\u0430\u0432 \u0437\u0430\u043a\u0430\u0437\u0430"),p.Rb(),p.Rb(),p.Nb(15,"ntv-subscription-orders-form")),2&t&&(p.Bb(2),p.ic("formGroup",e.addSubscriptionForm),p.Bb(5),p.ic("ngForOf",e.months),p.Bb(5),p.ic("ngForOf",e.shipmentTypes))},directives:[C.v,C.o,C.h,B.c,B.f,N.a,C.n,C.g,j.j,_.a,L,M.n],styles:[".form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:16px;box-sizing:border-box;margin:8px 0}"]}),t})();function H(t,e){if(1&t&&(p.Sb(0,"mat-option",16),p.zc(1),p.Rb()),2&t){const t=e.$implicit;p.ic("value",t.date),p.Bb(1),p.Bc(" ",t.name," ")}}function Q(t,e){if(1&t&&(p.Sb(0,"mat-option",16),p.zc(1),p.Rb()),2&t){const t=e.$implicit;p.ic("value",t),p.Bb(1),p.Bc(" ",t," ")}}function X(t,e){if(1&t&&(p.Sb(0,"mat-option",16),p.zc(1),p.Rb()),2&t){const t=e.$implicit;p.ic("value",t),p.Bb(1),p.Bc(" ",t," ")}}function U(t,e){if(1&t){const t=p.Tb();p.Sb(0,"mat-card",17),p.Sb(1,"mat-form-field",2),p.Sb(2,"mat-label"),p.zc(3,"\u0441\u043a\u043e\u043b\u044c\u043a\u043e"),p.Rb(),p.Nb(4,"input",18),p.Rb(),p.Sb(5,"button",13),p.Zb("click",function(){p.pc(t);const r=e.index;return p.dc().removeKit(r)}),p.Sb(6,"mat-icon"),p.zc(7,"delete"),p.Rb(),p.Rb(),p.Sb(8,"mat-form-field",2),p.Sb(9,"mat-label"),p.zc(10,"\u0432\u043e\u0437\u0440\u0430\u0441\u0442"),p.Rb(),p.Sb(11,"mat-select",19),p.xc(12,X,2,2,"mat-option",7),p.Rb(),p.Rb(),p.Rb()}if(2&t){const t=e.$implicit,r=p.dc();p.Bb(4),p.ic("formControl",r.getControl(t.get("count"))),p.Bb(7),p.ic("formControl",r.getControl(t.get("age"))),p.Bb(1),p.ic("ngForOf",r.ages)}}function Y(t,e){if(1&t&&(p.Sb(0,"mat-option",21),p.zc(1),p.Rb()),2&t){const t=e.$implicit;p.ic("value",t),p.Bb(1),p.Bc(" ",t," ")}}function tt(t,e){if(1&t){const t=p.Tb();p.Sb(0,"mat-card",17),p.Sb(1,"mat-form-field",2),p.Sb(2,"mat-label"),p.zc(3,"\u0441\u043a\u043e\u043b\u044c\u043a\u043e"),p.Rb(),p.Nb(4,"input",18),p.Rb(),p.Sb(5,"button",13),p.Zb("click",function(){p.pc(t);const r=e.index;return p.dc().removeTheatre(r)}),p.Sb(6,"mat-icon"),p.zc(7,"delete"),p.Rb(),p.Rb(),p.Sb(8,"mat-form-field",2),p.Sb(9,"mat-label"),p.zc(10,"\u0432\u043e\u0437\u0440\u0430\u0441\u0442"),p.Rb(),p.Sb(11,"mat-select",19),p.xc(12,Y,2,2,"mat-option",20),p.Rb(),p.Rb(),p.Rb()}if(2&t){const t=e.$implicit,r=p.dc();p.Bb(4),p.ic("formControl",r.getControl(t.get("count"))),p.Bb(7),p.ic("formControl",r.getControl(t.get("age"))),p.Bb(1),p.ic("ngForOf",r.ages)}}let et=(()=>{class t{constructor(t,e){this.fb=t,this.store=e,this.months=D.a,this.ages=Object.values(l.a),this.shipmentTypes=Object.values(l.c),this.initialKitGroupState={age:l.a.twoThree,count:1},this.destroyer$$=new v.a}get kits(){return this.addOrderForm.get("orderStructure").get("kits")}get theatres(){return this.addOrderForm.get("orderStructure").get("theatres")}ngOnInit(){this.addOrderForm=this.fb.group({id:u.a.onceOrder.id,personId:u.a.onceOrder.personId,comment:u.a.onceOrder.comment,sended:u.a.onceOrder.sended,shipmentDate:u.a.onceOrder.shipmentDate,shipmentType:u.a.onceOrder.shipmentType,trackNumber:u.a.onceOrder.trackNumber,type:u.a.onceOrder.type,orderStructure:this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}initFormSaver(){this.addOrderForm.valueChanges.pipe(Object(y.a)(this.destroyer$$),Object(s.a)(500)).subscribe(t=>{this.store.saveForm({onceOrder:t})})}initFormSetter(){this.store.select(t=>t.onceOrder).pipe(Object(R.a)(1),Object(m.a)(t=>{this.setKitsAndTheatresControls(t);const e=Object.assign({},t);delete e.orderStructure,e.type=l.b.check,this.addOrderForm.patchValue(e)})).subscribe()}initResetListener(){this.store.select(t=>t.resetForm).pipe(Object(y.a)(this.destroyer$$),Object(m.a)(t=>{t&&this.addOrderForm.reset()})).subscribe()}addKit(t){this.kits.push(this.fb.group(t))}addTheatre(t){this.theatres.push(this.fb.group(t))}removeKit(t){this.kits.removeAt(t)}removeTheatre(t){this.theatres.removeAt(t)}getControl(t){return t}setKitsAndTheatresControls(t){var e,r;null===(e=t.orderStructure)||void 0===e||e.kits.forEach(t=>{this.addKit(t)}),null===(r=t.orderStructure)||void 0===r||r.theatres.forEach(t=>{this.addTheatre(t)})}}return t.\u0275fac=function(e){return new(e||t)(p.Mb(C.e),p.Mb(g))},t.\u0275cmp=p.Gb({type:t,selectors:[["ntv-once-form"]],decls:44,vars:7,consts:[[1,"form",3,"formGroup"],[1,"form__comment"],["appearance","standard"],["matInput","","formControlName","comment"],[1,"form__block"],[1,"select-card"],["formControlName","shipmentDate"],[3,"value",4,"ngFor","ngForOf"],[3,"vertical"],["formControlName","shipmentType"],["formGroupName","orderStructure",1,"form__block"],["formArrayName","kits",1,"form__array"],[1,"form__array-title"],["mat-icon-button","","type","button",3,"click"],["class","form__array-item",4,"ngFor","ngForOf"],["formArrayName","theatres",1,"form__array"],[3,"value"],[1,"form__array-item"],["type","number","matInput","",3,"formControl"],[3,"formControl"],["name","dsfsd",3,"value",4,"ngFor","ngForOf"],["name","dsfsd",3,"value"]],template:function(t,e){1&t&&(p.Sb(0,"form",0),p.Sb(1,"h4"),p.zc(2,"\u041e \u0437\u0430\u043a\u0430\u0437\u0435"),p.Rb(),p.Sb(3,"mat-card",1),p.Sb(4,"mat-form-field",2),p.Sb(5,"mat-label"),p.zc(6,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),p.Rb(),p.Nb(7,"textarea",3),p.Rb(),p.Rb(),p.Sb(8,"h4"),p.zc(9,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),p.Rb(),p.Sb(10,"div",4),p.Sb(11,"mat-card",5),p.Sb(12,"mat-form-field",2),p.Sb(13,"mat-label"),p.zc(14,"\u0414\u0430\u0442\u0430"),p.Rb(),p.Sb(15,"mat-select",6),p.xc(16,H,2,2,"mat-option",7),p.Rb(),p.Rb(),p.Rb(),p.Nb(17,"mat-divider",8),p.Sb(18,"mat-card",5),p.Sb(19,"mat-form-field",2),p.Sb(20,"mat-label"),p.zc(21,"\u0422\u0438\u043f"),p.Rb(),p.Sb(22,"mat-select",9),p.xc(23,Q,2,2,"mat-option",7),p.Rb(),p.Rb(),p.Rb(),p.Rb(),p.Sb(24,"h4"),p.zc(25,"\u0427\u0442\u043e \u0432\u0435\u0437\u0435\u043c"),p.Rb(),p.Sb(26,"div",10),p.Sb(27,"div",11),p.Sb(28,"div",12),p.Sb(29,"h6"),p.zc(30,"\u041d\u0430\u0431\u043e\u0440\u044b"),p.Rb(),p.Sb(31,"button",13),p.Zb("click",function(){return e.addKit(e.initialKitGroupState)}),p.Sb(32,"mat-icon"),p.zc(33,"add"),p.Rb(),p.Rb(),p.Rb(),p.xc(34,U,13,3,"mat-card",14),p.Rb(),p.Nb(35,"mat-divider",8),p.Sb(36,"div",15),p.Sb(37,"div",12),p.Sb(38,"h6"),p.zc(39,"\u0422\u0435\u0430\u0442\u0440\u044b"),p.Rb(),p.Sb(40,"button",13),p.Zb("click",function(){return e.addTheatre(e.initialKitGroupState)}),p.Sb(41,"mat-icon"),p.zc(42,"add"),p.Rb(),p.Rb(),p.Rb(),p.xc(43,tt,13,3,"mat-card",14),p.Rb(),p.Rb(),p.Rb()),2&t&&(p.ic("formGroup",e.addOrderForm),p.Bb(16),p.ic("ngForOf",e.months),p.Bb(1),p.ic("vertical",!0),p.Bb(6),p.ic("ngForOf",e.shipmentTypes),p.Bb(11),p.ic("ngForOf",e.kits.controls),p.Bb(1),p.ic("vertical",!0),p.Bb(8),p.ic("ngForOf",e.theatres.controls))},directives:[C.v,C.o,C.h,$.a,B.c,B.f,k.b,C.c,C.n,C.g,N.a,j.j,z.a,C.i,C.d,_.a,x.a,M.n,C.r,C.f],styles:["[_nghost-%COMP%]{display:block;min-width:500px}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;height:100%;box-sizing:border-box}.form__block[_ngcontent-%COMP%]{grid-template-columns:1fr 1px 1fr;grid-gap:16px}.form__block[_ngcontent-%COMP%], .form__comment[_ngcontent-%COMP%]{display:grid;width:100%}.form__array[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.form__array-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 40px;grid-template-rows:repeat(auto-fill,41px);grid-gap:16px}.form__array-title[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.scrollbar[_ngcontent-%COMP%]{max-height:50vh}.select-card[_ngcontent-%COMP%]{display:grid}"]}),t})(),rt=(()=>{class t{constructor(t){this.store=t,this.orderTypes=l.b}setCurrentOrderType(t){const e=Object.values(l.b).reduce((e,r)=>(r===t.tab.textLabel.toLowerCase()&&(e=r),e),l.b.subscription);this.store.saveForm({orderType:e})}}return t.\u0275fac=function(e){return new(e||t)(p.Mb(g))},t.\u0275cmp=p.Gb({type:t,selectors:[["ntv-order-form"]],decls:7,vars:6,consts:[["mat-stretch-tabs","","dynamicHeight","",3,"selectedTabChange"],[3,"label"]],template:function(t,e){1&t&&(p.Sb(0,"mat-tab-group",0),p.Zb("selectedTabChange",function(t){return e.setCurrentOrderType(t)}),p.Sb(1,"mat-tab",1),p.ec(2,"titlecase"),p.Nb(3,"ntv-subscription-form"),p.Rb(),p.Sb(4,"mat-tab",1),p.ec(5,"titlecase"),p.Nb(6,"ntv-once-form"),p.Rb(),p.Rb()),2&t&&(p.Bb(1),p.ic("label",p.fc(2,2,e.orderTypes.subscription)),p.Bb(3),p.ic("label",p.fc(5,4,e.orderTypes.check)))},directives:[O.b,O.a,W,et],pipes:[j.r],styles:["[_nghost-%COMP%]{display:block}"]}),t})();var ot=r("/1cH");function it(t,e){if(1&t&&(p.Sb(0,"mat-option",14),p.zc(1),p.Rb()),2&t){const t=e.$implicit;p.ic("value",t),p.Bb(1),p.Bc(" ",t.name," ")}}let st=(()=>{class t{constructor(t,e,r){this.fb=t,this.store=e,this.addOrderService=r,this.destroyer$$=new v.a,this.loadingStates=n.a,this.autocompleteOptions=[]}ngOnInit(){this.initForm(),this.loadingState$=this.store.select(t=>t.loadingState),this.setFormFromStore(),this.initFormSaver(),this.initAutocomplete(),this.initResetListener()}ngOnDestroy(){this.destroyer$$.next(),this.destroyer$$.complete()}setCustomerFromAutocomplete(t){this.addCustomerForm.setValue(t.option.value)}resetForm(){this.addCustomerForm.reset()}initForm(){this.addCustomerForm=this.fb.group({id:NaN,name:"",contacts:this.fb.group({email:"",inst:"",phone:""}),address:this.fb.group({city:"",address:""})})}setFormFromStore(){this.store.select(t=>t.customer).pipe(Object(R.a)(1),Object(m.a)(t=>{this.addCustomerForm.setValue(t)})).subscribe()}initFormSaver(){this.addCustomerForm.valueChanges.pipe(Object(y.a)(this.destroyer$$),Object(s.a)(500)).subscribe(t=>{this.store.saveForm({customer:t})})}initAutocomplete(){var t;null===(t=this.addCustomerForm.get("name"))||void 0===t||t.valueChanges.pipe(Object(y.a)(this.destroyer$$),Object(s.a)(300),Object(b.a)(t=>this.addOrderService.getPersonsByName(t))).subscribe(t=>{this.autocompleteOptions=t})}initResetListener(){this.store.select(t=>t.resetForm).pipe(Object(y.a)(this.destroyer$$),Object(m.a)(t=>{t&&this.resetForm()})).subscribe()}}return t.\u0275fac=function(e){return new(e||t)(p.Mb(C.e),p.Mb(g),p.Mb(f.a))},t.\u0275cmp=p.Gb({type:t,selectors:[["ntv-customer-form"]],decls:33,vars:3,consts:[[1,"form",3,"formGroup"],["appearance","standard"],["matInput","","formControlName","name",3,"matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","contacts",1,"form__group"],["matInput","","formControlName","email"],["matInput","","formControlName","inst"],["matInput","","formControlName","phone"],["formGroupName","address",1,"form__group"],["matInput","","formControlName","city"],["matInput","","formControlName","address"],["mat-icon-button","",3,"click"],[3,"value"]],template:function(t,e){if(1&t&&(p.Sb(0,"form",0),p.Sb(1,"mat-form-field",1),p.Sb(2,"mat-label"),p.zc(3,"\u0424\u0418\u041e"),p.Rb(),p.Nb(4,"input",2),p.Sb(5,"mat-autocomplete",3,4),p.Zb("optionSelected",function(t){return e.setCustomerFromAutocomplete(t)}),p.xc(7,it,2,2,"mat-option",5),p.Rb(),p.Rb(),p.Sb(8,"div",6),p.Sb(9,"mat-form-field",1),p.Sb(10,"mat-label"),p.zc(11,"E-mail"),p.Rb(),p.Nb(12,"input",7),p.Rb(),p.Sb(13,"mat-form-field",1),p.Sb(14,"mat-label"),p.zc(15,"\u0418\u043d\u0441\u0442\u0430\u0433\u0440\u0430\u043c"),p.Rb(),p.Nb(16,"input",8),p.Rb(),p.Sb(17,"mat-form-field",1),p.Sb(18,"mat-label"),p.zc(19,"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"),p.Rb(),p.Nb(20,"input",9),p.Rb(),p.Rb(),p.Sb(21,"div",10),p.Sb(22,"mat-form-field",1),p.Sb(23,"mat-label"),p.zc(24,"\u0413\u043e\u0440\u043e\u0434"),p.Rb(),p.Nb(25,"input",11),p.Rb(),p.Sb(26,"mat-form-field",1),p.Sb(27,"mat-label"),p.zc(28,"\u041e\u0441\u0442\u0430\u043b\u044c\u043d\u043e\u0439 \u0430\u0434\u0440\u0435\u0441"),p.Rb(),p.Nb(29,"input",12),p.Rb(),p.Sb(30,"button",13),p.Zb("click",function(){return e.resetForm()}),p.Sb(31,"mat-icon"),p.zc(32,"refresh"),p.Rb(),p.Rb(),p.Rb(),p.Rb()),2&t){const t=p.nc(6);p.ic("formGroup",e.addCustomerForm),p.Bb(4),p.ic("matAutocomplete",t),p.Bb(3),p.ic("ngForOf",e.autocompleteOptions)}},directives:[C.v,C.o,C.h,B.c,B.f,k.b,C.c,ot.c,C.n,C.g,ot.a,j.j,C.i,_.a,x.a,M.n],styles:[".form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding:16px 0}.form__group[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:16px}.form__loading-state[_ngcontent-%COMP%]{justify-self:flex-end;align-self:flex-end}.form__refresh-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 40px;grid-gap:16px}"]}),t})();var nt=r("4Kj8");function at(t,e){1&t&&(p.Sb(0,"span",6),p.zc(1," \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c... "),p.Nb(2,"ntv-spinner",7),p.Rb()),2&t&&(p.Bb(2),p.ic("diameter",16))}function ct(t,e){1&t&&(p.Sb(0,"span",6),p.zc(1," \u041e\u0448\u0438\u0431\u043a\u0430, \u043d\u0430\u0436\u043c\u0438 \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0441\u043d\u043e\u0432\u0430 "),p.Sb(2,"mat-icon",8),p.zc(3,"error"),p.Rb(),p.Rb())}function bt(t,e){1&t&&(p.Qb(0),p.zc(1," \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u043a\u0430\u0437 "),p.Pb())}function mt(t,e){if(1&t){const t=p.Tb();p.Qb(0),p.Sb(1,"button",3),p.Zb("click",function(){p.pc(t);const r=e.ngIf;return p.dc().registerNewOrder(r)}),p.ec(2,"async"),p.xc(3,at,3,1,"span",4),p.xc(4,ct,4,0,"span",4),p.xc(5,bt,2,0,"ng-container",5),p.Rb(),p.Pb()}if(2&t){const t=p.dc();p.Bb(1),p.ic("ngSwitch",p.fc(2,3,t.loadingState$)),p.Bb(2),p.ic("ngSwitchCase",t.loadingStates.loading),p.Bb(1),p.ic("ngSwitchCase",t.loadingStates.err)}}const dt=[{path:"",component:(()=>{class t{constructor(t){this.store=t,this.loadingStates=n.a}ngOnInit(){this.store.setFormData(),this.loadingState$=this.store.select(t=>t.loadingState).pipe(Object(s.a)(200)),this.state$=this.store.select(t=>t)}registerNewOrder(t){this.store.registerNewOrder(t)}}return t.\u0275fac=function(e){return new(e||t)(p.Mb(g))},t.\u0275cmp=p.Gb({type:t,selectors:[["ntv-add-order"]],features:[p.Ab([g])],decls:10,vars:3,consts:[[1,"scrollbar"],[1,"add-order"],[4,"ngIf"],["mat-raised-button","",1,"submit-button",3,"ngSwitch","click"],["class","submit-button__content",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"submit-button__content"],[1,"submit-button__spinner",3,"diameter"],[1,"submit-button__error-icon"]],template:function(t,e){1&t&&(p.Sb(0,"ng-scrollbar",0),p.Sb(1,"div",1),p.Sb(2,"p"),p.zc(3,"\u0417\u0430\u043a\u0430\u0437"),p.Rb(),p.Nb(4,"ntv-order-form"),p.Sb(5,"p"),p.zc(6,"\u041a\u043b\u0438\u0435\u043d\u0442"),p.Rb(),p.Nb(7,"ntv-customer-form"),p.xc(8,mt,6,5,"ng-container",2),p.ec(9,"async"),p.Rb(),p.Rb()),2&t&&(p.Bb(8),p.ic("ngIf",p.fc(9,1,e.state$)))},directives:[S.a,rt,st,j.k,_.a,j.m,j.n,j.o,nt.a,x.a],pipes:[j.b],styles:["[_nghost-%COMP%]{display:block;width:100%}.add-order[_ngcontent-%COMP%]{padding:24px}.submit-button__content[_ngcontent-%COMP%]{display:flex;align-items:center}.submit-button__spinner[_ngcontent-%COMP%]{margin-top:0;margin-left:8px}.submit-button__error-icon[_ngcontent-%COMP%]{margin-left:8px}.scrollbar[_ngcontent-%COMP%]{max-height:calc(100vh - 64px);min-height:calc(100vh - 64px)}"]}),t})()}];let lt=(()=>{class t{}return t.\u0275mod=p.Kb({type:t}),t.\u0275inj=p.Jb({factory:function(e){return new(e||t)},imports:[[i.h.forChild(dt)],i.h]}),t})(),ut=(()=>{class t{}return t.\u0275mod=p.Kb({type:t}),t.\u0275inj=p.Jb({factory:function(e){return new(e||t)},imports:[[lt,o.a]]}),t})()}}]);