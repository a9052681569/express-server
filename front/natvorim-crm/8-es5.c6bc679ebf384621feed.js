!function(){function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(c){o=!0,i=c}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(t,e)||r(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=s(t);if(e){var o=s(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return a(this,r)}}function a(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(t,e,r){return e&&u(t.prototype,e),r&&u(t,r),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"06u4":function(r,n,a){"use strict";a.r(n),a.d(n,"AddOrderModule",function(){return $t});var s,u,b=a("PCNd"),l=a("tyNb"),m=a("Kj3r"),f=a("hgo/"),p=a("Wcn/"),h=a("ufcJ"),g=a("z6cu"),v=a("eIep"),S=a("vkgz"),y=a("JIr8"),O={customer:{customer:{id:"NaN",name:"",contacts:{email:"",inst:"",phone:""},address:{city:"",address:""},reminders:[]},isValid:!1},subscriptionsOrders:{orders:[],isValid:!1,subscriptionOrderStructure:{theatres:[],kits:[]}},onceOrder:{order:{id:"NaN",personId:"NaN",sended:!1,shipmentDate:"",shipmentType:null,trackNumber:"",type:p.b.check,orderDate:"",orderStructure:{kits:[],theatres:[]},comment:""},isValid:!1},orderType:p.b.subscription,loadingState:null,resetForm:!1},F=a("fXoL"),R=a("LRne"),k=a("AytR"),j=a("tk/3"),C=((s=function(){function t(e){c(this,t),this.http=e,this.formDataInitState={onceOrder:O.onceOrder,orderType:O.orderType,subscriptionsOrders:O.subscriptionsOrders,customer:O.customer}}return d(t,[{key:"updateFormData",value:function(t){var e,r=localStorage.getItem("ntv-add-order-form-data");return e=Object.assign(Object.assign({},r?JSON.parse(r):this.formDataInitState),t),localStorage.setItem("ntv-add-order-form-data",JSON.stringify(e)),Object(R.a)(e)}},{key:"getFormData",value:function(){var t=localStorage.getItem("ntv-add-order-form-data"),e=t?JSON.parse(t):this.formDataInitState;return Object(R.a)(e)}},{key:"resetFormData",value:function(){localStorage.removeItem("ntv-add-order-form-data")}},{key:"getPersonsByName",value:function(t){return this.http.post(k.a.apiEndpoints.customersForAutocomplete,{name:t})}},{key:"postOrders",value:function(t){return this.http.post(k.a.apiEndpoints.postOrders,t)}},{key:"postCustomer",value:function(t){return this.http.post(k.a.apiEndpoints.postCustomer,t)}}]),t}()).\u0275fac=function(t){return new(t||s)(F.Wb(j.a))},s.\u0275prov=F.Ib({token:s,factory:s.\u0275fac,providedIn:"root"}),s),_=a("dNgK"),x=((u=function(r){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}(a,r);var n=i(a);function a(r,o){var i;return c(this,a),(i=n.call(this,O)).addOrderService=r,i.snack=o,i.saveForm=i.effect(function(t){return t.pipe(Object(v.a)(function(t){return i.reqFormPending(),i.addOrderService.updateFormData(t).pipe(Object(S.a)(function(t){i.reqFormSuccess(t)}),Object(y.a)(function(t){return i.reqFormError(),Object(g.a)(t)}))}))}),i.setFormData=i.effect(function(t){return t.pipe(Object(v.a)(function(){return i.reqFormPending(),i.addOrderService.getFormData().pipe(Object(S.a)(function(t){i.reqFormSuccess(t)}),Object(y.a)(function(t){return i.reqFormError(),Object(g.a)(t)}))}))}),i.registerNewOrder=i.effect(function(r){return r.pipe(Object(v.a)(function(r){i.reqFormPending();var n=[];return r.orderType===p.b.subscription?n.push.apply(n,e(r.subscriptionsOrders.orders)):r.orderType===p.b.check&&n.push(r.onceOrder.order),r.customer.customer.id?(n.forEach(function(t){t.personId=r.customer.customer.id}),i.addOrderService.postOrders(n).pipe(Object(S.a)(function(){i.resetState(),i.addOrderService.resetFormData(),i.snack.open("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0437\u0430\u043a\u0430\u0437",void 0,{duration:3e3}),i.toInitialState()}))):i.addOrderService.postCustomer(r.customer.customer).pipe(Object(v.a)(function(e){var r=t(e,1)[0];return n.forEach(function(t){t.personId=r.id}),i.addOrderService.postOrders(n).pipe(Object(S.a)(function(){i.resetState(),i.addOrderService.resetFormData(),i.snack.open("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0437\u0430\u043a\u0430\u0437 \u0438 \u043d\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",void 0,{duration:3e3}),i.toInitialState()}))}),Object(y.a)(function(t){return i.reqFormError(),Object(g.a)(t)}))}),Object(y.a)(function(t){return i.reqFormError(),Object(g.a)(t)}))}),i.resetState=i.updater(function(t){return Object.assign(Object.assign({},O),{resetForm:!0})}),i.toInitialState=i.updater(function(t){return Object.assign({},O)}),i.reqFormPending=i.updater(function(t){return Object.assign(Object.assign({},t),{loadingState:f.a.loading})}),i.reqFormSuccess=i.updater(function(t,e){return Object.assign(Object.assign(Object.assign({},t),e),{loadingState:null})}),i.reqFormError=i.updater(function(t){return Object.assign(Object.assign({},t),{loadingState:f.a.err})}),i}return a}(h.a)).\u0275fac=function(t){return new(t||u)(F.Wb(C),F.Wb(_.a))},u.\u0275prov=F.Ib({token:u,factory:u.\u0275fac}),u),$=a("G1Gu"),N=a("Wp6s"),w=a("3Pt+"),I=a("XNiG"),M=a("IzEk"),B=a("1G5W"),P=a("TaCb"),z=a("kmnG"),T=a("qFsG"),D=a("/1cH"),q=a("ofXK"),G=a("bTqV"),V=a("NFeN"),A=a("FKr1");function E(t,e){if(1&t&&(F.Sb(0,"mat-option",16),F.zc(1),F.Rb()),2&t){var r=e.$implicit;F.ic("value",r),F.Bb(1),F.Bc(" ",r.name," ")}}function L(t,e){if(1&t&&(F.Sb(0,"mat-error"),F.zc(1),F.Rb()),2&t){var r=F.dc().ngIf;F.Bb(1),F.Ac(null==r.errors?null:r.errors.oneRequired)}}function J(t,e){if(1&t&&(F.Qb(0),F.xc(1,L,2,1,"mat-error",11),F.Pb()),2&t){var r=e.ngIf;F.Bb(1),F.ic("ngIf",null==r.errors?null:r.errors.oneRequired)}}var Z,K,W=((Z=function(){function t(e,r,n,o){c(this,t),this.fb=e,this.store=r,this.addOrderService=n,this.hs=o,this.destroyer$$=new I.a,this.loadingStates=f.a,this.autocompleteOptions=[]}return d(t,[{key:"ngOnInit",value:function(){this.initForm(),this.loadingState$=this.store.select(function(t){return t.loadingState}),this.setFormFromStore(),this.initFormSaver(),this.initAutocomplete(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"setCustomerFromAutocomplete",value:function(t){var e=t.option.value;console.log(e),this.addCustomerForm.setValue(e)}},{key:"resetForm",value:function(){this.addCustomerForm.reset()}},{key:"initForm",value:function(){this.addCustomerForm=this.fb.group({id:NaN,name:["",w.u.required],contacts:this.fb.group({email:["",w.u.email],inst:"",phone:["",this.hs.phoneValidator]},{validators:[this.oneRequiredValidator]}),address:this.fb.group({city:["",w.u.required],address:["",w.u.required]}),reminders:"this.fb.array([])"})}},{key:"setFormFromStore",value:function(){var t=this;this.store.select(function(t){return t.customer}).pipe(Object(M.a)(1),Object(S.a)(function(e){t.addCustomerForm.setValue(e.customer)})).subscribe()}},{key:"initFormSaver",value:function(){var t=this;this.addCustomerForm.valueChanges.pipe(Object(B.a)(this.destroyer$$),Object(m.a)(500)).subscribe(function(e){console.log(e),t.store.saveForm({customer:{customer:e,isValid:t.addCustomerForm.valid}})})}},{key:"initAutocomplete",value:function(){var t,e=this;null===(t=this.addCustomerForm.get("name"))||void 0===t||t.valueChanges.pipe(Object(B.a)(this.destroyer$$),Object(m.a)(300),Object(v.a)(function(t){return e.addOrderService.getPersonsByName(t)})).subscribe(function(t){e.autocompleteOptions=t})}},{key:"initResetListener",value:function(){var t=this;this.store.select(function(t){return t.resetForm}).pipe(Object(B.a)(this.destroyer$$),Object(S.a)(function(e){e&&t.resetForm()})).subscribe()}},{key:"oneRequiredValidator",value:function(t){return Object.values(t.value).every(function(t){return 0==!!t})?{oneRequired:"\u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u0438\u043d \u043a\u043e\u043d\u0442\u0430\u043a\u0442"}:null}}]),t}()).\u0275fac=function(t){return new(t||Z)(F.Mb(w.e),F.Mb(x),F.Mb(C),F.Mb(P.a))},Z.\u0275cmp=F.Gb({type:Z,selectors:[["ntv-customer-form"]],decls:36,vars:4,consts:[[1,"form",3,"formGroup"],["appearance","standard"],["matInput","","formControlName","name",3,"matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","contacts",1,"form__group"],["matInput","","formControlName","email"],["matInput","","formControlName","inst"],["matInput","","formControlName","phone"],["matPrefix",""],[4,"ngIf"],["formGroupName","address",1,"form__group"],["matInput","","formControlName","city"],["matInput","","formControlName","address"],["mat-icon-button","",3,"click"],[3,"value"]],template:function(t,e){if(1&t&&(F.Sb(0,"form",0),F.Sb(1,"mat-form-field",1),F.Sb(2,"mat-label"),F.zc(3,"\u0424\u0418\u041e*"),F.Rb(),F.Nb(4,"input",2),F.Sb(5,"mat-autocomplete",3,4),F.Zb("optionSelected",function(t){return e.setCustomerFromAutocomplete(t)}),F.xc(7,E,2,2,"mat-option",5),F.Rb(),F.Rb(),F.Sb(8,"div",6),F.Sb(9,"mat-form-field",1),F.Sb(10,"mat-label"),F.zc(11,"E-mail"),F.Rb(),F.Nb(12,"input",7),F.Rb(),F.Sb(13,"mat-form-field",1),F.Sb(14,"mat-label"),F.zc(15,"\u0418\u043d\u0441\u0442\u0430\u0433\u0440\u0430\u043c"),F.Rb(),F.Nb(16,"input",8),F.Rb(),F.Sb(17,"mat-form-field",1),F.Sb(18,"mat-label"),F.zc(19,"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"),F.Rb(),F.Nb(20,"input",9),F.Sb(21,"span",10),F.zc(22,"+7\xa0"),F.Rb(),F.Rb(),F.Rb(),F.xc(23,J,2,1,"ng-container",11),F.Sb(24,"div",12),F.Sb(25,"mat-form-field",1),F.Sb(26,"mat-label"),F.zc(27,"\u0413\u043e\u0440\u043e\u0434*"),F.Rb(),F.Nb(28,"input",13),F.Rb(),F.Sb(29,"mat-form-field",1),F.Sb(30,"mat-label"),F.zc(31,"\u041e\u0441\u0442\u0430\u043b\u044c\u043d\u043e\u0439 \u0430\u0434\u0440\u0435\u0441*"),F.Rb(),F.Nb(32,"input",14),F.Rb(),F.Sb(33,"button",15),F.Zb("click",function(){return e.resetForm()}),F.Sb(34,"mat-icon"),F.zc(35,"refresh"),F.Rb(),F.Rb(),F.Rb(),F.Rb()),2&t){var r=F.nc(6);F.ic("formGroup",e.addCustomerForm),F.Bb(4),F.ic("matAutocomplete",r),F.Bb(3),F.ic("ngForOf",e.autocompleteOptions),F.Bb(16),F.ic("ngIf",e.hs.getControl(e.addCustomerForm.get("contacts")))}},directives:[w.v,w.o,w.h,z.c,z.f,T.b,w.c,D.c,w.n,w.g,D.a,q.j,w.i,z.g,q.k,G.a,V.a,A.n,z.b],styles:[".form[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:16px 0}.form__group[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:16px}.form__loading-state[_ngcontent-%COMP%]{justify-self:flex-end;align-self:flex-end}.form__refresh-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 40px;grid-gap:16px}"]}),Z),Q=a("wZkO"),H=a("0IaG"),X=a("q6z+"),U=((K=function(){function t(e,r,n){c(this,t),this.dialogRef=e,this.orderStructure=r,this.fb=n}return d(t,[{key:"ngOnInit",value:function(){this.orderStructureForm=this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}},{key:"setStructure",value:function(){this.dialogRef.close(this.orderStructureForm.value)}}]),t}()).\u0275fac=function(t){return new(t||K)(F.Mb(H.f),F.Mb(H.a),F.Mb(w.e))},K.\u0275cmp=F.Gb({type:K,selectors:[["ntv-add-order-structure-dialog"]],decls:5,vars:3,consts:[[1,"scrollbar"],[1,"content"],[3,"orderStructureGroup","orderStructure"],["mat-raised-button","",3,"disabled","click"]],template:function(t,e){1&t&&(F.Sb(0,"ng-scrollbar",0),F.Sb(1,"div",1),F.Nb(2,"ntv-order-structure-form",2),F.Sb(3,"button",3),F.Zb("click",function(){return e.setStructure()}),F.zc(4," \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c "),F.Rb(),F.Rb(),F.Rb()),2&t&&(F.Bb(2),F.ic("orderStructureGroup",e.orderStructureForm)("orderStructure",e.orderStructure),F.Bb(1),F.ic("disabled",e.orderStructureForm.invalid))},directives:[$.a,X.a,G.a],styles:["[_nghost-%COMP%]{display:block;min-width:500px;margin:-24px}.scrollbar[_ngcontent-%COMP%]{max-height:70vh}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;padding:24px}"]}),K),Y=a("Qw0g"),tt=a("d3UM"),et=a("e1Hi");function rt(t,e){1&t&&(F.Sb(0,"h4"),F.zc(1,"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0437\u0430\u043a\u0430\u0437\u044b"),F.Rb())}function nt(t,e){if(1&t&&(F.Sb(0,"mat-option",8),F.zc(1),F.Rb()),2&t){var r=e.$implicit;F.ic("value",r.date),F.Bb(1),F.Bc(" ",r.name," ")}}function ot(t,e){if(1&t&&(F.Sb(0,"mat-option",8),F.zc(1),F.Rb()),2&t){var r=e.$implicit;F.ic("value",r),F.Bb(1),F.Bc(" ",r," ")}}function it(t,e){if(1&t){var r=F.Tb();F.Sb(0,"mat-card",2),F.Sb(1,"mat-form-field",3),F.Sb(2,"mat-label"),F.zc(3,"\u041c\u0435\u0441\u044f\u0446"),F.Rb(),F.Sb(4,"mat-select",4),F.xc(5,nt,2,2,"mat-option",5),F.Rb(),F.Rb(),F.Sb(6,"mat-form-field",3),F.Sb(7,"mat-label"),F.zc(8,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),F.Rb(),F.Sb(9,"mat-select",4),F.xc(10,ot,2,2,"mat-option",5),F.Rb(),F.Rb(),F.Sb(11,"ntv-overlined",6),F.Zb("click",function(){F.pc(r);var t=e.$implicit,n=e.index;return F.dc().showOrderStructureDialog(t.value,n)}),F.Rb(),F.Sb(12,"mat-form-field",3),F.Sb(13,"mat-label"),F.zc(14,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),F.Rb(),F.Nb(15,"input",7),F.Rb(),F.Rb()}if(2&t){var n=e.$implicit,o=F.dc();F.Bb(4),F.ic("formControl",o.hs.getControl(n.get("shipmentDate"))),F.Bb(1),F.ic("ngForOf",o.months),F.Bb(4),F.ic("formControl",o.hs.getControl(n.get("shipmentType"))),F.Bb(1),F.ic("ngForOf",o.shipmentTypes),F.Bb(1),F.ic("overline",n.value.standart?"\u043d\u0430\u0431\u043e\u0440\u044b":"\u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e"),F.Bb(4),F.ic("formControl",o.hs.getControl(n.get("comment")))}}var at,st=((at=function(){function t(e,r,n,o){c(this,t),this.fb=e,this.store=r,this.dialog=n,this.hs=o,this.months=Y.a,this.shipmentTypes=Object.values(p.d),this.destroyer$$=new I.a}return d(t,[{key:"ngOnInit",value:function(){this.ordersControls=this.fb.array([]),this.initFormSetter(),this.initFormSaver(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"showOrderStructureDialog",value:function(t,e){var r=this;this.dialog.open(U,{data:t.orderStructure}).afterClosed().subscribe(function(n){if(n){var o=r.isOrderStructuresEqual(n,r.subscriptionsOrdersSavedState.subscriptionOrderStructure),i=r.fb.group(Object.assign(Object.assign({},t),{orderStructure:n,standart:o}));r.ordersControls.setControl(e,i)}})}},{key:"initFormSaver",value:function(){var t=this;this.ordersControls.valueChanges.pipe(Object(B.a)(this.destroyer$$),Object(m.a)(500)).subscribe(function(e){var r=!1;e.length&&(r=e.every(function(t){return t.shipmentDate&&t.shipmentType&&(t.orderStructure.kits.length||t.orderStructure.theatres.length)})),t.store.saveForm({subscriptionsOrders:{orders:e,isValid:r,subscriptionOrderStructure:t.subscriptionsOrdersSavedState.subscriptionOrderStructure}})})}},{key:"initFormSetter",value:function(){var t=this;this.store.select(function(t){return t.subscriptionsOrders}).pipe(Object(B.a)(this.destroyer$$),Object(S.a)(function(e){t.subscriptionsOrdersSavedState=e,e.orders.length&&!t.isOrdersEqual(e.orders,t.ordersControls.value)&&(t.ordersControls.clear(),e.orders.forEach(function(e){t.addOrder(e)}))})).subscribe()}},{key:"initResetListener",value:function(){var t=this;this.store.select(function(t){return t.resetForm}).pipe(Object(B.a)(this.destroyer$$),Object(S.a)(function(e){e&&t.ordersControls.clear()})).subscribe()}},{key:"isOrdersEqual",value:function(t,e){if(t.length!==e.length)return!1;var r=this.getDeepValues(t),n=this.getDeepValues(e);return r.length===n.length&&r.every(function(t){return n.includes(t)})}},{key:"getDeepValues",value:function(t){var r=this;return t.reduce(function(t,n){return"object"!=typeof n||null===n?t.push(n):Array.isArray(n)?t.push.apply(t,e(r.getDeepValues(n))):t.push.apply(t,e(r.getDeepValues(Object.values(n)))),t},[])}},{key:"addOrder",value:function(t){var e=this.isOrderStructuresEqual(t.orderStructure,this.subscriptionsOrdersSavedState.subscriptionOrderStructure);this.ordersControls.push(this.fb.group(Object.assign(Object.assign({},t),{standart:e})))}},{key:"isOrderStructuresEqual",value:function(t,e){return t.kits.length===e.kits.length&&t.theatres.length===e.theatres.length&&!!t.kits.every(function(r,n){return r.age===e.kits[n].age&&r.count===t.kits[n].count})&&!!t.theatres.every(function(r,n){return r.age===e.theatres[n].age&&r.count===t.theatres[n].count})}}]),t}()).\u0275fac=function(t){return new(t||at)(F.Mb(w.e),F.Mb(x),F.Mb(H.b),F.Mb(P.a))},at.\u0275cmp=F.Gb({type:at,selectors:[["ntv-subscription-orders-form"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","array-item",4,"ngFor","ngForOf"],[1,"array-item"],["appearance","standard"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["value","\u041d\u0430\u0436\u043c\u0438",1,"clickable",3,"overline","click"],["matInput","",3,"formControl"],[3,"value"]],template:function(t,e){1&t&&(F.xc(0,rt,2,0,"h4",0),F.xc(1,it,16,6,"mat-card",1)),2&t&&(F.ic("ngIf",e.ordersControls.length),F.Bb(1),F.ic("ngForOf",e.ordersControls.controls))},directives:[q.k,q.j,N.a,z.c,z.f,tt.a,w.n,w.f,et.a,T.b,w.c,A.n],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:16px}.array-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:16px}"]}),at);function ct(t,e){if(1&t&&(F.Sb(0,"mat-option",6),F.zc(1),F.Rb()),2&t){var r=e.$implicit;F.ic("value",r.date),F.Bb(1),F.Bc(" ",r.name," ")}}function ut(t,e){if(1&t&&(F.Sb(0,"mat-option",6),F.zc(1),F.Rb()),2&t){var r=e.$implicit;F.ic("value",r),F.Bb(1),F.Bc(" ",r," ")}}var dt,bt=((dt=function(){function t(e,r,n){c(this,t),this.fb=e,this.store=r,this.dialog=n,this.shipmentTypes=Object.values(p.d),this.months=Y.a,this.destroyer$$=new I.a}return d(t,[{key:"ngOnInit",value:function(){this.addSubscriptionForm=this.fb.group({months:["",w.u.required],shipmentType:["",w.u.required],orderStructure:O.onceOrder.order.orderStructure}),this.setFormFromStore(),this.initFormSaver(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"setFormFromStore",value:function(){var t=this;this.store.select(function(t){return t.subscriptionsOrders}).pipe(Object(M.a)(1),Object(S.a)(function(e){var r=e.orders;if(r.length){var n={months:r.map(function(t){return t.shipmentDate}),shipmentType:r[0].shipmentType,orderStructure:r[0].orderStructure||O.onceOrder.order.orderStructure};t.addSubscriptionForm.setValue(n)}})).subscribe()}},{key:"initFormSaver",value:function(){var t=this;this.addSubscriptionForm.valueChanges.pipe(Object(B.a)(this.destroyer$$),Object(m.a)(500)).subscribe(function(e){if(Array.isArray(e.months)){var r;r=!(!e.orderStructure.kits.length&&!e.orderStructure.theatres.length)&&t.addSubscriptionForm.valid;var n=e.months.map(function(t){return{id:O.onceOrder.order.id,personId:O.onceOrder.order.personId,comment:O.onceOrder.order.comment,sended:O.onceOrder.order.sended,shipmentDate:t,shipmentType:e.shipmentType,trackNumber:O.onceOrder.order.trackNumber,type:p.b.subscription,orderStructure:e.orderStructure,orderDate:(new Date).toISOString()}});t.store.saveForm({subscriptionsOrders:{orders:n,isValid:r,subscriptionOrderStructure:e.orderStructure}})}})}},{key:"initResetListener",value:function(){var t=this;this.store.select(function(t){return t.resetForm}).pipe(Object(B.a)(this.destroyer$$),Object(S.a)(function(e){e&&t.addSubscriptionForm.setValue({months:"",shipmentType:"",orderStructure:O.onceOrder.order.orderStructure})})).subscribe()}},{key:"showOrderStructureSelectionDialog",value:function(){var t=this;this.store.select(function(t){return t.subscriptionsOrders}).pipe(Object(M.a)(1)).subscribe(function(e){t.dialog.open(U,{data:e.subscriptionOrderStructure}).afterClosed().subscribe(function(e){e&&t.addSubscriptionForm.patchValue({orderStructure:e})})})}}]),t}()).\u0275fac=function(t){return new(t||dt)(F.Mb(w.e),F.Mb(x),F.Mb(H.b))},dt.\u0275cmp=F.Gb({type:dt,selectors:[["ntv-subscription-form"]],decls:16,vars:3,consts:[[1,"form",3,"formGroup"],["appearance","standard"],["formControlName","months","multiple",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","shipmentType"],["mat-flat-button","",1,"form__submit",3,"click"],[3,"value"]],template:function(t,e){1&t&&(F.Sb(0,"h4"),F.zc(1,"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0438\u0440\u0443\u0435\u043c \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0443"),F.Rb(),F.Sb(2,"form",0),F.Sb(3,"mat-form-field",1),F.Sb(4,"mat-label"),F.zc(5,"\u041c\u0435\u0441\u044f\u0446\u044b"),F.Rb(),F.Sb(6,"mat-select",2),F.xc(7,ct,2,2,"mat-option",3),F.Rb(),F.Rb(),F.Sb(8,"mat-form-field",1),F.Sb(9,"mat-label"),F.zc(10,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),F.Rb(),F.Sb(11,"mat-select",4),F.xc(12,ut,2,2,"mat-option",3),F.Rb(),F.Rb(),F.Sb(13,"button",5),F.Zb("click",function(){return e.showOrderStructureSelectionDialog()}),F.zc(14,"\u0421\u043e\u0441\u0442\u0430\u0432 \u0437\u0430\u043a\u0430\u0437\u0430"),F.Rb(),F.Rb(),F.Nb(15,"ntv-subscription-orders-form")),2&t&&(F.Bb(2),F.ic("formGroup",e.addSubscriptionForm),F.Bb(5),F.ic("ngForOf",e.months),F.Bb(5),F.ic("ngForOf",e.shipmentTypes))},directives:[w.v,w.o,w.h,z.c,z.f,tt.a,w.n,w.g,q.j,G.a,st,A.n],styles:[".form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:16px;box-sizing:border-box;margin:8px 0}"]}),dt),lt=a("f0Cb");function mt(t,e){if(1&t&&(F.Sb(0,"mat-option",11),F.zc(1),F.Rb()),2&t){var r=e.$implicit;F.ic("value",r.date),F.Bb(1),F.Bc(" ",r.name," ")}}function ft(t,e){if(1&t&&(F.Sb(0,"mat-option",11),F.zc(1),F.Rb()),2&t){var r=e.$implicit;F.ic("value",r),F.Bb(1),F.Bc(" ",r," ")}}var pt,ht,gt=((ht=function(){function t(e,r){c(this,t),this.fb=e,this.store=r,this.months=Y.a,this.shipmentTypes=Object.values(p.d),this.destroyer$$=new I.a}return d(t,[{key:"ngOnInit",value:function(){this.addOrderForm=this.fb.group({id:O.onceOrder.order.id,personId:O.onceOrder.order.personId,comment:O.onceOrder.order.comment,sended:O.onceOrder.order.sended,shipmentDate:["",w.u.required],shipmentType:["",w.u.required],trackNumber:O.onceOrder.order.trackNumber,type:O.onceOrder.order.type,orderStructure:this.fb.group({kits:this.fb.array([]),theatres:this.fb.array([])})}),this.setFormFromStore(),this.initFormSaver(),this.initResetListener()}},{key:"ngOnDestroy",value:function(){this.destroyer$$.next(),this.destroyer$$.complete()}},{key:"initFormSaver",value:function(){var t=this;this.addOrderForm.valueChanges.pipe(Object(B.a)(this.destroyer$$),Object(m.a)(500)).subscribe(function(e){t.store.saveForm({onceOrder:{order:e,isValid:t.addOrderForm.valid}})})}},{key:"setFormFromStore",value:function(){var t=this;this.store.select(function(t){return t.onceOrder}).pipe(Object(M.a)(1),Object(S.a)(function(e){t.order=e.order;var r=Object.assign({},e.order);delete r.orderStructure,r.type=p.b.check,t.addOrderForm.patchValue(r)})).subscribe()}},{key:"initResetListener",value:function(){var t=this;this.store.select(function(t){return t.resetForm}).pipe(Object(B.a)(this.destroyer$$),Object(S.a)(function(e){e&&t.addOrderForm.reset()})).subscribe()}},{key:"orderStructure",get:function(){return this.addOrderForm.get("orderStructure")}}]),t}()).\u0275fac=function(t){return new(t||ht)(F.Mb(w.e),F.Mb(x))},ht.\u0275cmp=F.Gb({type:ht,selectors:[["ntv-once-form"]],decls:27,vars:6,consts:[[1,"form",3,"formGroup"],[1,"form__comment"],["appearance","standard"],["matInput","","formControlName","comment"],[1,"form__block"],[1,"select-card"],["formControlName","shipmentDate"],[3,"value",4,"ngFor","ngForOf"],[3,"vertical"],["formControlName","shipmentType"],[3,"orderStructure","orderStructureGroup"],[3,"value"]],template:function(t,e){1&t&&(F.Sb(0,"form",0),F.Sb(1,"h4"),F.zc(2,"\u041e \u0437\u0430\u043a\u0430\u0437\u0435"),F.Rb(),F.Sb(3,"mat-card",1),F.Sb(4,"mat-form-field",2),F.Sb(5,"mat-label"),F.zc(6,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"),F.Rb(),F.Nb(7,"textarea",3),F.Rb(),F.Rb(),F.Sb(8,"h4"),F.zc(9,"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"),F.Rb(),F.Sb(10,"div",4),F.Sb(11,"mat-card",5),F.Sb(12,"mat-form-field",2),F.Sb(13,"mat-label"),F.zc(14,"\u0414\u0430\u0442\u0430*"),F.Rb(),F.Sb(15,"mat-select",6),F.xc(16,mt,2,2,"mat-option",7),F.Rb(),F.Rb(),F.Rb(),F.Nb(17,"mat-divider",8),F.Sb(18,"mat-card",5),F.Sb(19,"mat-form-field",2),F.Sb(20,"mat-label"),F.zc(21,"\u0422\u0438\u043f*"),F.Rb(),F.Sb(22,"mat-select",9),F.xc(23,ft,2,2,"mat-option",7),F.Rb(),F.Rb(),F.Rb(),F.Rb(),F.Sb(24,"h4"),F.zc(25,"\u0427\u0442\u043e \u0432\u0435\u0437\u0435\u043c"),F.Rb(),F.Nb(26,"ntv-order-structure-form",10),F.Rb()),2&t&&(F.ic("formGroup",e.addOrderForm),F.Bb(16),F.ic("ngForOf",e.months),F.Bb(1),F.ic("vertical",!0),F.Bb(6),F.ic("ngForOf",e.shipmentTypes),F.Bb(3),F.ic("orderStructure",e.order.orderStructure)("orderStructureGroup",e.orderStructure))},directives:[w.v,w.o,w.h,N.a,z.c,z.f,T.b,w.c,w.n,w.g,tt.a,q.j,lt.a,X.a,A.n],styles:["[_nghost-%COMP%]{display:block;min-width:500px}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;height:100%;box-sizing:border-box}.form__block[_ngcontent-%COMP%]{grid-template-columns:1fr 1px 1fr;grid-gap:16px}.form__block[_ngcontent-%COMP%], .form__comment[_ngcontent-%COMP%]{display:grid;width:100%}.scrollbar[_ngcontent-%COMP%]{max-height:50vh}.select-card[_ngcontent-%COMP%]{display:grid}"]}),ht),vt=((pt=function(){function t(e){c(this,t),this.store=e,this.orderTypes=p.b}return d(t,[{key:"setCurrentOrderType",value:function(t){var e=Object.values(p.b).reduce(function(e,r){return r===t.tab.textLabel.toLowerCase()&&(e=r),e},p.b.subscription);this.store.saveForm({orderType:e})}}]),t}()).\u0275fac=function(t){return new(t||pt)(F.Mb(x))},pt.\u0275cmp=F.Gb({type:pt,selectors:[["ntv-order-form"]],decls:7,vars:6,consts:[["mat-stretch-tabs","","dynamicHeight","",3,"selectedTabChange"],[3,"label"]],template:function(t,e){1&t&&(F.Sb(0,"mat-tab-group",0),F.Zb("selectedTabChange",function(t){return e.setCurrentOrderType(t)}),F.Sb(1,"mat-tab",1),F.ec(2,"titlecase"),F.Nb(3,"ntv-subscription-form"),F.Rb(),F.Sb(4,"mat-tab",1),F.ec(5,"titlecase"),F.Nb(6,"ntv-once-form"),F.Rb(),F.Rb()),2&t&&(F.Bb(1),F.ic("label",F.fc(2,2,e.orderTypes.subscription)),F.Bb(3),F.ic("label",F.fc(5,4,e.orderTypes.check)))},directives:[Q.b,Q.a,bt,gt],pipes:[q.r],styles:["[_nghost-%COMP%]{display:block}"]}),pt),St=a("4Kj8");function yt(t,e){1&t&&(F.Sb(0,"span",8),F.zc(1," \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c... "),F.Nb(2,"ntv-spinner",9),F.Rb()),2&t&&(F.Bb(2),F.ic("diameter",16))}function Ot(t,e){1&t&&(F.Sb(0,"span",8),F.zc(1," \u041e\u0448\u0438\u0431\u043a\u0430, \u043d\u0430\u0436\u043c\u0438 \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0441\u043d\u043e\u0432\u0430 "),F.Sb(2,"mat-icon",10),F.zc(3,"error"),F.Rb(),F.Rb())}function Ft(t,e){1&t&&(F.Qb(0),F.zc(1," \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u043a\u0430\u0437 "),F.Pb())}function Rt(t,e){if(1&t){var r=F.Tb();F.Qb(0),F.Sb(1,"button",5),F.Zb("click",function(){F.pc(r);var t=e.ngIf;return F.dc().registerNewOrder(t)}),F.ec(2,"async"),F.xc(3,yt,3,1,"span",6),F.xc(4,Ot,4,0,"span",6),F.xc(5,Ft,2,0,"ng-container",7),F.Rb(),F.Pb()}if(2&t){var n=F.dc();F.Bb(1),F.ic("ngSwitch",F.fc(2,4,n.loadingState$))("disabled",!n.readyToSend),F.Bb(2),F.ic("ngSwitchCase",n.loadingStates.loading),F.Bb(1),F.ic("ngSwitchCase",n.loadingStates.err)}}var kt,jt,Ct,_t=[{path:"",component:(kt=function(){function t(e){c(this,t),this.store=e,this.loadingStates=f.a}return d(t,[{key:"ngOnInit",value:function(){var t=this;this.store.setFormData(),this.loadingState$=this.store.select(function(t){return t.loadingState}).pipe(Object(m.a)(200)),this.state$=this.store.select(function(e){return t.readyToSend=e.orderType===p.b.subscription?e.customer.isValid&&e.subscriptionsOrders.isValid:e.customer.isValid&&e.onceOrder.isValid,e})}},{key:"registerNewOrder",value:function(t){this.store.registerNewOrder(t)}}]),t}(),kt.\u0275fac=function(t){return new(t||kt)(F.Mb(x))},kt.\u0275cmp=F.Gb({type:kt,selectors:[["ntv-add-order"]],features:[F.Ab([x])],decls:13,vars:3,consts:[[1,"scrollbar"],[1,"add-order"],[1,"add-order__forms-container"],[1,"add-order__form"],[4,"ngIf"],["mat-raised-button","",1,"add-order__submit-button",3,"ngSwitch","disabled","click"],["class","submit-button__content",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"submit-button__content"],[1,"submit-button__spinner",3,"diameter"],[1,"submit-button__error-icon"]],template:function(t,e){1&t&&(F.Sb(0,"ng-scrollbar",0),F.Sb(1,"div",1),F.Sb(2,"div",2),F.Sb(3,"mat-card",3),F.Sb(4,"mat-card-title"),F.zc(5,"\u041a\u043b\u0438\u0435\u043d\u0442"),F.Rb(),F.Nb(6,"ntv-customer-form"),F.Rb(),F.Sb(7,"mat-card",3),F.Sb(8,"mat-card-title"),F.zc(9,"\u0417\u0430\u043a\u0430\u0437"),F.Rb(),F.Nb(10,"ntv-order-form"),F.Rb(),F.Rb(),F.xc(11,Rt,6,6,"ng-container",4),F.ec(12,"async"),F.Rb(),F.Rb()),2&t&&(F.Bb(11),F.ic("ngIf",F.fc(12,1,e.state$)))},directives:[$.a,N.a,N.c,W,vt,q.k,G.a,q.m,q.n,q.o,St.a,V.a],pipes:[q.b],styles:["[_nghost-%COMP%]{display:block;width:100%}.add-order[_ngcontent-%COMP%]{padding:24px}.add-order__forms-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(500px,1fr));gap:16px}.add-order__submit-button[_ngcontent-%COMP%]{margin-top:16px}.add-order__submit-button__content[_ngcontent-%COMP%]{display:flex;align-items:center}.add-order__submit-button__spinner[_ngcontent-%COMP%]{margin-top:0;margin-left:8px}.add-order__submit-button__error-icon[_ngcontent-%COMP%]{margin-left:8px}.scrollbar[_ngcontent-%COMP%]{max-height:calc(100vh - 64px);min-height:calc(100vh - 64px)}"]}),kt)}],xt=((Ct=function t(){c(this,t)}).\u0275mod=F.Kb({type:Ct}),Ct.\u0275inj=F.Jb({factory:function(t){return new(t||Ct)},imports:[[l.h.forChild(_t)],l.h]}),Ct),$t=((jt=function t(){c(this,t)}).\u0275mod=F.Kb({type:jt}),jt.\u0275inj=F.Jb({factory:function(t){return new(t||jt)},imports:[[xt,b.a]]}),jt)}}])}();